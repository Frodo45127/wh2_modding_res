<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Modding Resources</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="chapter_0_1.html">Modding Resources</a></li><li class="affix"><a href="chapter_0_2.html">Converting to Markdown</a></li><li class="affix"><a href="to_do.html">TO DO</a></li><li><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> Tools &amp; Resources</a></li><li><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Database Editing</a></li><li><ol class="section"><li><a href="chapter_2_1.html"><strong aria-hidden="true">2.1.</strong> Tolerant Tables</a></li><li><a href="chapter_2_2.html"><strong aria-hidden="true">2.2.</strong> Building Buildings</a></li></ol></li><li><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> Lua</a></li><li><ol class="section"><li><a href="chapter_3_1.html"><strong aria-hidden="true">3.1.</strong> From Start To Scratch</a></li><li><ol class="section"><li><a href="chapter_3_1_0.html"><strong aria-hidden="true">3.1.1.</strong> Foreword: Devtool Console</a></li><li><a href="chapter_3_1_1.html"><strong aria-hidden="true">3.1.2.</strong> Hello World</a></li><li><a href="chapter_3_1_2.html"><strong aria-hidden="true">3.1.3.</strong> Fun Stuff</a></li><li><a href="chapter_3_1_3.html"><strong aria-hidden="true">3.1.4.</strong> Chunks &amp; Statements</a></li><li><a href="chapter_3_1_4.html"><strong aria-hidden="true">3.1.5.</strong> Variables &amp; Types</a></li><li><a href="chapter_3_1_5.html"><strong aria-hidden="true">3.1.6.</strong> Expressions &amp; Operators</a></li><li><a href="chapter_3_1_6.html"><strong aria-hidden="true">3.1.7.</strong> Scopes &amp; Stuff</a></li><li><a href="chapter_3_1_7.html"><strong aria-hidden="true">3.1.8.</strong> Functions, Arguments &amp; Parameters (Also, Returns)</a></li><li><a href="chapter_3_1_8.html"><strong aria-hidden="true">3.1.9.</strong> Commands, Interfaces &amp; Listeners</a></li></ol></li><li><a href="chapter_3_2.html"><strong aria-hidden="true">3.2.</strong> Listeners</a></li></ol></li><li><a href="chapter_4.html"><strong aria-hidden="true">4.</strong> Etc</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Modding Resources</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#modding-resources" id="modding-resources"><h1>Modding Resources</h1></a>
<a class="header" href="#hello-and-welcome" id="hello-and-welcome"><h3>Hello and Welcome!</h3></a>
<p>Welcome to this little paradise of modding, for Total War: WARHAMMER II. Before we go on, a few things to note:</p>
<ul>
<li>This website is run and maintained by a beautiful union between GitHub and myself, Vandy. (It's hosted on GitHub Pages, if you can't tell from the URL.)</li>
<li>This is an independent project, completely separate from anything resembling official-ness via Creative Assembly, or SEGA, or Games Workshop, or whatever.</li>
<li>All tutorials hosted here are done so with the consent of their respective authors - not a great fan of stolen work!</li>
<li>This site doesn't seek to be an exhaustive list of guaranteed victories, but a slowly-growing community effort to condense knowledge that we have, and formalize it.</li>
</ul>
<p>This project is early yet, and won't be easy for me to maintain. If you would like to help me, reach out to me, and I'll have you convert some tutorials into .md files. Read how below, in &quot;Converting to Markdown&quot;.</p>
<a class="header" href="#divisions" id="divisions"><h3>Divisions</h3></a>
<p>The way I'm going to divide up the tutorials is utterly and completely undecided as of yet.</p>
<a class="header" href="#submissions" id="submissions"><h3>Submissions</h3></a>
<p>If you'd like to submit your tutorial, let me know! There will probably be a cleaner way of this later on, but yeah. Just tell me. Thx.</p>
<a class="header" href="#converting-to-markdown" id="converting-to-markdown"><h1>Converting to Markdown</h1></a>
<a class="header" href="#markdown-conversion" id="markdown-conversion"><h3>Markdown Conversion</h3></a>
<p>This page is intended as a very quick guide on how to convert your tutorial into the language used here, markdown. Markdown is super simple and made to be incredibly simple.</p>
<a class="header" href="#standard-text" id="standard-text"><h4>Standard Text</h4></a>
<p>These three are the backbone of any good tutorial.</p>
<p>Italics - *text*</p>
<p><em>this is an example</em></p>
<p>Bold - **text**</p>
<p><strong>this is an example</strong></p>
<p>Italics &amp; Bold - ***text***</p>
<p><strong><em>this is an example</em></strong></p>
<a class="header" href="#blockquotes" id="blockquotes"><h4>Blockquotes</h4></a>
<p>Blockquotes are a great way of showing specific code or db stuffs. All you have to do is put a &quot;&gt;&quot; preceding a paragraph.</p>
<blockquote>
<p>This is a blockquote.</p>
<p>And this is the blockquote's end.</p>
</blockquote>
<blockquote>
<p>You can use most markdown elements in a blockquote, but I won't cover the possibilities here.</p>
</blockquote>
<blockquote>
<p>You can also make nestled blockquotes.</p>
<blockquote>
<p>Like this.</p>
<blockquote>
<blockquote>
<p>And, this.</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<a class="header" href="#lists" id="lists"><h4>Lists</h4></a>
<p>Super simple, like the rest of this language. To make a nice bulleted list, use &quot;-&quot; prior to the item, with a line break in between.</p>
<ul>
<li>Example list.</li>
<li>Look at my shiny buttons.
<ul>
<li>You can even indent.
You can also randomly not use a bullet to say something.</li>
</ul>
</li>
<li>And then use a bullet again.</li>
</ul>
<p>If you want to number the list, just put &quot;1.&quot; prior to the first item, and then iterate the number for each new list item.</p>
<ol>
<li>First thing on the agenda - put 1.</li>
<li>Shortly after that, put 2.
I think you get the example by now.</li>
<li>One more, for good measure.</li>
</ol>
<a class="header" href="#codeblocks" id="codeblocks"><h4>Codeblocks</h4></a>
<p>For any written code, you can use a single backtick/grave (`) on both sides of the text in order to write code inline. Kinda like <code>this</code>.</p>
<p>If you want to make blocks of code, you can use three of the above, on both sides of the text.</p>
<pre><code class="language-lua">local example = &quot;text&quot;

function do_stuff()
    print(example)
end

do_stuff()
</code></pre>
<a class="header" href="#line-breaks" id="line-breaks"><h4>Line Breaks</h4></a>
<p>If you want to make big lines across the screen, use three (or more) hyphens, asterisks, or underscores, in a line by themselves.</p>
<hr />
<a class="header" href="#links-and-images" id="links-and-images"><h4>Links and Images</h4></a>
<p>Links are pretty simple, and can have a specified tooltips for when they're hovered over, or converted into text and made into a hyperlink, or can remain a standard clickable link.</p>
<p>To make a standard clickable link, wrap the URL with &quot;&lt;&gt;&quot;.</p>
<p><a href="https://www.google.com">https://www.google.com</a></p>
<p>To give a link a title that replaces the URL, first put the title within &quot;[]&quot;, and have it immediately followed by &quot;()&quot;.</p>
<p>[example title](https://www.google.com)</p>
<p><a href="https://www.google.com">example title</a></p>
<p>Images are much the same as above, use a &quot;!&quot; preceding the title and the link designation.</p>
<p>![example image](https://cdn.discordapp.com/emojis/460756324729356299.png?v=1)</p>
<p><img src="https://cdn.discordapp.com/emojis/460756324729356299.png?v=1" alt="example image" /></p>
<p>For either, if you want alternate text to popup when hovering over the element, put the alternate text within the &quot;()&quot;, after the link, and in quotation marks, like so:</p>
<p>[example title](https://www.google.com &quot;This Is Google!&quot;)</p>
<p><a href="https://www.google.com" title="This Is Google!">example title</a></p>
<p>If your image isn't uploaded onto the web, that's fine - just send me the file, and I can attach it on my side. Make a note for me, saying ![][image_1] for the first image, ![][image_2] for the second and so on, and I'll take care of the rest!</p>
<a class="header" href="#headings" id="headings"><h4>Headings</h4></a>
<p>You can set six different bolded-sizes for headers, for visual distinction. A header is simply a number sign (#) followed by the text that is being head'ed. There can be one number sign, up to six number signs, preceding the text. One number sign is the largest, six the smallest.</p>
<a class="header" href="#one-number-sign" id="one-number-sign"><h1>One Number Sign</h1></a>
<a class="header" href="#two-number-signs" id="two-number-signs"><h2>Two Number Signs</h2></a>
<a class="header" href="#three-number-signs" id="three-number-signs"><h3>Three Number Signs</h3></a>
<a class="header" href="#four-number-signs" id="four-number-signs"><h4>Four Number Signs</h4></a>
<a class="header" href="#five-number-signs" id="five-number-signs"><h5>Five Number Signs</h5></a>
<a class="header" href="#six-number-signs" id="six-number-signs"><h6>Six Number Signs</h6></a>
<a class="header" href="#tutorials-to-convert" id="tutorials-to-convert"><h3>Tutorials to Convert</h3></a>
<ul>
<li><a href="https://docs.google.com/document/d/1b1qF9PJUdBsW6Zj6msFImfT275EpnT8jNf4H2Kjct_Q/edit?usp=sharing">Tolerant Tables by Cataph</a></li>
<li><a href="https://docs.google.com/document/d/13WhCMaeXeO8yi7X7vEIHA9_h-i6lXvclmC3bf2Z7U6Q/edit?usp=sharing">Mod Troubleshooting Guide by Cataph</a></li>
<li><a href="https://docs.google.com/document/d/1ouBxVjIcdz_pcdWjvR0UUNlBMgpk_iOkS2_YqsR8vjQ/edit?usp=sharing">Unit Card Guide by Cataph</a></li>
<li><a href="https://docs.google.com/document/d/1hrg3VP3Fl15bYm5I6cvPe3ZYU7OasXsztGOkJ4RugaA/edit?usp=sharing">Lua Overview by Vandy</a></li>
<li><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1218756773">How to Write Readable Script by theSniperDevil</a></li>
<li><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1312564661">Save States by theSniperDevil</a></li>
<li><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1312347007">Creating Self-Calling Scripts by theSniperDevil</a></li>
<li><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1194811468">Custom Porthole Bins by Marthenil</a></li>
</ul>
<a class="header" href="#things-to-do" id="things-to-do"><h3>Things To Do</h3></a>
<ul>
<li>combine TSD's <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1314628727">Listener tutorial</a> with mine own</li>
<li>update all of TSD's tutorials, removing references to CMF and adding in the new script loaders from best-boi Mitch</li>
<li>get mo' permissions, dawg</li>
</ul>
<a class="header" href="#peeps-asked-all-approved" id="peeps-asked-all-approved"><h3>Peeps Asked (All Approved!)</h3></a>
<ul>
<li>Cryswar (LL 1-4)</li>
<li>Maruka (prefabs/vistas/skins)</li>
<li>Whyso (UU3D tuto)</li>
<li>Frodo (new tutorials incoming)</li>
<li>Mklabs (QB tuto needs updating)</li>
<li>Norse (MP tuto)</li>
</ul>
<a class="header" href="#tools--resources" id="tools--resources"><h1>Tools &amp; Resources</h1></a>
<p>Every modder needs proper tools, just like every lumberjack needs a swingset. This list does not claim to be a sure-fire solution to every single issue a modder might face, nor an impervious list of perfect programs, designed to cater your every need. This list <strong>does</strong> have a lot of value in it, I believe, and if used correctly, a lot can be achieved.</p>
<a class="header" href="#kaedrins-mod-manager" id="kaedrins-mod-manager"><h4>Kaedrin's Mod Manager</h4></a>
<p><a href="https://github.com/Kaedrin/warhammer-mod-manager/releases/">Kaedrin's Mod Manager</a> is a very useful alternative mod manager that works for all Total War games since Total War: Empire.</p>
<p>You can get in contact with the creator, Kaedrin, in the Modding Den's channel <a href="https://discord.gg/yHvXGRb">#kaedrin_mod_manager</a>.</p>
<a class="header" href="#frodos-rusted-pack-file-manager" id="frodos-rusted-pack-file-manager"><h4>Frodo's Rusted Pack File Manager</h4></a>
<p><a href="https://github.com/Frodo45127/rpfm/releases/latest">RPFM</a> is a great pack-file managing tool, essential for any modder. Active development has new features coming regularly, as well as constant bugfixes or squashings.</p>
<p>Get in contact with the creator, Frodo, in the Modding Den's channel <a href="https://github.com/Frodo45127/rpfm/releases/latest">#rpfm</a>.</p>
<a class="header" href="#scripting-resources" id="scripting-resources"><h4>Scripting Resources</h4></a>
<p><a href="files/entry.lua">entry.lua</a></p>
<p><a href="files/ca_types.lua">ca_types.lua</a></p>
<p><a href="files/uimf_types.lua">uimf_types.lua</a></p>
<p><a href="files/scripting_doc.html">Script Doc (Events &amp; Interfaces)</a></p>
<p><a href="files/scripting.txt">Script Doc (CM Functions)</a></p>
<a class="header" href="#database-stuff" id="database-stuff"><h1>Database Stuff</h1></a>
<a class="header" href="#tolerant-tables" id="tolerant-tables"><h1>Tolerant Tables</h1></a>
<a class="header" href="#whats-a-tolerant-table" id="whats-a-tolerant-table"><h5>What's a tolerant table?</h5></a>
<p><strong>A tolerant table is an arbitrarily defined table that will not crash when a <em>referenced</em> key is missing in a certain column.</strong> This is particularly relevant when you are overriding new content from another mod and it turned out that you do not need to port two or more tables just to provide background references for those keys. Instead, you need just one table for the value to edit.</p>
<p>It may also be a trap leading to stuff not working in your own mod while also not crashing to desktop.</p>
<a class="header" href="#registry" id="registry"><h2>Registry</h2></a>
<p>Here is a list of such tables and streamline overrides. We encourage you all to report any new findings, preferably in alphabetical order. When reporting new tables, please include the date, because we do not know if or when this kind of behavior can abruptly change CA-side, and older dates can be considered suspicious when you have weird crashes after a patch.</p>
<ol>
<li>
<p><strong>ancillary effects junction</strong></p>
<ul>
<li>tolerates missing <em>ancillary</em> as of 2nd November 2018</li>
</ul>
</li>
<li>
<p><strong>building culture variants</strong></p>
<ul>
<li>tolerates missing <em>building level</em> and <em>culture</em> (<em>likely sc and faction as well</em>) as of 26th March 2019.</li>
</ul>
</li>
<li>
<p><strong>building effects junction</strong></p>
<ul>
<li>tolerates missing <em>building level</em>, but not <em>effect</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>building units allowed</strong></p>
<ul>
<li>tolerates missing <em>building level</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>campaign stances factions junctions</strong></p>
<ul>
<li>tolerates missing <em>faction</em> as of 9th December 2018.</li>
</ul>
</li>
<li>
<p><strong>cdir events dilemma/incident/mission option junctions</strong></p>
<ul>
<li>tolerates missing <em>value</em> and <em>dilemma</em>, even in the assembly kit, as of 8th December 2018.</li>
</ul>
</li>
<li>
<p><strong>cdir military generator unit qualities</strong></p>
<ul>
<li>tolerates missing <em>unit</em> as of 12th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>effect bonus value ids unit sets</strong></p>
<ul>
<li>tolerates missing <em>effect</em> as of 5th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>effect bundles to effects junction</strong></p>
<ul>
<li>tolerates missing <em>effect</em> as of 18th August 2018.</li>
</ul>
</li>
<li>
<p><strong>faction rebellion units junctions</strong></p>
<ul>
<li>tolerates missing <em>faction</em> as of 2nd November 2018.</li>
</ul>
</li>
<li>
<p><strong>frontend faction effects junctions</strong></p>
<ul>
<li>tolerates missing <em>effect scope</em> as of 1st January 2019.</li>
</ul>
</li>
<li>
<p><strong>land units</strong></p>
<ul>
<li>tolerates missing <em>missing weapon</em></li>
<li>tolerates missing <em>historical+short descr, mount, attribute group</em> as long as the unit is not selected in-game, as of April 2019.</li>
<li>tolerates missing <em>engine</em>, but the supposed engine will not show up in battle, as of 12th November 2018.</li>
</ul>
</li>
<li>
<p><strong>land units to unit abilities junction</strong></p>
<ul>
<li>tolerates missing <em>land unit</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>main units</strong></p>
<ul>
<li>tolerates missing <em>campaign mount</em> as of 12th Orctober 2018.</li>
<li>tolerates missing <em>ui_groupings</em> on startup sometimes, and will crash on clicking Custom Battles otherwise.</li>
</ul>
</li>
<li>
<p><strong>melee weapons</strong></p>
<ul>
<li>tolerates missing <em>contact effect phase</em> as of 9th November 2018.</li>
</ul>
</li>
<li>
<p><strong>projectile bombardments</strong></p>
<ul>
<li>tolerates missing <em>projectile type</em> as of 12th November 2018.</li>
</ul>
</li>
<li>
<p><strong>special ability phase stat effects</strong></p>
<ul>
<li>tolerates missing <em>phase</em> as of 9th November 2018.</li>
</ul>
</li>
<li>
<p><strong>special ability groups to units junction</strong></p>
<ul>
<li>tolerates missing <em>unit</em> as of 20th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>technology nodes</strong></p>
<ul>
<li>tolerates missing <em>faction</em> as of 1st January 2019.</li>
</ul>
</li>
<li>
<p><strong>unit set unit attribute junction</strong></p>
<ul>
<li>tolerates wrong <em>attribute</em> as of 20th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>unit set to unit junction</strong></p>
<ul>
<li>tolerates missing <em>main unit</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>unit variants</strong></p>
<ul>
<li>tolerates missing <em>land unit</em> as of 26th March 2019.</li>
</ul>
</li>
<li>
<p><strong>units to groupings military permissions</strong></p>
<ul>
<li>tolerates missing military group as of 12th December 2018.</li>
</ul>
</li>
<li>
<p><strong>ui unit bullet point unit overrides</strong></p>
<ul>
<li>tolerates wrong <em>unit</em> as of 27th February 2019.</li>
</ul>
</li>
</ol>
<a class="header" href="#building-buildings" id="building-buildings"><h1>Building Buildings</h1></a>
<a class="header" href="#so-you-want-to-build-a-building" id="so-you-want-to-build-a-building"><h3>So you want to build a building?</h3></a>
<p>Buildings are a great feature in the game, and editing them can allow for a lot of fun new mechanics! New building chains can allows new units, new effects, and new landmarks. The best news of all is that most ideas with building chains are possible.</p>
<a class="header" href="#vocabulary" id="vocabulary"><h3>Vocabulary</h3></a>
<p>I want to first cover some vernacular that we will be using throughout this tutorial. These terms are conceptual but critical to understanding what Creative Assembly is manipulating in their game files.</p>
<ul>
<li><strong>Key</strong>: A key is an identifier, a definition point in the database.</li>
<li><strong>Id</strong>: An id is similar to a key in that it is an identifier, except it is a randomly generated number used in certain tables of the database.</li>
<li><strong>Level</strong>: A level is each individual building that you can construct in the game. They can be one-off or individual, or they can be upgraded into other buildings. The Empire tier 1 barracks, tier 2 barracks, and the tier 3 barracks are each a level.</li>
<li><strong>Chain</strong>: A chain is much like it sounds - a direct chain of buildings. In the images, below. each vertical set of buildings that can be upgraded is a chain. The tier 1 barracks, the tier 2 barracks, and the tier three barracks are each a level.</li>
<li><strong>Building Availability Set (BAS)</strong>: A building availability set is the link between building chains and the faction/culture/subculture that can build them.</li>
<li><strong>Superchain</strong>: A superchain can be seen as a collection of various chains from different races/factions, which can save data space when linking to slot templates (the only way to link buildings to locations). For instance, all settled factions except for the Wood Elves (due to their unique building style) have their standard infantry building linked to the <code>wh2_main_sch_military1_barracks</code> superchain, which is available at all settlements. It consolidates the entirety of your buildings into one package.</li>
<li><strong>Set</strong>: A set is more or less a visual effect that conveys a category. As you'll see in the images below, &quot;Military Recruitment&quot; and &quot;Infrastructure&quot; are examples of buildings sets, which lump together various different building chains into a specific group.</li>
<li><strong>Slot Template</strong>: The database (db) classification of various locations, and the union between buildings and regions. Slot templates allow you to lock buildings to specific locations (for example, landmarks). However, <strong><em>not every settlement has a unique slot template.</em></strong> For instance, Altdorf has the slot templates <code>wh_main_special_altdorf_primary</code> and <code>wh_main_special_altdorf_secondary</code>, while Bibali has the basic &quot;wh_main_human_minor_primary_coast&quot; slot template. As we see in an unmodded game, Altdorf has unique buildings in, while Bilbali does not, so we can infer that Creative Assembly had no need to add in a custom slot template for the latter.</li>
</ul>
<p><img src="images/2_1-01.png" alt="test" />
<img src="images/2_1-02.png" alt="test" /></p>
<a class="header" href="#getting-started" id="getting-started"><h3>Getting Started</h3></a>
<p>First off, you'll want to get your idea(s) in order. You want to make a building, but what will this building do? Where can it be built? Is this building locked to certain cultures/factions? How many levels will it have? Having an answer to each of these questions will help you carry on through the tutorial.</p>
<p>Now, you'll want to open up Rusted Pack File Manager (RPFM) and the Assembly Kit. RPFM is where you'll be peforming all of your work - the Assembly Kit is more of less going to be used as a glorified search engine.</p>
<p>Open up RPFM, go up to Packfile -&gt; New Packfile. Right click this new packfile (called unknown.pack) -&gt; Add -&gt; Add from Packfile.
The &quot;Select Packfile&quot; window will open, go to wherever you installed Warhammer 2 -&gt; click on the data folder -&gt; and then find and select the data.pack to open.</p>
<p>On the right hand side, the &quot;Add from Packfile&quot; Mode will open, and you'll see a file hierarchy of the different folders and tables within the pack. Look for the folder marked &quot;db&quot; and expand it. There will be a list of subfolders. Scroll through, expand the following subfolders and add the following tables from the data.pack:</p>
<ul>
<li>building_chains_availability_sets_tables</li>
<li>building_chains_tables</li>
<li>building_culture_variants_tables</li>
<li>building_effects_junctions_tables</li>
<li>building_instances_tables</li>
<li>building_levels_tables</li>
<li>building_set_to_building_junctions_tables</li>
<li>building_superchains_tables</li>
<li>building_units_allowed_tables (Only needed if you will be linking units to the building)</li>
<li>building_upgrades_junction_tables (Only needed if you will have more than one level)</li>
<li>slot_template_to_building_superchain_junctions_tables</li>
</ul>
<p>Once you have added each table, click the &quot;Exit 'Add from Packfile' Mode&quot; at the top center of the screen.</p>
<p>You will also have to add a few files for the localisation of the building mod, so let's do that now. As before, right click the packfile and add from packfile, this time grabbing the local_en.pack to open.
Scroll through and add the following tables from local_en.pack:</p>
<ul>
<li>building_chains__.loc</li>
<li>building_culture_variants__.loc</li>
<li>building_short_descrptions_texts__.loc</li>
</ul>
<p>That's it for importing! In the future, you may need more tables such as effects if you're going in to that, however this tutorial will not be covering that action.</p>
<a class="header" href="#inputting-data" id="inputting-data"><h3>Inputting Data</h3></a>
<p>The very first thing that I recommend is to go into the building_superchains table and delete all rows. If you have not changed around any hotkeys (which you can do by the way by going to Packfile -&gt; Preferences), you can delete all rows in the table by clicking an entry in the table -&gt; <code>CTRL+A</code> to select all in the table -&gt; <code>DELETE</code>.</p>
<p>Let's add in a new row by pressing <code>CTRL+SHIFT+A</code>. From here, we can add in your new key. It can be named whatever you want, but we advise that you rename it to something that's not already a vanilla key or looks like it could be a vanilla key. You don't want to assume vanilla keys, as it will make the game freak out. Depending on what I'm making, I either prefix with vandy_ or prussian_, but you could go with whatever works for you. <strong>Just don't assume vanilla keys.</strong></p>
<p>I recommend writing an easy key, one that you can copy over through various tables and use interchangeable. If I were to make a new horde building for the Empire, I would probably call it &quot;vandy_empire_horde_main&quot; if it were the primary building, or &quot;vandy_empire_horde_barracks&quot; if it were the barracks. You could also easily do &quot;empire_main&quot; and &quot;empire_barracks&quot;, but keeping a unique prefex on all of your work helps with organization.</p>
<p>After that, go the slot_template_to_building_superchains_junctions. Don't delete anything just yet! Here is where we actually want to link the building we are making to a location or locations. There are three columns we want to worry about: building_superchains, id, and slot_templates.</p>
<p><strong>Note:</strong> If the building or building chain is not in here, then it will not show up in any settlements.</p>
<p>If you are making this into a horde building, you would assign it to the horde_primary slot for the main building, or horde_secondary for any others.</p>
<p>If you are making this into a settled building, you would have to have to input your building to all the different slot_templates. The four main slot_templates are</p>
<ol>
<li>wh_main_human_major_primary (a province capital's main building)</li>
<li>wh_main_human_major_secondary (any other building in a province capital)</li>
<li>wh_main_human_minor_primary (a regular settlement's main building)</li>
<li>wh_main_human_minor_secondary (any other building in a regular settlement)</li>
</ol>
<p>Remember, there are also unique slot_templates for all different resources, all unique locations, several new resources made for Warhammer 2, and some older and antiquated slot_templates such as &quot;wh_main_dwarf_orc&quot;, used for the Regional Occupation system in Warhammer 1 that is currently unused in Warhammer 2.</p>
<p>I'll let you in on a little secret - typing out all the slot_templates is unnessary and tedious. Open up the Assembly Kit real quick, go into the slot_template_to_building_superchains_junctions table and open up the Search function. Change the column filter to &quot;building_superchain&quot; and type in &quot;wh2_main_sch_military1_barracks.&quot; This will only show the junctions between the barracks superchain and all slot templates that the barracks superchain is available in. Thus, this superchain includes all beginner military superchains for each race - such as the Cemetary for the Vampire Counts. Grab the entire Slot Templates column from the Assembly Kit and paste it into the corresponding table in your mod back in RPFM. Secondly, take your building_superchain key and paste it in each entry of the column.</p>
<p>One last step - we need to assign unique id numbers to each of these entries. Now, Creative Assembly used random generated id numbers for their entries, and there are hundreds of thousands of entries within these game files. Thus, you probably can't use 1 or 10 or 100 for any of these entries. I recommend being safe and using 8 digit (1906015) id numbers for each superchain entry.</p>
<p>If you did this right, this action should now apply that superchain's availability to each and every settlement on the map. You'll have to repeat this step for each new building chain.</p>
<p><strong>Note:</strong> There is only the need for one superchain for a link of buildings you can upgrade, but you will need one superchain for each separate link of buildings.</p>
<a class="header" href="#building-the-building" id="building-the-building"><h3>Building The Building</h3></a>
<p>Now that the boring part is done, we can move into the nitty-gritty! Next step is in building_chains_tables. Most of this table does not actually do much, yet we still need it. Again, <code>CTRL+A</code> to select all, then <code>DELETE</code> to delete all previous entries in this table. There are 9 coluymns in this table but we are only going to be worried about 3 of them: key, chain category, and building superchain. In the first column, &quot;key&quot;, input a unique key for your building chain. I recommend using the same key as the superchain, but you do not have to! Skip over to chain category. For this column, you're either going to enter in &quot;military&quot; or &quot;money&quot; as an entry. Ask yourself: Is this building or building chain that I am making going to be used for recruitment or combat capabilities? If so, enter in &quot;military&quot;, otherwise input &quot;money&quot;. Lastly, enter in your building_superchain key in the building superchain column. Voila, another table completed!</p>
<p>Next up, you want to make a new_building_instances key. This table determines how many of a certain building we can have in a settlement. Delete all those previous entries, make a new row. You're going to want to input your building_chain key in the first column. For the second column, &quot;1&quot; is the most common value, but if you wanted to add in a set of, say, three buildings, and allow the player to only choose <strong>two</strong> of them at once, you would enter &quot;2&quot;. Keep in mind that this is only for a <strong>single settlement</strong>, not an entire province.</p>
<p>After this we will click on over into the building_levels_tables, which will be each individual link in the building chain. Much as a Cemeetary upgrades into a Graveyard, you can have your building upgrade into another building.</p>
<p><strong>Note:</strong> If your building only has one level, like a landmark, you still need this table.</p>
<p>For the &quot;level_name&quot;, type in your building_chain name with the sufix &quot;_1&quot;, and increase it for each further step in the chain. The &quot;chain&quot; column should have you put in your unique building_chain key. For &quot;level&quot;, enter 0 for the first level, then increase by one as you go up the chain. Every building chain MUST start with a building at level 0, this does not mean that you can build your building when the settlement is a ruin! From here, a lot of stuff is just details - how many turns does your building take to build, how much does it cost to construct, does your building have an upkeep cost (which is a negative value taken every turn from your treasury), and a whole string of things that are no longer used for this game.</p>
<p>After upkeep, scroll to &quot;can_convert&quot; and put a check in each of your building entries. Without this, the buildings cannot be destroyed. Insert the building_instance_key that you made earlier into the &quot;building_instance_key&quot; column. Scroll over again to the &quot;can_be_damaged&quot; and put a check in each of your building entries, so that your building can be damaged after bring razed or sacked.</p>
<p><strong><em>Note:</em></strong> The Development Point Cost column is a modifier to make the building cost Population Surplus. This can be used for any building, but it is seen in the game through main settlement and horde buildings only.</p>
<p>We are not done yet in here! The next column, Primary Slot Building Building Building Level Requirement, determines what level the main building needs to be at to construct this building. If you input &quot;1&quot;, then this building can be constructed at a Tier 1 settlement. Conversly, if you input a &quot;3&quot;, then this building can only be constrcuted at a Tier 3 settlement. Each separate level needs to have a different primary slot requirement! Lastly, check off each entry in the Visible in UI column and head on over to building_culture_variants_tables.</p>
<p>This is where you build what your building looks like - its name, its icon, its description. You can use this table to change how it looks between cultures/factions as well.
For now, however, delete all previous entries like usual, add a new row, and input your building chain entries in the Building column, so i.e. &quot;vandy_empire_barracks_1&quot; to &quot;vandy_empire_barracks_3&quot;. Next, enter the culture, subculture, or faction key of the group you're making this for in each entry - use the Assembly Kit to search for that! For instance, my building was for the Empire, so I entered &quot;wh_main_sc_emp_empire&quot;. The Description column is not used, just put in &quot;wh_main_PLACEHOLDER&quot;. For the Artpiece column, enter either the name of the vanilla icon or import your own. The UI location is ui/buildings/icons/%.png. At the end, check off for each entry the display_tooltip.</p>
<p><strong>Note:</strong> This table needs either a &quot;faction&quot; entry or a &quot;culture&quot; entry. You can use both, but it needs at least one to function.</p>
<a class="header" href="#only-a-few-more-db-tables-to-go" id="only-a-few-more-db-tables-to-go"><h3>Only a few more db tables to go!</h3></a>
<p>From here, we have to make this building do stuff, link it to who can built it, and edit where it shows up in the buildings panel, finishing off with flavor text for all of it in game.</p>
<p>Go to building_chain_availability_sets_tables. <strong>(You should know by now to clear out these existing entries and making new rows for your own entries by now, so I'll stop saying it)</strong> This table is used to link the bulding to who can build it. The first column we input, you guessed it, the building_instances key, so i.e. &quot;vandy_main_empire_barracks&quot;. Continuing with the example, I am making my buildings for the Empire, so I enter &quot;wh_main_bas_emp&quot; for the second column. If your building is not supposed to be bult by the Empire, the Assembly Kit will help you find the availability set you want to use.</p>
<p><strong>Note:</strong> If you wanted to, you can make your own custom BAS, but it is not always required unless you're making a new culture or subculture. if you tie your building to an existing BAS - say, wh_main_bas_emp but then only give a culture variant to the Midenheim faction, then only Middenheim will be able to build it. This is very useful for excluding certain factions from buildings and much more flexible (and simpler) than using a custom BAS.</p>
<p>Let's now open up building_set_to_building_junctions_tables. This is where the building will show up in the Building Panel in-game, whether it's in &quot;Military Recruitment&quot;, &quot;Military Support&quot;, &quot;Infrastructure&quot;, or &quot;Defense.&quot; Building sets are culture specific, so once more let's open up the Assembly Kit and look in this table for what building set you need. I entered my building in &quot;wh_main_set_empire_military_support&quot;, so it will show up in-game under the Military Support category in the Building Panel. Find your key and enter in the new building. I recommend entering the building_instances key instead of the building_levels.</p>
<a class="header" href="#whoo-hoo" id="whoo-hoo"><h3>Whoo-hoo!</h3></a>
<p><strong>You now have a useless icon that costs money</strong></p>
<p>Let's give it something to do - go into the building_effects_junctions tables, and let's add in an effect. My building for this example is going to add +10 Public Order for this tutorial (even though we've been running with a barracks example... -pw), so I will go back to the Assembly Kit and search for a public order effect in the vanilla buildings and see how they add it.</p>
<p>Looks like I have to add my building in here, then use the effect key &quot;wh_main_effect_public_order_base&quot; under the Effect column, link &quot;province_to_province_own&quot; in the Effect Scope column, and add in my own value. I'm giving it +10 Public Order, so I'll enter &quot;10&quot; in for the value. The Value Damaged and the Value Destroyed columns convey the amount of effect to give when the building is damaged and when the building is ruined, respectively.</p>
<a class="header" href="#localisation-or-fleshing-out-what-the-heck-you-made" id="localisation-or-fleshing-out-what-the-heck-you-made"><h3>Localisation, or fleshing out what the heck you made</h3></a>
<p>Localisation files can be annoying and fickle, so let's get through this as smoothly as we can. Open the building_culture_variants.loc and make sure you add one new row for each &quot;level&quot; you made after you cleared out the previous entries.</p>
<p><strong>The format needs to be as follows:</strong> &quot;building_culture_variants_name_[name_of_your_building_1][culture][subculture][faction]&quot;</p>
<p>Whatever culture or subculture or faction you linked in the culture_variants table NEEDS to be formatted properly here or it will not pop up.</p>
<p><strong>My entry would look like this:</strong> &quot;building_culture_variants_name_vandy_main_test_building_1wh_main_sc_emp_empire&quot;</p>
<p>In the localised string, I input &quot;Test Building.&quot; This will be the name of each individual level. In building_short_description_texts.loc, you ONLY ned the name of the building, and the description you want to pop underneath the name. I input &quot;building_short_description_texts_short_description_vandy_main_test_building_1&quot;, with a localised string that says &quot;This is a test building!&quot;</p>
<p>Lastly, in building_chains.loc we can enter the chain name that pops up under the name of the building. I input: &quot;building_chains_chain_tooltip_vandy_main_test_building_1&quot; with the localised string &quot;Testing!&quot; for the entry.</p>
<a class="header" href="#you-did-it" id="you-did-it"><h3>You Did it!</h3></a>
<p><img src="images/2_1-03.png" alt="test" /></p>
<p>Your first building or building chain is completed! Go on, pat yourself on the back. There are plenty of creative options with buildings - you can introduce penalties and consequences to new building chains, or create interesting links of, say, two different buildings that can both get to level 3, but you can only get one to level 4 or 5. It is possible to link units to buildings, either vanilla or custom; link new technologies, and even create band new landmarks.</p>
<a class="header" href="#troubleshooting" id="troubleshooting"><h3>Troubleshooting</h3></a>
<p>Something happened and now you are getting a crash.That happens and it's okay, we can fix it. There's a couple things that you can check off the list to figure out where it's coming from.</p>
<ol>
<li>Typos in the .loc files, or the absence of them, will not cause a crash. It just means that the text that you wrote will not show up.</li>
<li>Typos in the data/tables will <strong>100%</strong> cause a crash. If you reference a non-existent key in one of the above tables, like linking a misspelled superchain to the wh_main_human_major_secondary slot template, the game will crash on start-up. This is because when the game is loading up the data, it cannot establish or identify that non-existent key in the ways it knows how and cannot continue.</li>
<li>Missing information can sometimes cause issues, for example, if you did not link a culture_variant for your levels.</li>
<li>Empty rows! This is a fun one that can also cause unintended results. Make sure you go through each table and delete any rows that you do not need.</li>
<li>Did you assume a vanilla key would work before verifying it exists? The Total War Franchise was developed and coded by people, and if we know anything about people, it's that consistency is more an ideal than a standard at times. Naming schemes, formats, and even data entries themselves have been changed and removed from patch to patch. Go back and verify that effect scope from the Assembly kit, it could be the issue.</li>
<li>Please rename your tables and your mod. There is no reason to not rename your tables and your mod, and problems can ensue otherwise. Oh, and please make sure you are using unique id's for these tables! If you use vanilla ones/id's from other mods, then you're ensuring incompatibility.</li>
</ol>
<p>Thanks for reading!</p>
<a class="header" href="#lua-3" id="lua-3"><h1>Lua &lt;3</h1></a>
<p><em>Lua</em> is a popular, lightweight, and wildly versatile programming language used in tons of modern video games, for its flexibility and very quick response time. Lua is an interpreted language, which means its code is executed and generated on the fly, as opposed to compiled languages like C or C++ which need to be “translated” - or, well, compiled - into a different file format prior to running. Its usage in the Total War series is pretty wide-spread, and is the guiding force for a lot of fun goodies, from the content of a quest battle to the implementation of the Chaos Invasion. Unlike db entries, which are compiled during the initial loading screen of the game and turned into engine data, and are often very static with very few exceptions, Lua is a dynamic energy within the game, and is the only direct way to access a multitude of game features, background data, and more.</p>
<p>This section seeks to cover a few specifics about Lua, as well as a (hopefully) solid overview of the language in the Total War context.</p>
<p>It should be noted that this tutorial series is focused on Total War: Warhammer II's Lua environment, and there can and will be many differences between the games. Efforts will be made to universal-ize this series, in the future.</p>
<a class="header" href="#from-start-to-scratch" id="from-start-to-scratch"><h1>From Start To Scratch</h1></a>
<p>Howdy and welcome, and hi, and hello. This section of the Lua section is devoted to covering as many <strong>basics</strong> of Lua one can touch on, as they pertain to Total War modding. The assumption is that the tutorial-reader has absolutely no background in coding or programming, so we will begin from the absolute top.</p>
<p>This very first section, before we get into the language itself - we'll be covering the setup and introductory phases. Next section, we'll be writing our first ever actual script, and we'll go on from there, but DO NOT skip this lesson. It's short, sweet, and gives you all the background one needs to go on.</p>
<p>I'll be covering a handful of setups that I find vital for programming in Lua. I'll be showing Notepad++, Visual Studio Code, and VSCode extension that helps debug your scripts. I find all of this to be essential, but you'll be safe with just starting as Notepad++ and returning for the rest later, when you feel more comfortable. For the love of all things holy, don't use Notepad basic.</p>
<p>This tutorial assumes you already have RPFM downloaded. If you don't yet, go grab it.</p>
<a class="header" href="#notepad-setup" id="notepad-setup"><h4>Notepad++ Setup</h4></a>
<p>First off, <a href="https://notepad-plus-plus.org/">we need to grab Notepad++</a>. Download it, install it wherever.</p>
<p>Notepad++ is a beautiful text-editing program, and we'll be using it for a couple things. At this point in my existence, I use Notepad++ mainly for global searching through libraries of scripts, it's a great way to quickly read very many scripts at the same time.</p>
<p>While you wait for Notepad++ to finish installing, you should open RPFM, and use the &quot;Open All CA Packs&quot; command (after making sure you have the proper game selected, under Game Selected).</p>
<p>Now, go find a spot to create a script dump folder. You'll need to grab all CA's vanilla scripts and put them somewhere on your PC - I recommend an HDD, if you have two drives! - in order to easily browse through their files. Once you have one created and pinned and you know where it is, go back to RPFM, and go find the main &quot;script&quot; directory. Right-click it and select &quot;Extract&quot;, and target the new folder you just made.</p>
<p>And, boom! You now have a script dump. I personally recommend renaming the &quot;script&quot; folder within your script dump folder to something like either the current patch of the game, or the current date. I do that so I can quickly reference different patches and compare versions when new DLC and updates are released.</p>
<p>Lastly, open up Notepad++, and press &quot;File -&gt; Open Folder As Workspace...&quot;. Target your renamed &quot;script&quot; folder within the script dump directory, and you'll notice that the directory appears on the left-hand side. If you right-click the main folder over there, and press &quot;Find in Files...&quot;, you'll be able to global-search all CA scripts. Incredibly handy for looking at their usage of commands, or to see any references to, say, a lord.</p>
<p>And that's Notepad++! You can make scripts in there as well, using &quot;File -&gt; New&quot; and naming it &quot;whatever_you_want.lua&quot; when saving. Though, I personally prefer using Visual Studio Code for programming in Lua (and it's what I'm typing this tutorial in), and that's where I have my IDE setup. If you're interested in VSCode, continue reading, if not carry on to the Hello World tutorial!</p>
<a class="header" href="#visual-studio-code-setup" id="visual-studio-code-setup"><h4>Visual Studio Code Setup</h4></a>
<p>Clearly, one needs Visual Studio Code. <a href="https://code.visualstudio.com/">Go get Visual Studio Code</a>.</p>
<p>You got it? No? Why are you reading this?</p>
<p>Okay, now you're ready? Good.</p>
<p>Visual Studio Code is really nice for a handful of reasons. You can save &quot;code workspace&quot; files, which allow you to easily access several folders or files that you have saved for one project. I can jump really easily between, say, my Return of the Lichemaster code workspace, and my Other Currently Secret Things code workspace, with only a couple clicks. It has a really pretty dark mode, and the syntax highlighting for Lua is gorgeous, in my opinion.</p>
<p>To use VSCode well, I suggest you setup one of these code workspaces, one for each project. To start, create a new folder on your PC, call it whatever you'd like. It's just to run through this example, so I don't really care. In VSCode, use File -&gt; Open Folder, and target that brand new folder.</p>
<p>Within VSCode now, you can create new folders, open extras, and all, and it will be within the same code workspace. I use this constantly to replicate the paths needed in CA packfiles to load scripts - so I'll make a /script folder in all of my workspaces, and I'll replicate my packfile directories within the VSCode workspace.</p>
<p>And that's it, VSCode is really simple to use (for our application atm). However, if we wanted to get more complicated and enable an IDE, keep reading!</p>
<a class="header" href="#kailua-setup" id="kailua-setup"><h4>Kailua Setup</h4></a>
<p>Within VSCode, click the bottom button on the far-left docker, the one with the title &quot;Extensions&quot;. Search for Kailua.</p>
<p><img src="images/3_1-01.png" alt="test" /></p>
<p>Install it, and enable it once it's finished installing (there will be a button saying &quot;Enable&quot;, if it says &quot;Disable&quot; just ignore it.)</p>
<p>Once you're done, open a new folder to work in within VSCode. The first thing you'll do is create a new folder in that folder (reference the image below), and name that folder &quot;.vscode&quot;.</p>
<p><img src="images/3_1-02.png" alt="test" /></p>
<p>Create a new file within the &quot;.vscode&quot; folder, and name that new file &quot;kailua.json&quot;. Within that file, input the following exactly:</p>
<pre><code class="language-json">{
   &quot;start_path&quot;: &quot;.vscode/entry.lua&quot;,
   &quot;preload&quot;: {
       &quot;open&quot;: [&quot;lua51&quot;],
       &quot;require&quot;: [&quot;.vscode/ca_types&quot;, &quot;.vscode/uimf_types&quot;]
   }
}
</code></pre>
<p>This file is the injection point for Kailua, so it knows what to do and how to do it. So you're aware for the future - the &quot;start_path&quot; directive tells it &quot;this file leads me to the other files that I have to read and error-check&quot;; the &quot;require&quot; directive tells it &quot;these files give me the definitions to check for errors.&quot; The ca_types.lua file defines many CA functions, so Kailua knows to look for two numbers when using the &quot;cm:random_number(max, min)&quot; command. The entry.lua file will be where we target our own files, to get them debugged.</p>
<p>Next up - let's create those three new files! In the same folder (.vscode), create entry.lua, ca_types.lua, and uimf_types.lua.</p>
<p>Now, shoot back to the Tools &amp; Resources page, and pick up the files of those same names, and copy-and-paste their contents in your new files.</p>
<p>And that's it! I would recommend regularly-ish checking for new ca_types.lua files within <a href="https://discord.gg/HFKff2y">the Modding Den</a>.</p>
<a class="header" href="#devtool-console" id="devtool-console"><h1>Devtool Console</h1></a>
<p>Throughout this tutorial series, I will be referencing the &quot;Devtool Console&quot;, a mod made by mklabs that allows one to run some Lua code while <em>in</em> the game. It's awesome, and I highly recommend it. I'll be suggesting you use it throughout the tutorial series. Do so.</p>
<p><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1574469690">The long and convoluted series of words that you should press on to download and subscribe to the Devtool Console.</a></p>
<p>The big thing to note is that, if you want to print stuff out onto the Devtool Console itself, you can replace out(text) with print(text). Likewise, some statements in Lua are too big to fit on one line in the Devtool Console, but you can have a statement span several lines if you'd like, as long as it doesn't involve assignment. If you don't know what I mean, read a couple lessons first and then come back.</p>
<a class="header" href="#hello-world" id="hello-world"><h1>Hello World!</h1></a>
<p>As with basically every programming tutorial on the globe, I'll begin where they all do - printing a message that says &quot;Hello World!&quot;</p>
<p>I'd like to quickly note that as this tutorial series progresses, I'm going to be helping less and less and explaining more and more. I don't want to hand-hold you through the entire project, and each lesson will include at least one &quot;challenge&quot;, where I give you an objective and tell you to go do it. Self-guided teaching is important, and once you're done this tutorial series, you'll be expected to be at least remotely competent and able to work this stuff out independently. I highly recommend you stick to the challenges and give them a shot, they'll benefit you if you really want to get good with Lua.</p>
<p>Alright, within your text editor of choice, create a new file. Within that file, type the following block:</p>
<pre><code class="language-lua">function testing_init()
    out(&quot;Hello World!&quot;)
end
</code></pre>
<p>This is our first look at functions, which I'll go much further in detail about next lesson. &quot;testing_init()&quot; is a function, which does the &quot;out(&quot;Hello World!&quot;) line when it's called. Likewise, &quot;out(&quot;Hello World&quot;)&quot; is a function of its own, and it prints the text within the brackets to a log.txt file, which CA uses for error-checking scripts and printing out details. We're using it for this first tutorial, but we'll see it many more times as we go on.</p>
<p>Save it, and save as &quot;testing_init.lua&quot; within your modding folder on your PC. Boom, your first Lua file. And you did it <em>all</em> by yourself!</p>
<p>Open up RPFM, and create a new packfile. Within the packfile, make the following script directory: &quot;script/campaign/mod&quot;. Within the &quot;/mod&quot; folder, add your testing_init.lua file. Save it as whatever you'd like.</p>
<p>I mentioned that the &quot;out()&quot; function is a CA function that prints text onto a log.txt file, but I missed a detail - on retail, that log file is never made. So, what we need to do is go and download/enable the <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1271877744&amp;searchtext=script+debug+activator">Script Debug Activator</a> mod, by theSniperDevil, which enables the creation of that log file.</p>
<p>Now go grab your new .pack file, and drop it into Steam/steamapps/common/Total War WARHAMMER II/data (which will here-to-for be referred to as <strong>/data folder</strong>). Enable the .pack file with the mod manager of your choosing, load up the game, and load up a campaign.</p>
<p>In your game folder (Steam/steamapps/common/Total War WARHAMMER II), you should see a new file - script_log_DDMMYY_HHMM.txt. Open that up with a text editor, use find to search for &quot;Hello World&quot;. If it's there, it worked, and if it isn't, something went fatally wrong! Go back and try again.</p>
<a class="header" href="#post-credits-explanations" id="post-credits-explanations"><h4>Post-Credits Explanations</h4></a>
<p>At this point, I'd like to quickly cover how CA loads and runs script mods for modders. There is a mod-script loader built into TW:WH2, and it's pretty simple for us to use. We can load our mods automatically in different game modes, using the following paths:</p>
<ul>
<li><strong>Campaign (Mortal Empires)</strong>: script/campaign/main_warhammer/mod</li>
<li><strong>Campaign (Vortex)</strong>: script/campaign/wh2_main_great_vortex/mod</li>
<li><strong>Campaign (either)</strong>: script/campaign/mod</li>
<li><strong>Battle (excluding quest-battles)</strong>: script/battle/mod</li>
<li><strong>Frontend</strong>: script/frontend/mod</li>
</ul>
<p>And lastly, there's one path that is available during all game modes, and loads before any of the other paths (so if you load campaign, and have a script in the following directory, it will be loaded before any in the script/campaign/mod directory). I must warn, though, that this directory should only be used if you're being very smart about what's within, making sure it's all game-mode-agnostic, or making sure you're checking for the game-mode within</p>
<ul>
<li><strong>Lib</strong>: script/_lib/mod</li>
</ul>
<p>Within each of these directories (barring the battle one), if you have a function named the same thing as the .lua file (like testing_init from our last example), it will be automatically called. We'll talk more about what this means, and some alternatives to this method that I prefer, but for now we'll stick with it. Remember, if the <strong>function name</strong> matches the <strong>file name</strong> of the script, then it'll be run, except when it's in the /battle directory.</p>
<a class="header" href="#challenge" id="challenge"><h4>Challenge</h4></a>
<p>And time for your challenge. We're going to start from the top. Make a brand new pack, and a brand new script file, with a new name. Have this print out the text &quot;Goodbye World!&quot; on to the log file, as before. This time, however, make it print while in the frontend game mode (post-startup menus to select between Custom Battle/Campaign and what not).</p>
<a class="header" href="#fun-stuff" id="fun-stuff"><h1>Fun Stuff</h1></a>
<p>For our second lesson, we're going to go right into something more complicated, and I'll give you a few challenges within this. I'll voice this note right at the beginning: <strong>you won't understand every single thing I use here</strong>, and that's literally the point. This second lesson is a quick, semi-complicated script to show you some of the possibilites of scripting, with some intro knowledge on new concepts, and the next few lessons following will go right back into the bare basics.</p>
<p>First up - challenge time!</p>
<a class="header" href="#challenge-1" id="challenge-1"><h4>Challenge 1</h4></a>
<p>Your first challenge is to make a new .pack file, with a single Lua file named &quot;example_script.lua&quot; that will load exclusively in the Eye of the Vortex campaign. Create a blank function within the Lua file, named as we addressed in the last lesson.</p>
<a class="header" href="#what-were-doing" id="what-were-doing"><h4>What We're Doing</h4></a>
<p>The project here is to build a slightly solid script that affects a good amount of change. What we'll have by the end of this lesson is a script that gives Lothern control over the Phoenix Gate at the start of a new campaign, and will spawn a new army automatically when the Cult of Excess faction is destroyed.</p>
<a class="header" href="#transfer-region-on-campaign-start" id="transfer-region-on-campaign-start"><h4>Transfer Region on Campaign Start</h4></a>
<p>First thing's first, let's grant the region to them! It's important to note <em>when</em> we call <em>what</em> in our scripts. For things we want to do only once, on game start, we can use a nice CA command, <code>cm:is_new_game()</code>. All that command does is check if it's the very first turn, and the game hasn't been saved yet. We'll use that within an &quot;if&quot; statement, as follows:</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so it'll run this stuff here
    else
        -- it isn't a new game, so it'll run this stuff here
    end
end
</code></pre>
<p>You might be wondering the point of those &quot;--&quot; bits. Those dashes - two are necessary - allow you to comment your script, which I will be doing quite a bit and try to make a habit of with all scripts. Everything on that line after the &quot;--&quot; is ignored, and allows you to write whatever you want. It's really helpful when you go and look back over very old scripts and are wondering why the heck you did something a certain way. I've been there many times.</p>
<p>You might be wondering about the &quot;if cm:is_new_game() == true then&quot; bit, too. More or less, when you use the command &quot;cm:is_new_game()&quot;, it returns a value of true/false, depending on whether or not it's currently a new game. We can read that value, like I show above, and go down different branches of our script depending on the answer.</p>
<p>In a future tutorial, I'll be showing how to find these commands and use them, but for now, blind faith will make this tutorial go quicker and easier.</p>
<p>On our &quot;if cm:is_new_game() == true&quot; branch, we'll be transfering the region over to Lothern. The command we need to use is <code>cm:transfer_region_to_faction(region_name, faction_name)</code>. region_name and faction_name are both database keys, easy enough to find using the Assembly Kit.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
    else
        -- it isn't a new game, so it'll run this stuff here
    end
end
</code></pre>
<a class="header" href="#challenge-2" id="challenge-2"><h4>Challenge 2</h4></a>
<p>This one's pretty simplistic, but it'll get harder, don't worry. For now, I would like you to give Lothern a second new region, and to output some text if it isn't a new game.</p>
<a class="header" href="#are-they-dead-yet" id="are-they-dead-yet"><h4>Are They Dead Yet?</h4></a>
<p>Alright, next step - we need to create something that checks if the Cult of Excess faction is dead, before we create the thing that'll spawn the new army.</p>
<p>And no, I won't give you the answers to that challenge above! Figure it out, chap!</p>
<p>First, a new concept - listeners. One of the lessons very soon, after the basics, goes over listeners in big depth, but suffice it to say: listeners are love, listeners are life. They allow you to &quot;listen&quot; for different things happening in the game - like a battle, a region being captured, a character dying - and to &quot;trigger&quot; a function afterwards. It's the mechanic that powers things like Legendary Lord/Rite unlocks, the Chaos Invasion in big part, post-battle Chivalry or Infamy gains, and a whooole lot more!</p>
<p>We're going to use a listener that &quot;listens&quot; for Lothern's turn to start, and it'll <em>check</em> to see if the Cult of Excess faction is dead-o-rama. If they are, it'll <em>trigger</em> the spawn of the new army.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        -- the second region you should've added in the challenge!
    else
        -- it isn't a new game, so it'll run this stuff here
        -- the output you should've added in the challenge!
    end

    core:add_listener(
        &quot;MyFirstListener&quot;,
        &quot;FactionTurnStart&quot;,
        function(context)
            -- is it Lothern's turn?
            return context:faction():name() == &quot;wh2_main_hef_eataine&quot;
        end,
        function(context)
            -- check to see if the Cult of Excess is living!
        end,
        true
    )
end
</code></pre>
<p>Again, don't fear - I'll cover all this in way more depth, and this is the last time I'm gonna give this warning or clarification. Just accept it.</p>
<p>To check if they're dead yet, we have to <em>get</em> the faction object, and run a quick check on if they're living or not. We can do that with the CA command <code>cm:get_faction(faction_name)</code>. That returns what CA calls a &quot;FACTION_SCRIPT_INTERFACE&quot;. You can run a lot of functions on a faction object, a &quot;FACTION_SCRIPT_INTERFACE&quot;, as one of them is <code>is_dead()</code>. You can see more if you go to the scripting-doc.html file in Tools &amp; Resources, and search for &quot;FACTION_SCRIPT_INTERFACE&quot;.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        -- the second region you should've added in the challenge!
    else
        -- it isn't a new game, so it'll run this stuff here
        -- the output you should've added in the challenge!
    end

    core:add_listener(
        &quot;MyFirstListener&quot;,
        &quot;FactionTurnStart&quot;,
        function(context)
            -- is it Lothern's turn?
            return context:faction():name() == &quot;wh2_main_hef_eataine&quot;
        end,
        function(context)
            -- define a local variable that can be used to shorthand the faction's name
            local excess_name = &quot;wh2_main_def_cult_of_excess&quot;

            -- define a local variable to access the FACTION_SCRIPT_INTERFACE for Cult of Excess
            local excess_faction = cm:get_faction(excess_name)

            -- check if they're dead, and if they are ... 
            if excess_faction:is_dead() == true then
                -- ... spawn that army!
            end
        end,
        true
    )
end
</code></pre>
<p>Sweet! This is our first look at variables and the keyword &quot;local&quot;, which defines where that variable exists and can be accessed. More on this later on!</p>
<a class="header" href="#spawn-that-aaaaarmy" id="spawn-that-aaaaarmy"><h4>Spawn That Aaaaarmy!</h4></a>
<p>We're coming up close to being done here! All we've gotta do left is spawn the army, and all I've gotta do is challenge you a couple more times!</p>
<p>The next and penultimate CA command we'll be using is <code>cm:create_force(faction_key, army_list, region_key, x_position, y_position, exclude_named_chars, success_callback)</code>. The parameter list looks slightly daunting, but if you take some time to critically think, the only strange thing should be the very last parameter - success_callback. Luckily for you, we won't even be using that one, really.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        -- the second region you should've added in the challenge!
    else
        -- it isn't a new game, so it'll run this stuff here
        -- the output you should've added in the challenge!
    end

    core:add_listener(
        &quot;MyFirstListener&quot;,
        &quot;FactionTurnStart&quot;,
        function(context)
            -- is it Lothern's turn?
            return context:faction():name() == &quot;wh2_main_hef_eataine&quot;
        end,
        function(context)
            -- define a local variable that can be used to shorthand the faction's name
            local excess_name = &quot;wh2_main_def_cult_of_excess&quot;

            -- define a local variable to access the FACTION_SCRIPT_INTERFACE for Cult of Excess
            local excess_faction = cm:get_faction(excess_name)

            -- check if they're dead, and if they are ... 
            if excess_faction:is_dead() == true then
                -- define a few local variables that we'll use in the command to save some space!
                local army_list = &quot;&quot;
                local region_key = &quot;wh2_main_vor_straits_of_lothern_lothern&quot;
                local x_position = 516
                local y_position = 430

                -- ... spawn that army!
                cm:create_force(
                    excess_name,
                    army_list,
                    region_key,
                    x_position,
                    y_position,
                    true,
                    function(cqi)
                    end
                )
            end
        end,
        true
    )
end
</code></pre>
<p>Those of you critically-thinking will notice that I kept a completely blank string for <code>army_list</code>. Guess what!</p>
<a class="header" href="#challenge-3" id="challenge-3"><h4>Challenge 3</h4></a>
<p>Create the army list! It's one single string, with unit keys separated by commas, NO spaces within the string. Give it a shot, I dare you.</p>
<p>HINT: If you're hitting a wall, global search CA scripts! I won't tell you <strong>what</strong> to search.</p>
<a class="header" href="#packaging-and-testing" id="packaging-and-testing"><h4>Packaging and Testing</h4></a>
<p>Alright, with the <code>army_list</code> string expanded, this mod should be fully functional. There is one definite bug that I know will exist, and I'll point out now - if there's a character already standing on (516, 430) game coordinates, the army will not spawn. Explaining how to avoid so would take more time than I want to spend on this lesson, so deal with it.</p>
<p>Your final task - start testing! If it doesn't work, here's a quick tip: use the out(text) function! You can use it throughout scripts to take a look at what's triggering and what isn't, like so:</p>
<pre><code class="language-lua">    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        out(&quot;It's a new game!&quot;)
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        out(&quot;Added Phoenix Gate&quot;)
        -- the second region you should've added in the challenge!
        out(&quot;Added the second region!&quot;)
    else
        -- it isn't a new game, so it'll run this stuff here
        out(&quot;It's not a new game!&quot;)
        -- the output you should've added in the challenge!
    end
</code></pre>
<p>And that's it, yo. Next up, we'll get down to the bare bones and get some great understanding! If some of this stuff didn't make sense, keep pushing on through the next few lessons where I break it down to the bit and hopefully give you a more fuller knowledge on the language. I gave you a glimpse at some story-telling; now let's go back and learn the alphabet, grammar, and colloquialisms.</p>
<a class="header" href="#chunks--statements" id="chunks--statements"><h1>Chunks &amp; Statements</h1></a>
<p>The first two terms we'll look at are <strong>chunks</strong> and <strong>statements</strong>. When Lua is brought to its basic skeletal structure, that's all it is - chunks of statements.</p>
<p><strong>Statement</strong>: A declaration, a thing-to-be-done, a command that Lua will run
<strong>Chunk</strong>: A sequence of statements, from an entire file to a single line of data</p>
<p>Every chunk is a to-do list, and a statement is an objective on that list. You can have to-do lists of all shapes and sizes, and each thing that needs to be done can be small - &quot;brushing your teet&quot; - or huge - &quot;spend way too much money on transmission repairs&quot;. No, I'm not still salty about the money I spent on transmission repairs, why do you ask?</p>
<p>The Lua interpreter divides everything it takes into specific chunks, which we'll look at later on. For now, we understand the term chunk - a to-do list.</p>
<p>Within each chunk is one or more statements. A statement is one coherent thought or action within Lua. Something like this can be one statement:</p>
<pre><code class="language-lua">a = 1
</code></pre>
<p>Or, this can be one statement:</p>
<pre><code class="language-lua">a = 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 - 1 / 70 * 300 + 5180 - 418 + 405
</code></pre>
<p>That is, one bit of data that Lua has to evaluate and run.</p>
<p>Remember the term &quot;chunk&quot; - we'll be covering how they're defined later on, when we look at some more keywords.</p>
<a class="header" href="#variables--types" id="variables--types"><h1>Variables &amp; Types</h1></a>
<p><em>NOTE: I recommend you have the Devtool Console handy to mess around with some of the stuff covered here.</em></p>
<p>Following the concept of chunks and statements, the next most important subject to cover is variables, and types.</p>
<p><strong>Variable</strong>: A custom-made keyword that can be used to represent a value
<strong>Type</strong>: The sort of value that is in a variable. Lua types include: boolean, string, number, table, nil, function. There are more, but we won't need them.</p>
<p>But before going deeper into a definition, let's look at an example:</p>
<pre><code class="language-lua">a = 10
b = 5
c = a + b
</code></pre>
<p>We can see that each of those letters in the chunk above is a <strong>variable</strong>, which are each assigned a <strong>value</strong>. In this case, variable <strong>a</strong> is assigned the value <strong>10</strong>, variable <strong>b</strong> is assigned the value <strong>5</strong>, and the variable <strong>c</strong> is assigned the <strong>value of a plus the value of b</strong>. This instance (c = a + b) works a lot like algebra - you aren't making &quot;c = ab&quot;, but you're adding the value of a (10) to the value of b (5), to get the result of <strong>15</strong>.</p>
<p>The coolest thing about variables is their dynamism. They can be assigned to any type, change to any type, and they can infinitely change values. Let's take the above code, and mess with it a little bit.</p>
<p><em>NOTE: From this point on, you'll see → after out() calls. This is to specify what text is actually output.</em></p>
<pre><code class="language-lua">a = 10
b = 5
c = a + b

out(a) → 10
out(b) → 5
out(c) → 15

a = 25
out(a) → 25

out(c) → 15

c = a + b
out(c) → 30
</code></pre>
<p>I wanted to point out an important thing with this example. If a variable is assigned to the values of some other variables (c = a + b), it will do the calculation and assignment the <strong>moment</strong> that the statement is called. If either variable (a or b) is changed after the assignment statement, the assigned variable's (c) value (15) won't change. It takes the <em>variable's value</em>, not the <em>variable itself</em>.</p>
<p>So, we see here that variables can be numbers, which is one of the primary types in Lua.</p>
<p><strong>Number</strong>: <em>any</em> numerical value, within a specific number range (a much bigger number than needs to be worried about)</p>
<p>As we saw above, we can perform some basic arithmetic on numbers.</p>
<pre><code class="language-lua">a = 5
b = 2 - 0.34
c = a + b
d = c * 2
e = d / 3

out(c) → 7.56
out(d) → 15.12
out(e) → 5.04
</code></pre>
<p><strong>String</strong>: <em>any</em> alphanumerical value, within quotation marks (&quot;&quot; or ''). Similar to numbers, size <em>does not matter</em>, Lua can handle millions of characters within a string.</p>
<p>Like arithmetic for numbers, one can concatenate strings (along with many other stuffs!) to combine several, using the <code>..</code> operator.</p>
<pre><code class="language-lua">    a = “This “; b = “is “; c = “an “; d = “example.”
    out(a .. b .. c .. d) → This is an example.
</code></pre>
<p><em>NOTE: Yes, you can have several statements on the same line in Lua! The semi-colons are not necessary, I added them for extra readability.</em></p>
<p>While on the subject, you can concat (cool-kid for concatenate) string literals and variables.</p>
<pre><code class="language-lua">    a = &quot;example&quot;
    out(&quot;This is an &quot; .. a) → This is an example
</code></pre>
<p><strong>Boolean</strong>: a <code>true</code> or <code>false</code> value.</p>
<pre><code class="language-lua">    a = false
    out(a) → false
    out(a == false) → true
</code></pre>
<p>The above probably looks a little weird, but that's because we're learning a new operator! The <code>==</code> operator checks for <em>equality</em>, whereas the <code>=</code> operator <em>assigns a value</em>. The final statement above reads &quot;output the result of a == false&quot;. Since <code>a</code> DOES equal false, it prints &quot;true&quot;.</p>
<p>It's very important to note that any variable can be <em>treated</em> as a boolean, such as when using the &quot;if something then&quot; statement, or by comparing it to a boolean. If a non-boolean variable is treated as a boolean, it will be converted to <code>false</code> if the value is <code>nil</code> or <code>false</code>; otherwise, it will be converted to <code>true</code>.</p>
<pre><code class="language-lua">    a = 0
    b = nil
    out(a) → 0
    out(a == false) → false 
    out(b == false) → true
</code></pre>
<p>In this case, <code>a</code> does NOT equal <code>false</code>, because it has a value to it that isn't <code>false</code> or <code>nil</code>. By the same card, <code>b</code> DOES equal <code>false</code>.</p>
<p>You're probably asking by now, what IS nil? I've mentioned it a number of times already, you're probably ready to lear about it. Here we go!</p>
<p><strong>Nil</strong>: the absence of data.</p>
<p>If one were to try to print a <em>non-existent</em> variable, the result would be <code>nil</code>. That's because there <strong>is</strong> no data for that variable.</p>
<pre><code class="language-lua">    out(a) → nil
    a = 5
    out(a) → 5
</code></pre>
<p>Nil is a good way to check whether or not something exists, and we'll, towards the bottom of this lesson, talk about how to type-check this data in our scripts to see if variables are NOT nil, and thus exist.</p>
<p>Nil is also a good way to clear away variables that you don't want to use anymore. There's a more realistic way of doing it, and this probably won't be necessary for most of what you will be doing, but I like to give a full knowledge.</p>
<pre><code class="language-lua">    a = 5
    out(a) → 5
    a = nil -- Memory deallocated, bye &quot;a&quot;!
    out(a) → nil
</code></pre>
<p>Lastly, it's important to note that <code>nil</code> is not the same as <code>null</code>, though they look quick similar. We'll cover that soon-ish, when we get into more CA script interfaces (like FACTION_SCRIPT_INTERFACE that we saw a few lessons ago).</p>
<p><strong>Function</strong>: a definition for a chunk that can be called at any point, after being defined.</p>
<p>There are two types of functions - an anonymous function, and a named function. An anonymous function has no name (clearly), so it cannot be called further on in the script. We use anonymous functions relatively frequently, but our focus now will be on named functions, which are functions assigned to a variable.</p>
<pre><code class="language-lua">    a = 10
    example = out
    example(a) → 10
</code></pre>
<p>Yes, that's valid! You can actually assign a variable to a function like, it's pretty cool! We have syntactic sugar for assigning a variable to a function, however, and it's more common to see script like that:</p>
<pre><code class="language-lua">    function example(text)
        out(text)
    end

    example(&quot;Testing!&quot;) → Testing!

    example(&quot;A Cooler Test!&quot;) → A Cooler Test!
</code></pre>
<p>As an added bonus, we're getting a quick sneak peak at one of the upcoming tutorials: parameters and arguments, for functions. In the above function, &quot;text&quot; is a parameter for <code>example()</code>, which is then passed along to <code>out</code> and triggers that function within the chunk.</p>
<p><strong>Table</strong>: a collection of more than one piece of data.</p>
<p>There are several types of tables, which we'll cover later on. I'd like to first look at the <em>array</em> version of tables, the simplest and most common.</p>
<pre><code class="language-lua">    a = 5
    b = 10
    c = 17

    table = {
        a,
        b,
        c
    } -- assign the three *values* of the variables to the table
    
    out(table[1]) → 5 -- Lua tables start at index 1!
    out(table[2]) → 10
    out(table[3]) → 17
    out(table[4]) → nil -- doesn't exist!
</code></pre>
<p>Arrays are numbered automatically, so it really reads &quot;the first index of table is 5, the second index of table is 10&quot;, and so on. You <em>access</em> those indexes by using the <code>\[num\]</code> operator, which we'll look further at in the next tables tutorial later on. The reason this works, however, is because Lua is automatically numbering these values, giving them a <em>key</em>. When you make an array like that, Lua reads it more like the following:</p>
<pre><code class="language-lua">    a = 5
    b = 10
    c = 17

    table = {
        [1] = a,
        [2] = b,
        [3] = c
    }
</code></pre>
<p>The other major type of tables is a <strong>map</strong>, which works by manually assigning the key of a value instead of letting Lua automatically number them, like in arrays.</p>
<pre><code class="language-lua">    a = 5
    b = 10
    c = 15

    table = {
        [&quot;five&quot;] = a,
        [&quot;ten&quot;] = b,
        [&quot;fifteen&quot;] = c
    }

    out(table[&quot;five&quot;]) → 5
    out(table[&quot;ten&quot;]) → 10
    out(table[&quot;fifteen&quot;]) → 15
</code></pre>
<p>Maps will come into some great use pretty soon, but for now I just wanted to introduce you to how they look.</p>
<p>For now, you've done well, and I haven't even challenged you yet!</p>
<a class="header" href="#challenge-1-1" id="challenge-1-1"><h4>Challenge 1</h4></a>
<p>Mess with everything in this tutorial using the Devtool Console. Try to grasp the different native types of Lua, and make sure you understand the difference between the <em>assignment</em> operator and the <em>equality</em> operator. There's not really a good challenge to do here, but I do seriously suggest you just mess around with the stuff here. Try some different things like concatenating strings, adding numbers, messing with basic functions, stuff like that. Have fun!</p>
<a class="header" href="#type-checking" id="type-checking"><h4>Type-Checking</h4></a>
<p>And before we say goodbye, let's look at a few more CA functions. These ones can type-check for us, seeing if a variable is, for instance, a string.</p>
<p>The list is as follows:</p>
<ul>
<li>is_nil(variable)</li>
<li>is_string(variable)</li>
<li>is_number(variable)</li>
<li>is_boolean(variable)</li>
<li>is_function(variable)</li>
<li>is_table(variable)</li>
</ul>
<pre><code class="language-lua">    a = 5
    b = nil
    c = {1, 2, 3, 5, 70}
    function d() end

    out(is_number(a)) → true    
    out(is_nil(b)) → true
    out(is_table(c)) → true
    out(is_function(d)) → true
</code></pre>
<a class="header" href="#expressions--operators" id="expressions--operators"><h1>Expressions &amp; Operators</h1></a>
<p>As we've seen, Lua is made up of <code>chunks</code> and <code>statements</code>. Statements can contain variables, and all variables have a type, though it can change at any point.</p>
<p><strong>Expressions</strong> are the section of a statement that, essentially, tell Lua <em>what to do</em>. They come in a billion different shapes and sizes. For now, we'll cover all the basics you'll need, and some basics you really don't need but I'll hand it to you anyway, and we'll go back and review some older stuff. Here we go!</p>
<a class="header" href="#math-operators" id="math-operators"><h4>Math Operators</h4></a>
<p>Sweet. This is what all of those quizzes in grade school trained you for. We have the big four from algebra - addition, subtraction, multiplication, and division.</p>
<pre><code class="language-lua">    out(2 + 3) → 5
    out(5 - 1) → 4
    out(16 * 3) → 48
    out(9 / 3) → 3
</code></pre>
<p>We can also use a <code>-</code> to <em>negate</em> a value, or, in simple terms, turn a positive number into a negative and vice versa.</p>
<pre><code class="language-lua">    a = 10
    b = -20
    out( -a ) → -10
    out( -b ) → 20
</code></pre>
<p>We also have a couple other fun math things. We can raise numbers to any power, using an exponential expression.</p>
<pre><code class="language-lua">    a = 2
    b = 4
    c = 3
    out( a^a ) → 4
    out( b^c ) → 64
    out( 64^0.5 ) → 8 -- getting the square root of a number!
</code></pre>
<p>We can also use some modulo math. It's a way of dividing two numbers that gives you the amount <em>remaining</em>, and it's a great way to read if a number is a <em>multiple</em> of another.</p>
<pre><code class="language-lua">    out(8 % 2) → 0 -- 8/2 = 4, and divides evenly, so nothing is remaining!
    out(7 % 2) → 1 -- 7/2. &quot;6/2&quot; divides evenly, so we subtract 6 from 7, and get &quot;1&quot; as the remainder!
    out(8 % 3) → 2 -- 8/3. &quot;6/3&quot; divides evenly, so we subtract 6 from 8, and get &quot;2&quot; as the remainder.
</code></pre>
<p>As said, it's a great way to read if a number is a multiple of another. If a modulo expression returns &quot;0&quot;, that means it divided evenly, and is therefore a multiple of the number divided by.</p>
<p>And that's math!</p>
<a class="header" href="#comparison-operators" id="comparison-operators"><h4>Comparison Operators</h4></a>
<p>This sounds a lot more complicated than &quot;math&quot;, eh? It's not that complicated - we're comparing how two variables relate to one another, using expressions we've all seen before. The list of comparison operators are as follows:</p>
<p>&lt; -- &quot;less than&quot;
&gt; -- &quot;greater than&quot;
&lt;= -- &quot;less than or equal to&quot;
&gt;= &quot;greater than or equal to&quot;
== &quot;equal to&quot;
~= &quot;not equal to&quot;</p>
<p>All of these expressions result in a boolean value.</p>
<pre><code class="language-lua">    a = 10
    b = 7 + 3
    out(a == b) → true -- they ARE equal!
    out(a ~= b) → false -- they ARE NOT not equal (weird, I know)!

    c = 8
    d = 7
    
    out(c &gt; d) → true -- 8 is greater than 7
    out(c &lt; d) → false -- 8 is NOT less than 7
</code></pre>
<p>It's important to note that Lua will consider different types to be different values. A string and a number will always be different. Lua will throw an error if you attempt to compare - using less-than or greater-than - any two separate types. Lua will not throw an error for &quot;==&quot; and &quot;~=&quot;, however, and if they are separate types, they will always be inequal.</p>
<pre><code class="language-lua">    a = 15
    b = &quot;15&quot;
    out(a == b) → false -- they are different types!
    out(a &gt;= b) → error (attempt to compare number with string)
</code></pre>
<p>Do note that you can compare strings using greater or less than, but it compares the alphanumerical order of the first character. “0” is less than every number or letter, whereas “a” is greater than every number and less than every letter, and “z” is greater than every number or letter. Again, not really important, but you came here to read me ramble on about random stuff.</p>
<p>And that ends our comparison operators!</p>
<a class="header" href="#logical-operators" id="logical-operators"><h4>Logical Operators</h4></a>
<p>Next up are our logical operators! We have three operators to concern ourselves with here - <strong>and</strong>, <strong>or</strong>, and <strong>not</strong>.</p>
<p><em>Not</em>, as a logical operator, is pretty simple and super handy. It basically converts the value to the right of it into a boolean, and reverses it. Any value other than <code>nil</code> or <code>false</code> will be converted into <code>false</code>, and <code>nil</code> or <code>false</code> will be converted to <code>true</code>. Let's take a look:</p>
<pre><code class="language-lua">    a = true
    b = nil
    out(not b) → true -- prints a double negative - not false, so true
    out(not a) → false -- reverses the value of &quot;true&quot;

    c = 100
    out(c) → 100
    out(not not c) → true -- c is a number, &quot;not c&quot; would become &quot;false&quot;, and &quot;not false&quot; would become &quot;true&quot;
</code></pre>
<p>The operators <strong>and</strong> and <strong>or</strong> are the hearts of a lot of logic in Lua. &quot;If this and this, then do this&quot;.</p>
<pre><code class="language-lua">    a = 15
    b = false
    if a == 15 and not b then -- &quot;if a is equal to the number fifteen, and &quot;not b&quot; returns true, then ... &quot;
        out(&quot;It does the thing!&quot;) -- &quot; ... print the text! &quot;
    end
</code></pre>
<p>You'll practically always see these two used in this way, for <em>conditional statements</em> like that - if these conditions work out, then do this other thing.</p>
<a class="header" href="#homeless-operators" id="homeless-operators"><h4>Homeless Operators</h4></a>
<p>I don't really have a category for these two operators, but they're incredibly important.</p>
<p>First off, we have <strong>concatenation</strong>, which we've seen before. It's a way to add two strings together, and make them into one happy family, using a simple pair of dots.</p>
<pre><code class="language-lua">    a = &quot;Hello&quot;
    b = &quot;World!&quot;
    out(a .. &quot; &quot; .. b) → Hello World!
</code></pre>
<p>A couple of notes real quick - I have the blank space in a string in the middle, to make sure it doesn't print &quot;HelloWorld!&quot;. Also, I like to add spaces on either side of my concatenation operator, but that's personal taste, this would also be valid:</p>
<pre><code class="language-lua">    out(a..&quot; &quot;..b) → Hello World!
</code></pre>
<p>And lastly, we have one more operator, and this time for the table type. The character <code>#</code> can be used to read the number of entries within an array. It's pretty awesome, let me show you:</p>
<pre><code class="language-lua">    table = {&quot;this&quot;, &quot;is&quot;, &quot;an&quot;, &quot;example&quot;, &quot;array&quot;}
    out(#table) → 5 -- there are five strings within the table!
</code></pre>
<p>Please note that you really shouldn't use the <code>#</code> operator if the table is not definitely an array. I'll show you why using it on maps might mess something up:</p>
<pre><code class="language-lua">    table = {
        [1] = &quot;test&quot;,
        [2] = &quot;example&quot;,
        [5] = &quot;boom&quot;,
        [7000] = &quot;woo&quot;,
        [3] = &quot;argh&quot;
    }

    out(#table) → 7000
</code></pre>
<p>In technicalities, it's doing that because it's reading the <em>highest index in that table</em>, or the highest numerical key. Those are assigned automatically, in order, for arrays; in maps, there's no such guarantee.</p>
<a class="header" href="#challenge-1-2" id="challenge-1-2"><h4>Challenge 1</h4></a>
<p>As with last, no challenge! We have only a couple more lessons to do before we get into the REAL nitty-gritty, and once we do there will be a lot of nice challenges. For now, keep messing with this stuff in the DevTool Console, test around.</p>
<a class="header" href="#scopes--stuff" id="scopes--stuff"><h1>Scopes &amp; Stuff</h1></a>
<p>A super important concept in Lua is the concept of <em>scope</em>. Every single variable made has a <em>scope</em>, which is used to define <strong>where</strong> a variable can be accessed.</p>
<p>By default, all variables are <code>global</code>, which means they're in the entire <strong>global environment</strong>. The global environment is a slightly-fancy way of saying &quot;available within the entire program&quot;. When writing Total War scripts, it's a little suboptimal to use global variables, for a few reasons -
1) What if someone else wants to use a variable named <code>a</code>, and you do as well? This would force you to have a fully unique name for every single variable everywhere. Kinda a pain!
2) Saving that variable globally is taking up memory, since that variable will never be destroyed. It will take a lot of work to actually cause performance issues, but it's good to be mindful of.
3) What if we want our variable to be a secret? Huh? They can't get our birthday present! <em>gollum</em></p>
<p>And all this is where the keyword <code>local</code> comes in. The <code>local</code> keyword defines a specific scope for a variable, and prevents them from being a global variable.</p>
<pre><code class="language-lua">function example()
    local var = &quot;Hello World!&quot;
    out(var)
end

example() → Hello World!
out(var) → nil -- the variable &quot;var&quot; doesn't exist here!
</code></pre>
<p>In this example, the variable <code>var</code> is defined within the function <code>example</code>'s definition. That means that <code>var</code> is only available from <em>where it is defined</em> (ie. local var =) to <em>where the scope ends</em>. In this case, the scope <em>ends</em> at the <code>end</code> keyword.</p>
<p>This is as good a time as any to look at the other ways scope can be defined. A variable can be scoped to the <em>root</em> of a script, or any number of nestled scopes within that root.</p>
<p>Other key-words other than <code>function</code> that define a scope (and their end point) are as follows:</p>
<ul>
<li>do --[[ the scope ]] end</li>
<li>function function_name() [[ the scope ]] end</li>
<li>if whatever then [[ the scope ]] end</li>
<li>while whatever then [[ the scope ]] end</li>
</ul>
<p>Let's take a slightly-complicated look at that:</p>
<pre><code class="language-lua">local a = 5 -- visible to everything BELOW this line!

function example_thing()
    local b = a -- visible to everything BELOW this line, until the &quot;end&quot; that matches &quot;function&quot;
    do 
        local c = 15 -- visible to everything BELOW this line, until the &quot;end&quot; that matches &quot;do&quot;
        out(c)
        out(b) 
    end
    out(b)
    -- c is NOT available here!
end

-- b and c are NOT available here!
out(a) → 5
</code></pre>
<p>This is a good point as any to explain two things, and issue two directives:</p>
<ol>
<li>ALWAYS use the keyword <code>local</code>.</li>
<li>ALWAYS use good indentations!</li>
</ol>
<p>Be smart with where exactly the term &quot;local&quot; is used - you'll pick up how later on as you go and pick my brain, but for now, understand that you must ALWAYS put the keyword <code>local</code> before a variable!</p>
<p>As you can see with the example_thing() function above, proper indentation is a GREAT way to visibly see scopes and quickly tell where a variable is and isn't available.</p>
<a class="header" href="#functions-arguments--parameters-also-returns" id="functions-arguments--parameters-also-returns"><h1>Functions, Arguments &amp; Parameters (Also, Returns)</h1></a>
<p>Welcome back! On today's lesson, we're going to cover one of the most fundamental types in Lua much further, and that type is, if you can read, <em>functions</em>. Everybody loves functions.</p>
<p>Functions are a special data type in Lua. Functions have two specific stages: <strong>definition</strong>, and <strong>call</strong>. A function can be defined as many times as one would like, but it will not do anything until the function is <em>called</em>. Quick look, followed by a breakdown:</p>
<pre><code class="language-lua">    -- DEFINE the function, which we can call and trigger later on, as much as we'd like
    function example_function()
        out(&quot;This is your example function&quot;) -- at this point, nothing is output
    end

    -- actually calling the function to trigger the out!
    example_function() → This is your example function
</code></pre>
<p>And that's the basics of it! We should note that in this example, <code>example_function</code> is actually a variable name. The above is syntactic sugar for the following:</p>
<pre><code class="language-lua">    example_function = function()
        out(&quot;This is your example function&quot;)
    end
</code></pre>
<p>But the other way is a lot more common, and probably prettier for all eyes. On the case of syntactic sugar, you can simply put the keyword <code>local</code> prior to the keyword <code>function</code>, and it will make it a local variable. I'll be doing that from now on, to beat that idea in your own head.</p>
<p>Since the name of a function is just a variable, it can be redefined, and even as a different type. If a variable is defined more than once, the latest definition will &quot;win&quot;.</p>
<pre><code class="language-lua">    local function example_function()
        out(&quot;This is your example function&quot;)
    end

    example_function = 10 -- Why would ANYONE do this?!

    example_function() → attempt to call global `example_function`, a number value
</code></pre>
<p>The term &quot;call&quot; here is what I mentioned earlier - the <em>call</em> phase of a function. A call to a function is triggered by those two brackets - <code>()</code>.</p>
<p>At this point, we have a function that prints the same text over and over again. Let's give it some way to change the text based on some dynamism!</p>
<pre><code class="language-lua">    local function example_function(text)
        out(text)
    end

    example_function(&quot;Testing&quot;) → Testing
    example_function(&quot;Example!&quot;) → Example!
</code></pre>
<p>The term &quot;text&quot; is a <code>local variable</code> for that function, available in the entirety of that function's scope. It goes &quot;out of scope&quot; (as the cool kids say) by the <code>end</code> keyword. This is another clever shorthand that the Lua languages gives to us. Use it!</p>
<p>A clarity-for-clarity's-sake note here: in the above example, &quot;text&quot; is a <em>parameter</em>, which is the fancy word for a local variable assigned to the function's scope. The string &quot;Testing&quot;, or the string &quot;Example!&quot;, are <em>arguments</em>, which is a variable or value that is &quot;passed&quot; into the function and takes the place of the parameter at runtime. We can think of a parameter as a &quot;fill-in-the-blank&quot; space on an entry form, and the argument as whatever we fill in there.</p>
<p>One final thing we should know about before we go on is <em>return values</em>. In the above, we're just passing stuff <em>into</em> a function. But what if I want to take stuff <em>out</em> of a function? Well, return values, of course!</p>
<p>The keyword <code>return</code> is neat, and two-fold. Its first, and primary purpose, is to take whatever is to the right of it and shoot it back out, if the function is called. Its second, and still very-important, purpose is to stop the function once the keyword is called. Let's take a look at a common example of return values:</p>
<pre><code class="language-lua">    local function double(num)
        -- if the parameter is not a number type, then output some text and then STOP the function, to prevent it from going on
        if not is_number(num) then
            out(&quot;double() called, but you didn't supply a number! Aborting function!&quot;)
            return
        end

        -- if the parameter is a number type, then double it and return it! (we can safely assume that &quot;num&quot; IS a number, because otherwise the function wouldn't go this far)
        local val = num * 2
        return val
    end

    local a = 2
    out(a) → 2

    -- define a local variable as the RESULT of &quot;double(a)&quot;
    local b = double(a)
    out(b) → 4
</code></pre>
<p>You can return any type, and you can even return multiple values at once. Say you wanted to take the above function, but instead of just doubling the number, you <em>also</em> tripled it, and wanted to get both values.</p>
<pre><code class="language-lua">    local function double_and_triple(num)
        -- if the parameter is not a number type, then output some text and then STOP the function, to prevent it from going on
        if not is_number(num) then
            out(&quot;double_and_triple() called, but you didn't supply a number! Aborting function!&quot;)
            return
        end

        local double = num * 2
        local triple = num * 3

        -- this is it, just separate the return values or variables with a comma!
        return double, triple
    end

    local number = 5

    local d, t = double_and_triple(number)
    out(d) → 10
    out(t) → 15
</code></pre>
<p>I'd like to point out that I'm changing the names of my variables to point out that <em>the name of parameters can be whatever you want</em>. Don't be confused by me defining the function as <code>local function double_and_triple(num)</code> and calling it using <code>double_and_triple(number)</code>. <code>num</code> is a local variable, available only in the SCOPE of the function, whereas <code>number</code> is a <em>different</em> local variable, available to a higher scope but below the function definition.</p>
<p>At this point, we've got all the background knowledge really needed to start doing some more cool stuff! In the next lesson, we'll learn more about script interfaces, we'll go further in-depth about listeners (which we briefly used in lesson #2), and we'll talk about commands and how to check for existing ones! And you'll have A CHALLENGE!</p>
<p>WOO!</p>
<a class="header" href="#commands-interfaces--listeners" id="commands-interfaces--listeners"><h1>Commands, Interfaces &amp; Listeners</h1></a>
<p>For today's lesson, the subject is three-fold: <strong>commands</strong>, <strong>interfaces</strong>, and <strong>listeners</strong>. We've looked at all three of these before - all in lesson #2 - but in this lesson, we'll be going way further in-depth so you might have a better grasp of all of those subjects.</p>
<a class="header" href="#commands" id="commands"><h4>Commands</h4></a>
<p>A command, put <em>simply</em>, is a CA-defined Lua function that does some cool stuff that we can't do. We've seen a few already - <code>cm:transfer_region_to_faction()</code> and <code>cm:create_force()</code>. Commands are used to communicate between the Lua environment and the actual Total War Engine - the base C++ code that defines the majority of the game.</p>
<p>Through these commands, we can script a whole lot of stuff! From character spawns, to new effects applied to characters and factions and armies, to quest battles, to unlocking rites, and so on.</p>
<p>In big part, commands make or break what can be done with scripts. Commands are the driving force of most any script. At this point, though, you might be asking - &quot;how the HECK do I find out what the commands are?&quot; And that, my friend, is why you're reading this lesson. Or maybe you got lost when you were just trying to find funny videos about cats. Either way, next paragraph!</p>
<p>So, once more in the <a href="./chapter_1.html">&quot;Tools &amp; Resources&quot;</a> page on this site, there's a section within called &quot;Scripting Resources&quot;. We'll look at, first, the &quot;Scripting Doc (CM Functions)&quot; file. Open it up!</p>
<p>Now, before we go on, one thing MUST be covered. <strong>EVERY command in this document needs to have a prefix of <code>cm:</code>.</strong></p>
<p>In this document, let's take a look at the two commands that we've used already.</p>
<pre><code class="language-lua">    Command: 	transfer_region_to_faction	
    Description: 	Transfer a region ownership to a faction.	
    Usage: 		transfer_region_to_faction(&quot;region&quot;, &quot;faction&quot;)
</code></pre>
<p>This is relatively straightforward. The <code>Command:</code> line tells you what to affix to <code>cm:</code>, so this would be <code>cm:transfer_region_to_faction</code>. Since it's a <em>function call</em>, which we learned about just last episode and you wouldn't dare forget so soon, we add the brackets to it: <code>cm:transfer_region_to_faction()</code>.</p>
<p>We can see in <code>Usage:</code> that it takes TWO parameters. They seem to be strings, one of which says &quot;region&quot;, the other &quot;faction&quot;. It's easy enough to tell that means &quot;the region key in string&quot;, and &quot;the faction key in string&quot;. So, overall, the command call would look like this: <code>cm:transfer_region_to_faction(&quot;phoenix_gate&quot;, &quot;eataine&quot;)</code>.</p>
<pre><code class="language-lua">    Command: 	create_force	
    Description: 	create a navy or army at a position.  Final parameter specified whether the command goes via the command queue	
    Usage: 		create_force(&quot;faction_key&quot;, &quot;unit_list&quot;, &quot;region_key&quot;, x_position, y_position, exclude_named_characters, &quot;id&quot;, true)
</code></pre>
<p>The same applies here. <code>cm:create_force()</code>, with a bunch of parameters. You might notice, however, that it's <em>completely different</em> compared to what we used before. Instead of <code>&quot;id&quot;</code>, we used <code>success_callback</code>, and there WAS no parameter after that. What the heck? Let's back-up and talk about why.</p>
<p>The commands in this document are commands to the <em>game interface</em>, something that you really should never, ever touch directly, for fear of crashing the game if you mess something up. These functions -<code>cm:create_force()</code> - are <em>wrappers</em>, over that base command, so we don't have to directly touch the game interface directly. Using the CA functions will quickly error-check our code, and prevent any such crashes (when wrappers for those commands exist!). But what do I mean? Let's open up our script dump and go to script/_lib/lib_campaign_manager.lua, and search for <code>create_force(</code>.</p>
<p>We'll see a line that looks similar to what I have already shown you - <code>function campaign_manager:create_force(faction_key, unit_list, region_key, x, y, exclude_named_characters, success_callback)</code>. This is the <em>wrapper</em>. Within this function, lower down at the bottom, we can see the call to the game interface - <code>self.game_interface:create_force(faction_key, unit_list, region_key, x, y, id, exclude_named_characters, true);</code>. This looks a lot closer to the definition CA has in their documentation, and I belive it was the definition they were trying to go with. Not sure though!</p>
<p>In these situations, it pays to be careful. I advise you to use the CM Scripting Doc cautiously. It isn't fool-proof, and every change that CA has made over the years hasn't been recorded in there - there are commands listed that haven't been functional since Total War: Empire. This is when I point you back to the <a href="./chapter_3_1.html">Setup lesson</a>, if you haven't done that, and tell you to go do it. There are three hyper important tricks in there that will help you understand what to do in a situation like this:</p>
<ol>
<li>
<p>Check the lib files! Most functions in this document will be in <code>lib_campaign_manager.lua</code>. Bonus, as you could see with the above example, CA gives a quick explanation for what the function does and what the types are, and where they are found. This is always my first check</p>
</li>
<li>
<p>Use the script dump! All you have to do is use &quot;Find In Files ... &quot; within Notepad++, type in the name of the command (ie. <code>create_force</code>), and wait for it to search all the files. It will come up with some hits, and you can read through CA scripts to see what they do and how it's used.</p>
</li>
<li>
<p>Use Kailua! It might take some time to fully understand the <code>ca_types.lua</code> file that we've made for TW:WH2, but it should be pretty easy to <em>read</em> it if you want to know the parameters of a function. Open <code>ca_types.lua</code>, within VSCode (or whatever), search for the name of the command again (<code>create_force</code>), and it will show you some neat stuff. I'll go over what it looks like now, just so you know:</p>
</li>
</ol>
<pre><code class="language-lua">--# assume CM.create_force: method(
--#     faction_key: string,
--#     unitstring: string,
--#     region_key: string,
--#     xPos: number,
--#     yPos: number,
--#     exclude_named_chars: boolean,
--#     callback: (function(CA_CQI))?
--# )
</code></pre>
<p>Each of these lines is a <em>parameter</em>, and it's split into a name and a type. The name is just a description of what should go there - a faction key, a region key, etc., - and the type defines, of course, the type!</p>
<p>There's a third example I'd like to go into, which is return types via the CA commands. It works just like regular return values (seen from the <a href="./chapter_3_1_7.html">last lesson</a>), but sometimes the return value is vague, and it's really hard to read using CA's scripting doc. Again, utilize the script dump and Kailua. In Kailua, it'll look a little different - let's grab an example of a command with a return value.</p>
<pre><code class="language-lua">--# assume CM.get_saved_value: method(valueKey: string) --&gt; WHATEVER
</code></pre>
<p><em>NOTE: <code>WHATEVER</code> is a beautiful keyword in Kailua that lets you not define the type of a value, instead of saying &quot;return a number&quot; it says &quot;return literally whatever&quot;</em></p>
<p>Some functions in the ca_types files have a <code>--&gt;</code> to their end; on the right side of that arrow is the return value. Easy enough to read!</p>
<p>And that's my explanation of CA commands! Hope you had as much fun as I did.</p>
<a class="header" href="#interfaces" id="interfaces"><h4>Interfaces</h4></a>
<p>Similar to commands, script interfaces are a way to access some game data with some Lua. We looked at them previously - in the second lesson, we used a <code>FACTION_SCRIPT_INTERFACE</code>, which we got by using the command <code>cm:get_faction(&quot;faction_key&quot;)</code>.</p>
<p>Script interfaces are objects that we can apply some functions <em>to</em> (functions applied to an object are known as methods, but we'll talk about that terminology later). In our previous example, we did the following:</p>
<pre><code class="language-lua">    local excess_faction = cm:get_faction(excess_name)
    if excess_faction:is_dead() == true then
</code></pre>
<p>Wherein, of course, <code>excess_name</code> was a local variable a bit further up. In this example, <code>cm:get_faction()</code> has a <em>return value</em> of a <code>FACTION_SCRIPT_INTERFACE</code>, which we assigned to the local variable <code>excess_faction</code>. <code>FACTION_SCRIPT_INTERFACES</code> have a method called <code>is_dead()</code>, which lets us read if the faction is, well... dead. But how did I know to use that? <em>gasp</em></p>
<p>Also similar to commands, script interfaces are documented with a slightly-questionable CA file, though this one is typically waaaay more reliable, if a bit inconsistent with some naming. We can, again, grab it from the <a href="./chapter_1.html">Tools &amp; Resources</a> page, this time under the title &quot;Scripting Doc (Events &amp; Interfaces). Our big focus for now is the latter half of that name - Interfaces - though we'll be getting into events right in the next section below!</p>
<p>Open your newest Scripting Doc, and search for <code>FACTION_SCRIPT_INTERFACE</code>. It should be towards the top of the document, right near the word &quot;Interfaces&quot; in big boldage. Like this: <strong>Interfaces</strong>. Cool, found it? Click it!</p>
<p>You should get a big, long list of blue links, followed by more clear definitions. A typical entry here would look similar to the follows (because the following <em>is</em> an entry here):</p>
<pre><code class="language-lua">Function: holds_entire_province
Description: Does this faction hold the entire specified province? Also may include vassals
Parameters: holds_entire_province(String province, bool include_vassals)
Return: bool
</code></pre>
<p>As before, like the commands above were done with a prefix of <code>cm:</code>, these interface functions are done with a prefix of that script interface. But it won't just be <code>FACTION_SCRIPT_INTERFACE:holds_entire_province</code>, that makes no sense! In our previous, excess-based example, it would look like the following:</p>
<pre><code class="language-lua">    local excess_faction = cm:get_faction(excess_name)
    if excess_faction:holds_entire_province(
</code></pre>
<p>The second line - description - is quite obvious. It's just a description. Read it, don't read it, I don't care.</p>
<p>Parameters! We talked about this recently, you remember it right? It'll be a type and a very brief stand-in name to explain what should go there. In this case, you can tell that it wants the key of the province, in strings, and a boolean that determines whether or not you'd like to include vassals in the check. Sometimes, they'll just put the stand-in name in quotation marks to show that it should be a string.</p>
<p>Return values are much the same. Sometimes there will be returns of other script interfaces, and that's how you can start getting some fun stuff. With a <code>FACTION_SCRIPT_INTERFACE</code>, you can use <code>character_list()</code> to get a <code>CHARACTER_LIST_SCRIPT_INTERFACE</code>, and then use <code>item_at()</code> to get a <code>CHARACTER_SCRIPT_INTERFACE</code>, and then use <code>get_forename()</code> to get a string. That'll look like:</p>
<pre><code class="language-lua">    local faction = cm:get_faction(&quot;whatever&quot;)
    local character_list = faction:character_list()
    local character = character_list:item_at(0)
    local forename = character:get_forename()
</code></pre>
<p>I will note that you don't have to assign everything a local variable here. It can look, albeit much uglier and less safe, like this:</p>
<pre><code class="language-lua">    local forename = cm:get_faction(&quot;whatever&quot;):character_list():item_at(0):get_forename()
</code></pre>
<p>But I do not recommend doing something like this, until you're very comfortable with the language. I do it very, very, very rarely, only when it makes perfect sense to do it, and that's lie-talk for &quot;when I'm tired and it makes perfect sense to my tired brain&quot;.</p>
<p>Script interfaces are stupidly, stupidly powerful, and using all these smartly allows you to make some serious change within the game, and to read a lot more details, from &quot;how many units are in this army&quot; to &quot;what level is this character&quot; to &quot;how many armies were in the last battle?&quot; But, above all, these interfaces are used <em>best</em> and <em>most powerfully</em> when used in conjunction with listeners and events.</p>
<p>What are listeners and events? Ah, well...</p>
<a class="header" href="#listeners-and-events" id="listeners-and-events"><h4>Listeners and Events</h4></a>
<a class="header" href="#listeners" id="listeners"><h1>Listeners</h1></a>
<a class="header" href="#can-you-hear-me" id="can-you-hear-me"><h3>Can You Hear Me?</h3></a>
<p>A listener is an important script command that, simply, waits for something to happen - or, <em>listens</em> for something to happen - in the game, and then triggers something else. Using a listener, we can listen for an event such as the creation of an army, the occupation of a city, or even a battle, and then we use the information from that situation, check for something specific, and run our code if the event matches our criteria. For example: we may be looking for Mannfred to occupy Altdorf. In this case we'd have to use a listener to &quot;listen&quot; for a city being occupied, but we don't want to listen for just <em>any</em> city being occupied. In our example, we have to listen for Altdorf being occupied, and for Mannfred doing the occupying. The listener will listen for every single time a city is occupied, and once those two conditions are met - <em>Mannfred</em> occupying <em>Altdorf</em>... Clue, anyone? - then our listener will trigger some code. In layman's code, our listener will <em>do a thing</em>!</p>
<p>Overall, it is a very valuable connection between Lua and game data, and any scripter should understand the in's and out's of a listener.</p>
<p>Let's break down the basics of a listener. Here is it, at its most basic form:</p>
<pre><code class="language-lua">core:add_listener(
    &quot;listener_name&quot;,
    &quot;event_name&quot;,
    boolean1,
    function(context)
    end,
    boolean2
)
</code></pre>
<ul>
<li>&quot;listener_name&quot;: Can be whatever you want it to be! (Keep in mind if you share the same listener_name as another listener, and that name is called with core:remove_listener(&quot;listener_name&quot;), one of those listeners will be removed, and it'd be hard to tell which would be. Use unique names!)</li>
<li>&quot;event_name&quot;: This must be one within a set of Events that CA defines. You can view this <a href="https://cdn.discordapp.com/attachments/531219831861805069/569627247217082387/scripting_doc.html">list here</a>. We'll cover this list more in depth later on.</li>
<li>boolean1: This is the &quot;conditional&quot; boolean. If it is set to true, the function to execute will execute; if it is set to false, the function will not execute.</li>
<li>function: This is the &quot;callback&quot; function, which only runs if the conditional boolean returns as true. Can be whatever valid function you want! Note that it MUST have the format of &quot;function(context) --[[....]] end,&quot;</li>
<li>boolean2: This is the &quot;persistence&quot; boolean. If it is set to true, the listener will continue listening. If it is set to false, the listener will be removed from the game data.</li>
</ul>
<a class="header" href="#ca-events" id="ca-events"><h3>CA Events</h3></a>
<p>Just kidding.</p>
<p>Let's talk more in detail about the Events I mentioned.</p>
<p>As previously clarified, Events are predefined objects that are used exclusively in tandem with Listeners. A full list of Events, and all of their methods, and all of the interfaces, can be found <a href="https://cdn.discordapp.com/attachments/531219831861805069/569627247217082387/scripting_doc.html">here</a>. Let's go over how to use this document!</p>
<p>At the top of the document is a long list of Events, each clickable to divert to another part of the document. Each of these Events have specific usage. It should be noted here that documentation on some events is rather light, ie. when to use certain ones versus others, but a lot can be found out by looking at vanilla scripts or other mods. ((NOTE: Flesh out a full Events page to detail each Event))</p>
<p>I want to start a new function after the player takes over Altdorf. After searching the term &quot;Occup&quot;, the event &quot;GarrisonOccupiedEvent&quot; is highlighted. This looks promising! After clicking, the available functions are &quot;garrison_residence&quot; and &quot;character&quot;, which seem to be the region that was occupied, and the character that led the assault, in order.</p>
<a class="header" href="#conditional-coding" id="conditional-coding"><h3>Conditional Coding</h3></a>
<p>Remember &quot;boolean1&quot; from up above? If that is set to true/false, it's not really effective code. We can replace that true/false with a function that returns a true/false value, and that way we can actually check the event, see if a specific thing happened in that event, and then spit out a boolean to trigger the callback function.</p>
<pre><code class="language-lua">    function(context)
        return context:[thing we want to check]
    end,
</code></pre>
<p>In essence, the above is the foundation for what all effective conditional functions in a listener should be. Context, in the context of listeners, is an object which contains all the data that occurred within the Event. But let's back up. Remember on the document, we found GarrisonOccupiedEvent? Let's go back to it and click it again. We see two options, as mentioned before - &quot;garrison_residence&quot; and &quot;character&quot;. As our intention is to find a specific region being occupied - Altdorf - we need to use that path.</p>
<p>At this point, our WIP code looks like the following:</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence()
    end,
</code></pre>
<p>For the conditional function, you always want to start with &quot;return context:&quot;, and the next method can only be one of the methods that is accessible by that Event - which is where this document comes SO in handy. For other examples, click around the different Events listed at the top. Each &quot;Function&quot; underneath each Event after clicking it is a valid method for the context of that Event. The &quot;RegionSelected&quot; event only has access to a &quot;region&quot; function, which means the only valid method is to use &quot;context:region()&quot;. &quot;DilemmaChoiceMadeEvent&quot;, however, has access to &quot;faction&quot;, &quot;choice&quot;, &quot;campaign_model&quot;, and &quot;dilemma&quot;, so those four are all valid methods.</p>
<p><strong><em>NOTE: Yes, you have to add &quot;()&quot; to the end of the function's name.</em></strong></p>
<p>Back to our example - you'll see the garrison_residence has &quot;GARRISON_RESIDENCE_SCRIPT_INTERFACE&quot; beneath it. You'll see this, too, is clickable. Much like context, the garrison residence script interface is a big object that contains all the data about that garrison residence. All of the functions listed below it are valid methods, meaning we can continue our chain of information! Our goal is to find a region with the key &quot;wh_main_reikland_altdorf&quot;, after all.</p>
<p>Looking in the &quot;GARRISON_RESIDENCE_SCRIPT_INTERFACE&quot;, I don't see a &quot;key&quot; or &quot;name&quot;. Matter of fact, the most likely path is &quot;region()&quot;. That brings our code to...</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence():region()
    end,
</code></pre>
<p>After checking the <code>REGION_SCRIPT_INTERFACE</code>, we finally see the &quot;name&quot; method, which allows us to fully check our context. Our line of code is finally built to:</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence():region():name() == &quot;wh_main_reikland_altdorf&quot;
    end,
</code></pre>
<p>But that's not all! All this does is to check if the Altdorf region is being occupied, but it says nothing about Mannfred! We'll go back to the very beginning - find the GarrisonOccupiedEvent on the document, and return to its functions, which were garrison_residence() and character(). We want to build an &quot;and&quot; sentence for our conditional, so that it only triggers the function when Altdorf is occupied <strong>AND</strong> when it's occupied by Mannfred. Let's try to plot our trajectory a little. We should try to find a script_interface that allows us to reference an agent_subtype key, which is the cleanest and most mod-friendly way to search for Mannfred. Looking at CHARACTER_SCRIPT_INTERFACE, I see two functions - character_subtype() and character_subtype_key(). The latter is used to return a string - ie., it doesn't check for a specific subtype key, but it will tell us what the characters subtype key is. We need to <em>check</em> for a specific subtype key, &quot;vmp_mannfred_von_carstein&quot;.</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence():region():name() == &quot;wh_main_reikland_altdorf&quot; and context:character():character_subtype(&quot;vmp_mannfred_von_carstein&quot;)
    end,
</code></pre>
<p>Note here that the first line of context, that ends in &quot;:name()&quot;, needs to have an equal-to check because we don't want to return the <em>name</em> of the region, but we want to return a value of true or false if the name of the region is equal to the string we define - &quot;wh_main_reikland_altdorf&quot;.</p>
<p>Further note, one might be wondering what the &quot;return&quot; part of this whole deal is. Essentially, a return statement stops the current block of code - ie., the function(context) - and, if something is designated, it returns a value. In this case, it is returning a boolean, which is how we managed to turn an at-first boolean into a function.</p>
<p>A strong conditional function is very important to writing good listeners, as listeners can be very performance-heavy if there are many triggering, and the more that are whittled away via a strong conditional, the better performance will be. Be mindful of your conditionals!</p>
<a class="header" href="#callback-functions" id="callback-functions"><h3>Callback Functions</h3></a>
<p>At this point in the walkthrough, we have about 60% of our listener completed! It's not bad, let's take a quick look at what we actually have written:</p>
<pre><code class="language-lua">core:add_listener(
    &quot;MannfredOccupiesAltdorf&quot;,
    &quot;GarrisonOccupiedEvent&quot;,
    function(context)
        return context:garrison_residence():region():name() == &quot;wh_main_reikland_altdorf&quot; and context:character():character_subtype(&quot;vmp_mannfred_von_carstein&quot;)
    end,
    function(context)
        -- code to execute
    end,
    boolean2
)
</code></pre>
<p>I'd like to point out a couple quick notes. To start off - yes, your listener_name can be anything you want, as long as it's a string. You need a comma after <em>every argument</em> in the command, of which there are five that are detailed way at the top - listener_name, name, conditional boolean, callback, and persistence boolean. The code above is written the way it is because that's a common application of it, and allows it to be easily read, but realistically this can all be written on one line. In no world is that optimal, though.</p>
<p>Alright, so we are on the function to execute block, also known as the callback function. Here, we have much more freedom than the conditional function, as we can do whatever is needed with this block. For instance, we can have a callback function that triggers an event (like a dilemma or a message), or grants a unit/experience/ancillary, or unlocks something like a Rite or a Legendary Lord. For our instance, I want to just give Mannfred's army a new unit and a new effect bundle.</p>
<p><strong><em>NOTE: For our sake, we're going to assume the new unit and new effect bundle are already defined.</em></strong></p>
<p>Looking up in our <a href="https://cdn.discordapp.com/attachments/531219831861805069/569627247217082387/scripting_doc.html">commands document</a>, I see a grant_unit_to_character to command. Checking vanilla usage, I see it takes two args - a char_lookup_str and a unit_key string. The unit_key string - which refers to the main_units_tables - is, in our situation, &quot;tutorial_big_bat&quot;. To find a char_lookup_str, we have to first find the character's cqi.</p>
<p><em>For more information on char_lookup_str and cqi, go to [page link here that doesn't yet exist]</em></p>
<p>Thankfully for us, we can go back to where we were before and use the context of the Event to find all the info from before. Looking at the &quot;CHARACTER_SCRIPT_INTERFACE&quot;, we see a direct link to cqi, with the method &quot;cqi()&quot;. For this, we define our local values as such:</p>
<pre><code class="language-lua">    local char_cqi = context:character():cqi()
    local char_lookup_str = cm:char_lookup_str(char_cqi)
</code></pre>
<p>With this, we find the CQI first of the character, and then apply that to find the character's lookup string, which is the type needed for grant_unit_to_character.</p>
<p>Before we apply that command though, we should find the arguments we need for apply_effect_bundle_to_force(), which is our command that will give an effect bundle to Mannfred's army. We first need our effect bundle; we'll use &quot;tutorial_free_hair&quot;. The second argument is a military force CQI, and our third argument is a number of turns. We'll make it five turns long.</p>
<p>To find the military force CQI, we use something similar as above. We will go from character to military force, and then find the CQI there. We can use something like the following:</p>
<pre><code class="language-lua">    local mf_cqi = context:character():military_force():command_queue_index()
</code></pre>
<p>Note that, in this situation, we couldn't use &quot;cqi()&quot;. That's one reason why it's so important to check vanilla application and the documents. If we used &quot;cqi()&quot;, it would've caused the listener to abort.</p>
<p>Alright, now we have all we need to build our callback function! Let's mush it all together real quickly.</p>
<pre><code class="language-lua">function(context)

    local char_cqi = context:character():cqi()
    local char_lookup_str = cm:char_lookup_str(char_cqi)
    local mf_cqi = context:character():military_force():command_queue_index()
    
    cm:grant_unit_to_character(char_lookup_str, &quot;tutorial_big_bat&quot;)
    cm:apply_effect_bundle_to_force(&quot;tutorial_free_hair&quot;, mf_cqi, 5)

end,
</code></pre>
<p>And that's a quick walkthrough on how to assemble your callback function! Please note, you can have whatever you want here, and there's nothing saying you <em>must</em> restrict yourself to the context of the event. As an example, I can do the same thing without context, like so:</p>
<pre><code class="language-lua">function(context)

    local mannfred_faction = cm:get_faction(&quot;wh_main_vmp_vampire_counts&quot;)
    local mannfred = mannfred_faction:faction_leader()
    
    local char_cqi = mannfred:cqi()	
    local char_lookup_str = cm:char_lookup_str(char_cqi)
    local mf_cqi = mannfred:military_force():command_queue_index()
    
    cm:grant_unit_to_character(char_lookup_str, &quot;tutorial_big_bat&quot;)
    cm:apply_effect_bundle_to_force(&quot;tutorial_free_hair&quot;, mf_cqi, 5)

end,
</code></pre>
<p>This takes a little bit longer than using context, but it is a solution to applying commands to objects that aren't involved in the context. So if, for example, you wanted to give all Vampire factions aside from Mannfred's own an <code>effect_bundle</code> that increases their diplomatic relations with Mannfred after he conquers Altdorf, you can. The world is your oyster when it comes to listeners.</p>
<a class="header" href="#persistence" id="persistence"><h3>Persistence</h3></a>
<p>One last thing, and it's gonna be much quicker than the last two. The final boolean - persistence - can be set to true, or false. True means that the listener will fire more than once; false means that, once the entire code is run through, the listener is removed from the game state and won't be called again. This only gives two options - once, or infinite. There is a third option, by using core:remove_listener(&quot;listener_name&quot;). At whichever point this code is called, the listener with the matching &quot;listener_name&quot; is removed from the game state, and won't be called again. A remove_listener statement like this can be used after enabling a counter that listens for the listener firing five times, or to cancel the listener if the turn is beyond 100, or much else.</p>
<p>Keep in mind that, to &quot;fire&quot;, only the conditional needs to return true. If there's more if statements in your callback function, and they fail, but your persistence is set to false, the listener will remove itself.</p>
<pre><code class="language-lua">core:add_listener(
    &quot;my_listener&quot;, 
    &quot;GarrisonOccupiedEvent&quot;, 
    true, 
    function(context) 
        if this_is_done then
            --stuff happens
        end;
    end, 
    false
)
</code></pre>
<p>So this listener will cancel after one use if &quot;GarrisonOccupiedEvent&quot; is triggered, regardless of whether or not &quot;this is done&quot; returns as true or false.</p>
<a class="header" href="#etc" id="etc"><h1>Etc</h1></a>
<p>All other auxillary stuff goes here, I s'pose.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
