<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Modding Resources</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="modding_resources.html">Modding Resources</a></li><li class="affix"><a href="convert_to_md.html">Converting to Markdown</a></li><li class="affix"><a href="to_do.html">TO DO</a></li><li><a href="chapter_1_0.html"><strong aria-hidden="true">1.</strong> Tools &amp; Resources</a></li><li><ol class="section"><li><a href="chapter_1_norse_1.html"><strong aria-hidden="true">1.1.</strong> Self-Testing Multiplayer (Battle &amp; Campaign)</a></li><li><a href="chapter_1_marth_1.html"><strong aria-hidden="true">1.2.</strong> Custom Portraits and Portholes</a></li><li><a href="chapter_1_maruka_1.html"><strong aria-hidden="true">1.3.</strong> Custom Settlement Skins</a></li><li><a href="chapter_1_1.html"><strong aria-hidden="true">1.4.</strong> Mod Troubleshooting Guide</a></li><li><a href="chapter_1_2.html"><strong aria-hidden="true">1.5.</strong> Tolerant Tables</a></li><li><a href="chapter_1_3.html"><strong aria-hidden="true">1.6.</strong> Unit Card Guide</a></li><li><a href="chapter_1_4.html"><strong aria-hidden="true">1.7.</strong> Building Buildings</a></li><li><a href="chapter_1_vandy_2.html"><strong aria-hidden="true">1.8.</strong> Localisation</a></li><li><a href="chapter_1_cryswar_1.html"><strong aria-hidden="true">1.9.</strong> Creating Custom Units</a></li><li><a href="chapter_1_cryswar_2.html"><strong aria-hidden="true">1.10.</strong> Custom Legendary Lord</a></li><li><a href="chapter_1_cryswar_3.html"><strong aria-hidden="true">1.11.</strong> Custom Skills, Items, and Effects</a></li><li><a href="chapter_1_cryswar_4.html"><strong aria-hidden="true">1.12.</strong> Creating and Editing Abilities</a></li></ol></li><li><a href="chapter_2_0.html"><strong aria-hidden="true">2.</strong> Database Editing</a></li><li><a href="chapter_3_0.html"><strong aria-hidden="true">3.</strong> Lua</a></li><li><ol class="section"><li><a href="chapter_3_1_0.html"><strong aria-hidden="true">3.1.</strong> From Start To Scratch</a></li><li><ol class="section"><li><a href="chapter_3_1_foreword.html"><strong aria-hidden="true">3.1.1.</strong> Foreword: Devtool Console</a></li><li><a href="chapter_3_1_1.html"><strong aria-hidden="true">3.1.2.</strong> Hello World</a></li><li><a href="chapter_3_1_2.html"><strong aria-hidden="true">3.1.3.</strong> Fun Stuff</a></li><li><a href="chapter_3_1_3.html"><strong aria-hidden="true">3.1.4.</strong> Chunks &amp; Statements</a></li><li><a href="chapter_3_1_4.html"><strong aria-hidden="true">3.1.5.</strong> Variables &amp; Types</a></li><li><a href="chapter_3_1_5.html"><strong aria-hidden="true">3.1.6.</strong> Expressions &amp; Operators</a></li><li><a href="chapter_3_1_6.html"><strong aria-hidden="true">3.1.7.</strong> Scopes &amp; Stuff</a></li><li><a href="chapter_3_1_7.html"><strong aria-hidden="true">3.1.8.</strong> Functions, Arguments &amp; Parameters (Also, Returns)</a></li><li><a href="chapter_3_1_8.html"><strong aria-hidden="true">3.1.9.</strong> Commands, Interfaces &amp; Listeners</a></li><li><a href="chapter_3_1_9.html"><strong aria-hidden="true">3.1.10.</strong> Primitive CA Types</a></li></ol></li></ol></li><li><a href="chapter_4_0.html"><strong aria-hidden="true">4.</strong> Battle Maps</a></li><li><ol class="section"><li><a href="chapter_4_1.html"><strong aria-hidden="true">4.1.</strong> Land Battle Maps</a></li><li><a href="chapter_4_2.html"><strong aria-hidden="true">4.2.</strong> Siege Battle Maps</a></li><li><a href="chapter_4_extra_0.html"><strong aria-hidden="true">4.3.</strong> Glossary &amp; Extras</a></li><li><ol class="section"><li><a href="chapter_4_extra_1.html"><strong aria-hidden="true">4.3.1.</strong> Custom Vistas</a></li></ol></li></ol></li><li><a href="etc.html"><strong aria-hidden="true">5.</strong> Etc</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Modding Resources</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#modding-resources" id="modding-resources"><h1>Modding Resources</h1></a>
<a class="header" href="#hello-and-welcome" id="hello-and-welcome"><h3>Hello and Welcome!</h3></a>
<p>Welcome to this little paradise of modding, for Total War: WARHAMMER II. Before we go on, a few things to note:</p>
<ul>
<li>This website is run and maintained by a beautiful union between GitHub and myself, Vandy. (It's hosted on GitHub Pages, if you can't tell from the URL.)</li>
<li>This is an independent project, completely separate from anything resembling official-ness via Creative Assembly, or SEGA, or Games Workshop, or whatever.</li>
<li>All tutorials hosted here are done so with the consent of their respective authors - not a great fan of stolen work!</li>
<li>This site doesn't seek to be an exhaustive list of guaranteed victories, but a slowly-growing community effort to condense knowledge that we have, and formalize it.</li>
</ul>
<p>This project is early yet, and won't be easy for me to maintain. If you would like to help me, reach out to me, and I'll have you convert some tutorials into .md files. Read how below, in &quot;Converting to Markdown&quot;.</p>
<a class="header" href="#divisions" id="divisions"><h3>Divisions</h3></a>
<p>The way I'm going to divide up the tutorials is utterly and completely undecided as of yet.</p>
<a class="header" href="#submissions" id="submissions"><h3>Submissions</h3></a>
<p>If you'd like to submit your tutorial, let me know! There will probably be a cleaner way of this later on, but yeah. Just tell me. Thx.</p>
<a class="header" href="#converting-to-markdown" id="converting-to-markdown"><h1>Converting to Markdown</h1></a>
<a class="header" href="#markdown-conversion" id="markdown-conversion"><h3>Markdown Conversion</h3></a>
<p>This page is intended as a very quick guide on how to convert your tutorial into the language used here, markdown. Markdown is super simple and made to be incredibly simple.</p>
<a class="header" href="#standard-text" id="standard-text"><h4>Standard Text</h4></a>
<p>These three are the backbone of any good tutorial.</p>
<p>Italics - *text*</p>
<p><em>this is an example</em></p>
<p>Bold - **text**</p>
<p><strong>this is an example</strong></p>
<p>Italics &amp; Bold - ***text***</p>
<p><strong><em>this is an example</em></strong></p>
<a class="header" href="#blockquotes" id="blockquotes"><h4>Blockquotes</h4></a>
<p>Blockquotes are a great way of showing specific code or db stuffs. All you have to do is put a &quot;&gt;&quot; preceding a paragraph.</p>
<blockquote>
<p>This is a blockquote.</p>
<p>And this is the blockquote's end.</p>
</blockquote>
<blockquote>
<p>You can use most markdown elements in a blockquote, but I won't cover the possibilities here.</p>
</blockquote>
<blockquote>
<p>You can also make nestled blockquotes.</p>
<blockquote>
<p>Like this.</p>
<blockquote>
<blockquote>
<p>And, this.</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<a class="header" href="#lists" id="lists"><h4>Lists</h4></a>
<p>Super simple, like the rest of this language. To make a nice bulleted list, use &quot;-&quot; prior to the item, with a line break in between.</p>
<ul>
<li>Example list.</li>
<li>Look at my shiny buttons.
<ul>
<li>You can even indent.
You can also randomly not use a bullet to say something.</li>
</ul>
</li>
<li>And then use a bullet again.</li>
</ul>
<p>If you want to number the list, just put &quot;1.&quot; prior to the first item, and then iterate the number for each new list item.</p>
<ol>
<li>First thing on the agenda - put 1.</li>
<li>Shortly after that, put 2.
I think you get the example by now.</li>
<li>One more, for good measure.</li>
</ol>
<a class="header" href="#codeblocks" id="codeblocks"><h4>Codeblocks</h4></a>
<p>For any written code, you can use a single backtick/grave (`) on both sides of the text in order to write code inline. Kinda like <code>this</code>.</p>
<p>If you want to make blocks of code, you can use three of the above, on both sides of the text.</p>
<pre><code class="language-lua">local example = &quot;text&quot;

function do_stuff()
    print(example)
end

do_stuff()
</code></pre>
<p>To get the syntax highlight, I typed <code>lua</code> after the three backticks.</p>
<a class="header" href="#line-breaks" id="line-breaks"><h4>Line Breaks</h4></a>
<p>If you want to make big lines across the screen, use three (or more) hyphens, asterisks, or underscores, in a line by themselves.</p>
<hr />
<a class="header" href="#links-and-images" id="links-and-images"><h4>Links and Images</h4></a>
<p>Links are pretty simple, and can have a specified tooltips for when they're hovered over, or converted into text and made into a hyperlink, or can remain a standard clickable link.</p>
<p>To make a standard clickable link, wrap the URL with &quot;&lt;&gt;&quot;.</p>
<p><a href="https://www.google.com">https://www.google.com</a></p>
<p>To give a link a title that replaces the URL, first put the title within &quot;[]&quot;, and have it immediately followed by &quot;()&quot;.</p>
<p>[example title](https://www.google.com)</p>
<p><a href="https://www.google.com">example title</a></p>
<p>Images are much the same as above, use a &quot;!&quot; preceding the title and the link designation.</p>
<p>![example image](https://cdn.discordapp.com/emojis/460756324729356299.png?v=1)</p>
<p><img src="https://cdn.discordapp.com/emojis/460756324729356299.png?v=1" alt="example image" /></p>
<p>For either, if you want alternate text to popup when hovering over the element, put the alternate text within the &quot;()&quot;, after the link, and in quotation marks, like so:</p>
<p>[example title](https://www.google.com &quot;This Is Google!&quot;)</p>
<p><a href="https://www.google.com" title="This Is Google!">example title</a></p>
<p>If your image isn't uploaded onto the web, that's fine - just send me the file, and I can attach it on my side. Make a note for me, saying ![][image_1] for the first image, ![][image_2] for the second and so on, and I'll take care of the rest!</p>
<a class="header" href="#headings" id="headings"><h4>Headings</h4></a>
<p>You can set six different bolded-sizes for headers, for visual distinction. A header is simply a number sign (#) followed by the text that is being head'ed. There can be one number sign, up to six number signs, preceding the text. One number sign is the largest, six the smallest.</p>
<a class="header" href="#one-number-sign" id="one-number-sign"><h1>One Number Sign</h1></a>
<a class="header" href="#two-number-signs" id="two-number-signs"><h2>Two Number Signs</h2></a>
<a class="header" href="#three-number-signs" id="three-number-signs"><h3>Three Number Signs</h3></a>
<a class="header" href="#four-number-signs" id="four-number-signs"><h4>Four Number Signs</h4></a>
<a class="header" href="#five-number-signs" id="five-number-signs"><h5>Five Number Signs</h5></a>
<a class="header" href="#six-number-signs" id="six-number-signs"><h6>Six Number Signs</h6></a>
<a class="header" href="#tutorials-to-convert" id="tutorials-to-convert"><h3>Tutorials to Convert</h3></a>
<p><strong>vandy rewrites</strong>:
- <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1218756773">How to Write Readable Script by theSniperDevil</a>
- <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1312564661">Save States by theSniperDevil</a>
- <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1312347007">Creating Self-Calling Scripts by theSniperDevil</a>
- <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1314628727">Listeners by theSniperDevil</a>
- <a href="https://steamcommunity.com/workshop/filedetails/discussion/1556936886/1752358461546273776/">Quest Battle by Mklabs</a></p>
<p><strong>anyone convert</strong>:
- <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1194811468">Custom Porthole Bins by Marthenil</a>
- <a href="https://docs.google.com/document/d/1YeoN-F8NVgGIgvkHpewe-KnmOX5fS6vqrwS6RPChG5Y/edit?usp=sharing">Self-Testing MP by Norse</a>
- <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1233817370">Custom Vistas by Maruka</a>
- <a href="http://steamcommunity.com/sharedfiles/filedetails/?id=1201835399">Custom Prefabs by Maruka</a>
- <a href="http://steamcommunity.com/sharedfiles/filedetails/?id=1220149586">Custom Settlement Skins by Maruka</a>
- <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1745518466">Creating a Custom Faction by Cryswar</a></p>
<a class="header" href="#tutorials-to-write" id="tutorials-to-write"><h3>Tutorials to Write</h3></a>
<ul>
<li>Effects</li>
<li>Campaign Groups</li>
<li>Using the Assembly Kit</li>
<li>UI Modding</li>
<li>Pooled Resources</li>
</ul>
<a class="header" href="#db-overview" id="db-overview"><h3>DB Overview</h3></a>
<ul>
<li>Keys/Data/Objects/SQL</li>
<li>Table/key priorities and how they work</li>
</ul>
<a class="header" href="#lua-overview" id="lua-overview"><h3>Lua Overview</h3></a>
<ul>
<li>Lua Debugging</li>
<li>OOP</li>
<li>Fantastic tables and how to use them</li>
<li>Loops</li>
<li>CA types</li>
</ul>
<a class="header" href="#tools--resources" id="tools--resources"><h1>Tools &amp; Resources</h1></a>
<p>Every modder needs proper tools, just like every lumberjack needs a swingset. This list does not claim to be a sure-fire solution to every single issue a modder might face, nor an impervious list of perfect programs, designed to cater your every need. This list <strong>does</strong> have a lot of value in it, I believe, and if used correctly, a lot can be achieved.</p>
<p>You'll also notice that this section has random housed tutorials in it, that don't fit in any particular place with the larger-scale tutorials. The author and summary of each will be listed and maintained here!</p>
<a class="header" href="#kaedrins-mod-manager" id="kaedrins-mod-manager"><h4>Kaedrin's Mod Manager</h4></a>
<p><a href="https://github.com/Kaedrin/warhammer-mod-manager/releases/">Kaedrin's Mod Manager</a> is a very useful alternative mod manager that works for all Total War games since Total War: Empire.</p>
<p>You can get in contact with the creator, Kaedrin, in the Modding Den's channel <a href="https://discord.gg/yHvXGRb">#kaedrin_mod_manager</a>.</p>
<a class="header" href="#frodos-rusted-pack-file-manager" id="frodos-rusted-pack-file-manager"><h4>Frodo's Rusted Pack File Manager</h4></a>
<p><a href="https://github.com/Frodo45127/rpfm/releases/latest">RPFM</a> is a great pack-file managing tool, essential for any modder. Active development has new features coming regularly, as well as constant bugfixes or squashings.</p>
<p>Get in contact with the creator, Frodo, in the Modding Den's channel <a href="https://github.com/Frodo45127/rpfm/releases/latest">#rpfm</a>.</p>
<a class="header" href="#housed-tutorials" id="housed-tutorials"><h4>Housed Tutorials</h4></a>
<p><a href="./chapter_1_1.html">Mod Troubleshooting Guide by Cataph</a> - An overview of how to debug any mod issues, as a user.
<a href="./chapter_1_2.html">Tolerant Tables by Cataph</a> - A list of different tolerant tables, a really helpful resource for peeps who want to do some intricate sub-modding.
<a href="./chapter_1_3.html">Unit Card Guide by Cataph</a> - A helpful series of guidelines on how to create a new unit card. Includes a template file to start off with.
<a href="./chapter_1_4.html">Building Buildings by Vandy</a> - A tutorial for creating custom buildings from scratch.</p>
<p><a href="./chapter_1_cryswar_1.html">Creating Custom Units by Cryswar</a> - This guide is meant to walk prospective modders through creating a new unit in TWW2 using RPFM, assuming little to no knowledge of modding.
<a href="./chapter_1_cryswar_2.html">Creating a Custom Legendary Lord by Cryswar</a> - This walkthrough will walk you through creating a bare-bones custom lord and adding them to the game. It assumes you know the basics of modding and how to create a new unit, covered in the previous guide.
<a href="./chapter_1_cryswar_3.html">Custom Skills, Items, and Effects</a> - Here we discuss how to edit or create custom character skills, ancillaries, and effects, then attach them to each other as desired.
<a href="./chapter_1_cryswar_4.html">Creating and Editing Abilities</a> - We will cover how abilities of all types work - unit abilities, augments, army abilities, vortexes, etc.</p>
<a class="header" href="#scripting-resources" id="scripting-resources"><h4>Scripting Resources</h4></a>
<p><a href="files/entry.lua">entry.lua</a></p>
<p><a href="files/ca_types.lua">ca_types.lua</a></p>
<p><a href="files/uimf_types.lua">uimf_types.lua</a></p>
<p><a href="files/scripting_doc.html">Script Doc (Events &amp; Interfaces)</a></p>
<p><a href="files/scripting.txt">Script Doc (CM Functions)</a></p>
<a class="header" href="#self-testing-multiplayer-battle--campaign" id="self-testing-multiplayer-battle--campaign"><h1>Self-Testing Multiplayer (Battle &amp; Campaign)</h1></a>
<a class="header" href="#by-norse-zaibatsu" id="by-norse-zaibatsu"><h2>By Norse Zaibatsu</h2></a>
<p>Let's say you've published a mod to the workshop. It's incorporating everyone's favorite dark elf legendary lord, Malus Darkblade, so it hits the most popular chart within minutes. You go to kick back and relax in your chair when you see the green notification on your Steam client. Sweating intensely, you see it's a comment on your mod, the words etched onto your computer screen: &quot;Does this work for multiplayer campaigns?!&quot;</p>
<p>You feel deflated. After all, you just thought it should work for multiplayer if you tested it for campaign! All your Steam friends that also play Warhammer 2 aren't online, just when you need them. What do you do?
<strong>This guide is here to help you with that</strong></p>
<p>With the help of Pete from the Creative Assembly (thanks Pete!), here is how you can host a LAN with yourself.</p>
<p>You're going to need:</p>
<ul>
<li>A computer with preferably recommended specifications for Total War: Warhammer 2, as you'll be running two copies of the game at the same time.</li>
<li><a href="https://www.sandboxie.com/">Sandboxie</a>, a lightweight sandboxing tool to let you get multiple Steam clients running.</li>
<li>A legal copy of Total War: Warhammer 2. Downloaded cars will not work with this method.</li>
</ul>
<a class="header" href="#disclaimer" id="disclaimer"><h3>Disclaimer</h3></a>
<ul>
<li>This might occasionally crash on loading MP campaigns due to startpos unpacking issues. You may have to try a few times to get it to launch. Custom batles should be more stable.</li>
<li>The -multirun start parameter is not currently supported by the Total War launcher. You'll have to swap back to the old launcher through changing the branch of Warhammer 2 to the launcher candidate branch.</li>
</ul>
<a class="header" href="#setting-up-sandboxie" id="setting-up-sandboxie"><h3>Setting up Sandboxie</h3></a>
<p>When you open Sandboxie for the first time, you will be greeted by this:</p>
<p><img src="images/chapter_1_norse_1/01.png" alt="test" /></p>
<p>Don't be alarmed, this program is very intuitive. Right click your default sandbox and navigate to “run any program”</p>
<p><img src="images/chapter_1_norse_1/02.png" alt="test" /></p>
<p>You'll be greeted by this dialog.</p>
<p><img src="images/chapter_1_norse_1/03.png" alt="test" /></p>
<p>Find your Steam folder outside Sandboxie and copy the directory</p>
<p><img src="images/chapter_1_norse_1/04.png" alt="test" /></p>
<p>Press &quot;OK&quot;. A new sandboxed folder will open. You can tell that the window is sandboxed because it has two hashtags around the name.</p>
<p><img src="images/chapter_1_norse_1/05.png" alt="test" /></p>
<p>Run Steam from inside this folder to open a sandboxed version of Steam. It might have to update. Once you have got that running, switch your sandboxed Steam version to offline mode.</p>
<p><img src="images/chapter_1_norse_1/06.png" alt="test" /></p>
<p>In both Steam versions you now have open, right click on Total War: Warhammer 2 and go to Properties. In the Properties dialog, click on &quot;Set Launch Options&quot; tab and add the following: <code>-multirun</code></p>
<p><img src="images/chapter_1_norse_1/07.png" alt="test" /></p>
<p>You’re basically good to go! Just launch WH2 with both steam clients. Note that only your host computer, the one outside the sandbox, is going to be able to host games. But your client computer inside the sandbox can join them!</p>
<p><img src="images/chapter_1_norse_1/08.png" alt="test" /></p>
<p>This will also work for custom battles! Happy testing!</p>
<a class="header" href="#custom-portraits-and-portholes" id="custom-portraits-and-portholes"><h1>Custom Portraits and Portholes</h1></a>
<a class="header" href="#by-marthenil" id="by-marthenil"><h2>By Marthenil</h2></a>
<p>This guide will walk you through adding portraits and portholes to your custom characters.</p>
<a class="header" href="#introduction" id="introduction"><h4>Introduction</h4></a>
<p>One of the major issues when making new custom characters has been the lack of working custom portraits. The portrait is the icon you see at the diplomacy screen, when recruiting a character, the skill window and more.</p>
<p>Well, no more. In this relatively simple guide, we'll go through the steps required to add a working portrait to your new custom character.</p>
<a class="header" href="#things-you-will-need" id="things-you-will-need"><h4>Things you will need</h4></a>
<ul>
<li><a href="https://drive.google.com/open?id=1rOgdJBlaUr5S-CxuWKru3at2g0cVZFB7">selfie.exe</a> by Crux3d</li>
<li>The XML template (included in the above)</li>
<li><a href="https://mh-nexus.de/de/">HxD version 2.0 RC</a> (Optional)</li>
<li><a href="https://notepad-plus-plus.org/">Notepad++</a> (Optional)</li>
</ul>
<a class="header" href="#setting-up-and-understanding-the-xml" id="setting-up-and-understanding-the-xml"><h4>Setting up and understanding the XML</h4></a>
<p>Extract selfie.exe and the XML template in a directory of your choice.
Open up the XML template with Notepad ++ or the text editor of your choice. The template is already configured for a custom vanilla male dreadlord.
The settings themselves are pretty straightforward. Let's ignore Distance, Theta, Phi and FOV for now.</p>
<p>Each <strong>art_set_id</strong> from the campaign_character_arts_table requires its own entry.</p>
<p><img src="images/chapter_1_marth_1/01.png" alt="test" /></p>
<p>The <strong>variant</strong> key from the variants table goes into the <code>Variant ID=</code> slot.</p>
<p><img src="images/chapter_1_marth_1/02.png" alt="test" /></p>
<p>The link to your <strong>2D portrait porthole</strong> is added in the <code>&lt;FileDiffuse&gt;&lt;/File&gt;</code> slot.</p>
<p><img src="images/chapter_1_marth_1/03.png" alt="test" /></p>
<p>Filemasks, Season, Level, Age, Politician, and Faction Leader values should be left <strong>untouched.</strong> Repeat for each campaign variant.</p>
<p>All of your characters in a single mod pack should use a single .xml file. Just keep adding entries.</p>
<a class="header" href="#distance-theta-phi-fov" id="distance-theta-phi-fov"><h4>Distance, Theta, Phi, FoV</h4></a>
<p>These values essentially adjust the viewing angle of the porthole portrait. Unfortunately, there is no easy way to figure out what works best in each specific case. You can try the default values in the XML template, but they will not always work.</p>
<p>In that case, you will have to find a unit that causes a similar model/portrait and copy the values from that. Extract either <strong>portrait_settings__.bin</strong> in ui/portraits in the data.pack or <strong>portrait_setings__2.bin</strong> in ui/portraits in data_2.pack. Total War: Warhammer 1 portraits are found in <strong>portrait_settings__.bin</strong> and Total War: Warhammer 2 portraits are found in <strong>portrait_settings__2.bin.</strong></p>
<p>Open the newly exported bin file with HxD. Make sure that the data inspector is on (right hand panel with value translations) by making sure that it is ticked in View -&gt; Toolbars -&gt; Data Inspector. Hit <code>CRTL+F</code> to search for the unit with the portrait settings that you want to use. Notice that there is some text and some gibberish.</p>
<p><img src="images/chapter_1_marth_1/04.png" alt="test" /></p>
<p>The text is the <strong>art_set_id</strong> of the unit. The first 16 gibberish characters, in groups of 4, are the actual values for <strong>Distance, Theta, Phi,</strong> and <strong>FoV</strong> in Float.</p>
<p><img src="images/chapter_1_marth_1/05.png" alt="test" /></p>
<p>Highlight the four first characters (bytes) and look at the data inspector (right panel) under float. This is your <strong>Distance</strong> value.</p>
<p><img src="images/chapter_1_marth_1/06.png" alt="test" /></p>
<p>The next four is your <strong>Theta</strong> value.</p>
<p><img src="images/chapter_1_marth_1/07.png" alt="test" /></p>
<p>And, you guessed it, the next four are your <strong>Phi</strong> Value and the last four are your <strong>FOV</strong> value.</p>
<p><img src="images/chapter_1_marth_1/08.png" alt="test" /></p>
<p><img src="images/chapter_1_marth_1/09.png" alt="test" /></p>
<a class="header" href="#finishing-up" id="finishing-up"><h4>Finishing Up</h4></a>
<p>After you have successfully added your Distance, Theta, Phi, and FoV values to your XML, save it as <code>portrait_settings_[yourmodname].xml</code> in the directory that you extracted selfie.exe into in the previous steps. Simply drag the file onto <code>selfie.exe</code> and a <code>portrait_settings_[yourmodname].bin</code> should appear in the same folder.</p>
<p>To get your .bin into the game, simply add it to the UI/Portraits/Porholes folder in your mod pack.</p>
<p>Voila, your portaits and portholes are ready!</p>
<a class="header" href="#warning" id="warning"><h4>Warning</h4></a>
<ul>
<li><strong>Do not</strong> mess with the .bin files or filenames in HXD, other than reading the values for Distance,Theta, Phi and FOV.</li>
<li><strong>Do not</strong> mess with the filename of the custom .bin too much, either.</li>
<li><strong>Do not</strong> mess with the Filemasks, Season, Level, Age, Politician, and Faction Leader values in the XML either.</li>
</ul>
<p><strong><em>Failure to comply with the above can lead to severe game crashes, system-wide crashes and even the dreaded Blue Screen of Death.</em></strong></p>
<p>You have been warned.</p>
<a class="header" href="#notes-about-selfieexe" id="notes-about-selfieexe"><h4>Notes about selfie.exe</h4></a>
<p>Decimals in your .xml must use decimal points <code>.</code> and not commas <code>,</code>, otherwise selfie will not recognise the float values.</p>
<p>Selfie also supports error reporting, if your returned file is not working properly, try running selfie through the command prompt.</p>
<p>Open up a command prompt in the folder you have got selfie and your .xml file; usage is:</p>
<pre><code>selfie.exe &lt;filename&gt;
</code></pre>
<a class="header" href="#closing-and-thanks" id="closing-and-thanks"><h4>Closing and Thanks</h4></a>
<p>Major thanks to <strong>Crux3d</strong> for creating selfie.exe for Total War: Attila. Without his tool it would be close to impossible to figure the values out.</p>
<p>Thanks to both <a href="https://steamcommunity.com/profiles/76561198001056290/myworkshopfiles/?appid=594570">Crynsos</a> and <a href="https://steamcommunity.com/id/cataph/myworkshopfiles/?appid=594570">Cataph</a> for their help with figuring some of the stuff out and testing the whole thing!</p>
<a class="header" href="#custom-campaign-settlement-skins" id="custom-campaign-settlement-skins"><h1>Custom Campaign Settlement Skins</h1></a>
<a class="header" href="#by-maruka" id="by-maruka"><h2>By Maruka</h2></a>
<a class="header" href="#before-we-begin" id="before-we-begin"><h4>Before we begin</h4></a>
<p>This guide explains how you can make custom settlement skins for the campaign. This is not officially supported by CA, so the process is a little bit awkward. It might look complicated at first, but that's mostly because I've tried to be as thorough as possible in the explanation. If you have any questions you can ask them in the Map Makers discord channel, which you can find <a href="https://discord.gg/NyrXErg">here</a>.</p>
<p>You will need <a href="https://github.com/Frodo45127/rpfm/releases">Rusted Pack File Manager</a> for this.</p>
<p>Before we begin, make a folder -somewhere- on your computer called 'campaign', in a folder called 'prefabs'. The location of this folder does not matter, as long as you can find it again.</p>
<a class="header" href="#preparation-in-terry" id="preparation-in-terry"><h4>Preparation in Terry</h4></a>
<p>Create a new map in Terry.</p>
<p>If you'd like your settlement to change with each level, you'll need to create five layers and make each version in one layer, as you can see in the layer panel in the pictures in section 2.</p>
<p>Before we continue, make five layers (name them 01-05 or something along those lines), and save your map.</p>
<p>Now go to the raw terry files in</p>
<pre><code>Total War WARHAMMER II\assembly_kit\raw_data\terrain\tiles\battle\_assembly_kit\(yourmap)
</code></pre>
<p>and open the .terry file of the map, and look for the ECFileLayer.</p>
<p>Change <code>&lt;ECFileLayer export=&quot;true&quot; bmd_export_type=&quot;&quot;/&gt;</code> to <code>ECFileLayer = export=&quot;true&quot; bmd_export_type=&quot;catchment_01&quot;/&gt;</code></p>
<p>Do this for all five layers.</p>
<p>Save the file, re-open terry &amp; reopen the map. The layers should now have 'catchment - 01' or equivalent after their name, as you can see in the pictures in section 2.</p>
<a class="header" href="#making-the-settlement-in-terry" id="making-the-settlement-in-terry"><h4>Making the settlement in Terry</h4></a>
<p>Build your settlement around the origin of the map 0,0,0. Standard CA settlements cover an area of roughly 4x4 units. You can make it larger than that (as we did for the faction capitals), but armies will stand in the settlement skin if you do that.</p>
<p><strong>Each layer will need to contain a copy of the previous levels.</strong></p>
<p>Kislev at level 1:</p>
<p><img src="images/chapter_1_maruka_1/01.png" alt="KISLEV" /></p>
<p>Kislev at level 5</p>
<p><img src="images/chapter_1_maruka_1/02.png" alt="KIIIISLEEEEV" /></p>
<a class="header" href="#exporting-the-prefab" id="exporting-the-prefab"><h4>Exporting the prefab</h4></a>
<p>Save, and then export the map.</p>
<p>The description, author, and max players don't matter. You can close Terry now.</p>
<p>Go to the working data folder and find the exported files, the path is:</p>
<p><code>Total War WARHAMMER II\working_data_terrain\tiles\batle\_assembly_kit\[yourmap]</code></p>
<p><em>(replace <code>[yourmap]</code> with the key of your map)</em></p>
<p>Copy the catchment_01_layer_bmd_data.bin (and 02-05), and paste it into the 'campaign' folder which you made earlier.</p>
<p>Rename catchment_01_layer_bmd_data.bin to <code>[nameofyourprefab].bmd</code>. In the case of Kislev that was gccm_kislev_emp_1.bmd.</p>
<p>That means that we're changing the extension of the file from BIN to BMD. Your computer might ask you if you're sure that you want to change the extension. You are sure, so go ahead and change it.</p>
<p><strong>These are the actual prefabs as they show up ingame.</strong></p>
<p>I'll add more information later if people have questions, for now you can just download <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1220118747">GCCM: Unique Faction Capitals</a> and open that in PFM to see what I did to replace the prefabs.</p>
<a class="header" href="#mod-troubleshooting-guide" id="mod-troubleshooting-guide"><h1>Mod Troubleshooting Guide</h1></a>
<a class="header" href="#by-cataph" id="by-cataph"><h2>By Cataph</h2></a>
<p>This is a troubleshooting guide for mod users in TW: Warhammer 2. The generic pointers should be valid for all recent TW games.
- Your neighbourhood Cataph</p>
<a class="header" href="#managing-mods" id="managing-mods"><h2>Managing Mods</h2></a>
<p>So, you have subscribed to mods on the workshop. You now open CA's current mod manager (hereby called <strong>George II</strong>) and - they don't work. We called it George II cause it's the new launcher. He's new in town, prettier than George, but he's still not good at what he should be doing and forgets to make mods work. We're sorry but George II needs some time.</p>
<p>If mods appear to not work, check the support pages about it. If that doesn't work, which is feasible, the standing recommendation is to rollback to George I (<code>game properties&gt; betas&gt; launcher_release_candidate</code>). George I is faulty as well but slightly more reliable.
<strong><em>[disregard all of the above right now (during P&amp;W dlc release), they're both bugged more than before; this is basically a &quot;shut up and use KMM&quot;]</em></strong></p>
<p>Even better, just use the <a href="https://github.com/Kaedrin/warhammer-mod-manager">community mod manager</a> (hereby called KMM). Long story short, George is unwieldy and has grown responsible for a lot of issues of its own, becoming hated by modders and users alike. Among other things, KMM can launch the game without even bothering George.</p>
<p>One of the things George I cannot do is let you change load order because it only uses the default alphabetical order. KMM and even George II have that function, so sometimes you'd be tempted to change load order manually, right? WRONG.
The truth is that <strong>compatibility-minded modders already handle load order on their own</strong> as far as possible. Manually changing load order may do absolutely nothing <strong>or break everything</strong>.
Some context. There are six main possible categories of folders in a mod pack and this is how they handle load order, either through actual pack name or table name:</p>
<ul>
<li><strong>Db</strong>: table name.</li>
<li><strong>Scripts</strong>: pack name.</li>
<li><strong>Startpos</strong>: the big bad, pack name.</li>
<li><strong>Text</strong>: table name.</li>
<li><strong>UI</strong>: pack name.</li>
<li><strong>Variants</strong>: pack name.</li>
</ul>
<p>And that is if the modder doesn't redirect content. KMM can only affect pack name order, so there are things like balance submods (Db overrides) that are still completely in the hands of the modders and intentionally so.</p>
<p>In other words, <strong>there are <strong>only two possible cases</strong> in which you may want to alter load order manually: UI and variants</strong>, basically if you want to use specific reskin B.pack in the midst of larger reskin A.pack, in which case you push B on top.</p>
<p>You DON'T WANT to change script or startpos load order, because bad stuff happens. For example, the Community Modding Framework, aka bunch of script hooks, should always be LAST or you'll break things.</p>
<p><em>In conclusion, you want to follow KMM's instructions, give Steam time to download/remove mods and mostly keep load order in an alphabetical fashion (e.g. order by name and save profile), especially after adding new mods.</em></p>
<p>Which, incidentally, is this:
! # $ % &amp; ' ( ) + , - ; = @ 0-9 a-z [ ] ^ _ ` { } ~
Where &quot;!&quot; wins over &quot;a&quot;.</p>
<a class="header" href="#common-troubleshooting" id="common-troubleshooting"><h2>Common Troubleshooting</h2></a>
<p>In an efficient mod, at least half of the reported issues are down to user error or what is technically called launcher f***-up. We’re going to try and cut that amount down for the greater good.</p>
<p><strong>Most common user mistakes</strong>:</p>
<ol>
<li><strong>Not reading the mod description</strong>. Seriously, it’s there for a reason. The modder took time to write it and it’s downright disrespectful to ignore it. Some mods will also have FAQs or a list of known issues and instructions.</li>
<li><strong>Ignoring the required items</strong>. Ditto. The mod may show you a popup upon subscribing, disregarding that is almost always cue for disaster. This popup is not shown when subbing from a Steam collection, so actually check the mod’s page.</li>
<li><strong>Mixing up incompatible mods</strong>. Too often, some users will make the said mistakes and just subscribe. The most common example is using two startpos mods at the same time, or two overhauls. Don’t do that. If in doubt, read the description again or ask the modder in a comment.</li>
<li><strong>Not providing details upon reporting an issue</strong>. Ok, you did everything right but that ugly bug is still there. That’s fine. The worst thing you could do at this point is comment &quot;mod doesn’t work&quot; because that means absolutely nothing.</li>
</ol>
<p><strong>Your comment for the modder should include as many as possible of the following:</strong></p>
<ul>
<li><strong>Context</strong>: when and how the thing happened. E.g. during the interturn after X’s turn, or clicking this button, whether it was Vortex/ME/multiplayer, custom battle or campaign battle.</li>
<li><strong>Mod list</strong>: always tell if you have other mods up and which ones, we see people somehow not mention that they were using a total overhaul, and that’s kind of a huge deal. Do not skip on certain mods because you think they can’t be the culprit. Linking a collection is the handiest method you have.</li>
<li><strong>Screenshot</strong>: always helps, it can at least show the context.</li>
<li><strong>Save game</strong>: if requested, you can find your save game in (example) C:\Users%USER%\AppData\Roaming\The Creative Assembly\Warhammer2\save_games. Remember the mod list, because the modder may not be able to load without it.</li>
</ul>
<p><strong>And not to do:</strong></p>
<ul>
<li><strong>The Hit &amp; Run</strong>: if you comment about an issue but then solve it on your own, let the modder know. Sometimes people just report a problem and disappear.</li>
<li><strong>Ignoring previous comments</strong>: the answer to your problem may lie as far as two comments below. If any, look for the FAQs as well.</li>
</ul>
<p><em>This list is of course not meant to insult anybody’s intelligence, but you’d be surprised at how many issues and massive wastes of time are due to neglect of these simple rules. Following them is in the user’s interest in order to find a solution sooner, and it will allow the modder more time for improvement rather than wasted in unnecessary bug-hunts.</em></p>
<p><strong>Most common launcher or game issues (with either George I or George II)</strong>:</p>
<ol>
<li><strong>Failed to download/remove mod</strong>. This happens relatively often and if in doubt you should always check in the mod download folder (example: Z:\Steam\steamapps\workshop\content\594570??????) whether that mod was successfully downloaded/removed. Open George/Steam again until it is. The final folder id is the same as the one on the mod’s Steam url and you can sort by date for the most recently poked folder.
<ul>
<li><strong>More on this if using KMM</strong>: Kaedrin’s manager moves active mod packs back to the data folder. Moreover, when mods update you will likely need to refresh/restart KMM. Most people will be using the Skip Intros mod, and if the game starts without loading it it’s an easy symptom something didn’t reload correctly. If you get that or suddenly crash for no good reason, just <strong>refresh/restart KMM first thing</strong>!</li>
</ul>
</li>
<li><strong>Ghost mods</strong>. Definitely spooky. You have toggled off that mod, but somehow it turns out it was still being loaded and crashing your game. Or a mod updates and self-enables. Using KMM seems enough to prevent this kind of poltergeist.</li>
<li><strong>Corrupted download</strong>. This is something that has been happening increasingly over time. The mod’s download is botched and it either crashes the game or presents less visible problems (e.g.: this lord’s graphics are wrong/missing). Go again in your content or data folder, delete the mod pack and let George download it again. In theory, you should do this every time a mod that is clearly not supposed to do that crashes on game start, especially when the mod hasn’t been updated recently and nobody has reported such a glaring problem in a while.</li>
<li><strong>Random crashes</strong>: sometimes stuff just breaks and you have to verify your game’s cache: Steam Library&gt;right click on game&gt;Properties&gt;Local Files&gt;Verify yadda yadda. Or check with the game’s support.</li>
<li><strong>THE DREADED DURTHU BUG</strong>: once upon a time, a bug with Durthu’s Lamentation ability rampaged through the workshop, mods being blamed without anybody being able to find a culprit. Eventually, it turned out that it was a vanilla bug that only popped up when certain mods were around and yes, I’m serious. Any similar glitch may be now affectionately dubbed Durthu by modders. The user can do nothing about it but just keep in mind, for giggles, that sometimes this sort of thing happens and this is when modders grow white hair in digging through their innocent mods. Probably karma for the analogous reports CA get for mod-originated bugs.</li>
<li><strong>Can only do one thing at a time, guv</strong>: new bug introduced with the lizard&amp;rat DLC, supposedly to be fixed asap cause it breaks the new launchers on most cases. Basically only one mod is loaded at any time. I don’t have to specify how bad that is. Just use KMM.</li>
</ol>
<p><strong>Most common KMM issues</strong>:</p>
<ol>
<li><strong>Doesn’t work</strong>: KMM can be installed anywhere, BUT in the game’s stuff. Don’t install in data/ or anywhere close. Hell, plop it in the desktop.</li>
<li><strong>Doesn’t work cause I’m pirating the game</strong>: KMM can smell piracy. Buy the game.</li>
<li><strong>Freeze on start</strong>: try again.</li>
<li><strong>DLC not found</strong>: I don’t know the specifics but 1.8.6 should fix that from .4. If it doesn’t, Detect installs again. Past that, report to Kaedrin with what he needs or rollback to the .2.</li>
</ol>
<a class="header" href="#appendix-trimming-the-mod-list" id="appendix-trimming-the-mod-list"><h2>APPENDIX: Trimming the Mod List</h2></a>
<p>You should always keep in mind that even if the mod list is technically sound there is always a <strong>background mod limit of unknown entity</strong>. Long story short, beyond 40 mods you’re potentially flirting with disaster because risk of incompatibility increases and the game may simply throw more random problems and crashes, or just plain balance issues. At 70ish, you surely have something wrong going on somewhere.
As a rule of thumb, try not to overload it. No, don’t assemble and publish a bunch of mods, that kind of thing is terribly dangerous and bad for a variety of reasons. We’ll go more in-depth about this another time.</p>
<a class="header" href="#finding-the-culprit" id="finding-the-culprit"><h3>Finding the culprit</h3></a>
<p>The other problem with large mod lists is this: bad, I got a crash; worse, which one of the N mods I have is the culprit?</p>
<p>Generic pointers:</p>
<ul>
<li>Pure Text, Variant and UI mods can NEVER crash the game for the user. If they do, it’s a botched download.</li>
<li>Sort by date either on KMM or George to find the most recent updates, if you didn’t add additional mods those may be responsible.</li>
<li>If you had the issue during a campaign, do not remove mods that have custom items, units or buildings because you’re just going to crash harder if they are around in the campaign map.</li>
</ul>
<p>One of the things you should try upon encountering a reproducible crash is to toggle off all mods  from the ground up by loading the bare minimum to make that mod work, for example loading only the Unlocker+ and CMF. And up from there, adding one or small groups of mods at a time until you can reproduce the issue.
<strong>Keep in mind mod requirements while you do this.</strong></p>
<p>It’s patient work but the modder will appreciate it.
Remember: a happy modder is a happy user.</p>
<a class="header" href="#appendix-scripts" id="appendix-scripts"><h2>APPENDIX: Scripts</h2></a>
<p>Scripts are being increasingly used by mods. Scripters are getting smarter by the day to maintain compatibility, but some mods still require frameworks like CMF or UIMF (we’ll read about them later).</p>
<p>You may encounter symptoms of broken scripts, due to botched downloads, bad compatibility, lack of CMF/UIMF or just plain unforeseen issues because we can just mess stuff up sometimes. Script glitches tend to be quite tricky.</p>
<p>How to recognize broken scripts:</p>
<ul>
<li>Rites button on a faction that shouldn’t have that.</li>
<li>You’re playing Tomb Kings or a modded faction and you see foreign mortuary cult/crafting options.</li>
<li>You see an unchained Sword of Khaine button right off. (Example below, with broken Books too)
<img src="images/1_1-01.png" alt="Example (with broken Books too)" />.</li>
<li>Chaos and all Rogue armies may spawn immediately.</li>
<li>Campaign camera on a fresh campaign starts zoomed-out and doesn’t pan in.</li>
<li>Chivalry starts at 0.</li>
<li>Some LLs appear as trapezist Loremasters (e.g. in TEB).</li>
<li>One of the worst, characters do not gain XP (this may sometimes happen in full vanilla too, requires repair).</li>
</ul>
<p>What do?
In most cases, it’s just a botched download (see Launcher error 3). Other times it may be trickier and require you to start trimming the mod list to find the culprit. When/if you report the issue to modders, remember to provide as much info as humanly possible because finding a script break can turn ugly and complicated.
Please also consider using <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1271877744">this debugger mod</a> and sending the resulting log, generated in Steam\steamapps\common\Total War WARHAMMER II. Specific scripty mods may come with additional instructions.</p>
<a class="header" href="#appendix-a-hrefhttpsteamcommunitycomworkshopfiledetailsid1175369579community-modding-framework-cmfa" id="appendix-a-hrefhttpsteamcommunitycomworkshopfiledetailsid1175369579community-modding-framework-cmfa"><h2>APPENDIX: <a href="http://steamcommunity.com/workshop/filedetails/?id=1175369579">Community Modding Framework (CMF)</a></h2></a>
<a class="header" href="#currently-needs-maintenance-as-of-7-may" id="currently-needs-maintenance-as-of-7-may"><h2>CURRENTLY NEEDS MAINTENANCE, AS OF 7 MAY</h2></a>
<p>CMF is basically a community-driven dock where all ships come to do whatever ships do in ports. In other words, <strong>it is a required framework that allows high layers of compatibility between a bunch of mods</strong>. It used to be pretty mandatory before new opportunities arose, but it’s still required for some mods out there. A bunch of problems are caused by not having CMF, or by a botched download of the latter.</p>
<p>So, what to do:</p>
<ol>
<li>If it’s a required mod, do grab it.</li>
<li>ALWAYS keep CMF right at the bottom of the mod list if you are using KMM. Always.</li>
</ol>
<a class="header" href="#appendix-a-hrefhttpssteamcommunitycomsharedfilesfiledetailsid1354363596ui-modding-frameworka" id="appendix-a-hrefhttpssteamcommunitycomsharedfilesfiledetailsid1354363596ui-modding-frameworka"><h2>APPENDIX: <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1354363596">UI Modding Framework</a></h2></a>
<p>Pretty much the same reasoning, this mod was a breakthrough that allowed UI mods via scripting, and there are zero reasons not to have it around just in case one of your mods is actually using it or starts doing it.
This framework may be required by scripty mods that do pretty nifty stuff including new UI panels and such.</p>
<a class="header" href="#tolerant-tables" id="tolerant-tables"><h1>Tolerant Tables</h1></a>
<a class="header" href="#by-cataph-1" id="by-cataph-1"><h2>By Cataph</h2></a>
<a class="header" href="#whats-a-tolerant-table" id="whats-a-tolerant-table"><h4>What's a tolerant table?</h4></a>
<p><strong>A tolerant table is an arbitrarily defined table that will not crash when a <em>referenced</em> key is missing in a certain column.</strong> This is particularly relevant when you are overriding new content from another mod and it turned out that you do not need to port two or more tables just to provide background references for those keys. Instead, you need just one table for the value to edit.</p>
<p>It may also be a trap leading to stuff not working in your own mod while also not crashing to desktop.</p>
<a class="header" href="#registry" id="registry"><h2>Registry</h2></a>
<p>Here is a list of such tables and streamline overrides. We encourage you all to report any new findings, preferably in alphabetical order. When reporting new tables, please include the date, because we do not know if or when this kind of behavior can abruptly change CA-side, and older dates can be considered suspicious when you have weird crashes after a patch.</p>
<ol>
<li>
<p><strong>ancillary effects junction</strong></p>
<ul>
<li>tolerates missing <em>ancillary</em> as of 2nd November 2018</li>
</ul>
</li>
<li>
<p><strong>building culture variants</strong></p>
<ul>
<li>tolerates missing <em>building level</em> and <em>culture</em> (<em>likely sc and faction as well</em>) as of 26th March 2019.</li>
</ul>
</li>
<li>
<p><strong>building effects junction</strong></p>
<ul>
<li>tolerates missing <em>building level</em>, but not <em>effect</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>building units allowed</strong></p>
<ul>
<li>tolerates missing <em>building level</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>campaign stances factions junctions</strong></p>
<ul>
<li>tolerates missing <em>faction</em> as of 9th December 2018.</li>
</ul>
</li>
<li>
<p><strong>cdir events dilemma/incident/mission option junctions</strong></p>
<ul>
<li>tolerates missing <em>value</em> and <em>dilemma</em>, even in the assembly kit, as of 8th December 2018.</li>
</ul>
</li>
<li>
<p><strong>cdir military generator unit qualities</strong></p>
<ul>
<li>tolerates missing <em>unit</em> as of 12th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>effect bonus value ids unit sets</strong></p>
<ul>
<li>tolerates missing <em>effect</em> as of 5th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>effect bundles to effects junction</strong></p>
<ul>
<li>tolerates missing <em>effect</em> as of 18th August 2018.</li>
</ul>
</li>
<li>
<p><strong>faction rebellion units junctions</strong></p>
<ul>
<li>tolerates missing <em>faction</em> as of 2nd November 2018.</li>
</ul>
</li>
<li>
<p><strong>frontend faction effects junctions</strong></p>
<ul>
<li>tolerates missing <em>effect scope</em> as of 1st January 2019.</li>
</ul>
</li>
<li>
<p><strong>land units</strong></p>
<ul>
<li>tolerates missing <em>missing weapon</em></li>
<li>tolerates missing <em>historical+short descr, mount, attribute group</em> as long as the unit is not selected in-game, as of April 2019.</li>
<li>tolerates missing <em>engine</em>, but the supposed engine will not show up in battle, as of 12th November 2018.</li>
</ul>
</li>
<li>
<p><strong>land units to unit abilities junction</strong></p>
<ul>
<li>tolerates missing <em>land unit</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>main units</strong></p>
<ul>
<li>tolerates missing <em>campaign mount</em> as of 12th Orctober 2018.</li>
<li>tolerates missing <em>ui_groupings</em> on startup sometimes, and will crash on clicking Custom Battles otherwise.</li>
</ul>
</li>
<li>
<p><strong>melee weapons</strong></p>
<ul>
<li>tolerates missing <em>contact effect phase</em> as of 9th November 2018.</li>
</ul>
</li>
<li>
<p><strong>projectile bombardments</strong></p>
<ul>
<li>tolerates missing <em>projectile type</em> as of 12th November 2018.</li>
</ul>
</li>
<li>
<p><strong>special ability phase stat effects</strong></p>
<ul>
<li>tolerates missing <em>phase</em> as of 9th November 2018.</li>
</ul>
</li>
<li>
<p><strong>special ability groups to units junction</strong></p>
<ul>
<li>tolerates missing <em>unit</em> as of 20th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>technology nodes</strong></p>
<ul>
<li>tolerates missing <em>faction</em> as of 1st January 2019.</li>
</ul>
</li>
<li>
<p><strong>unit set unit attribute junction</strong></p>
<ul>
<li>tolerates wrong <em>attribute</em> as of 20th Orctober 2018.</li>
</ul>
</li>
<li>
<p><strong>unit set to unit junction</strong></p>
<ul>
<li>tolerates missing <em>main unit</em> as of 20th August 2018.</li>
</ul>
</li>
<li>
<p><strong>unit variants</strong></p>
<ul>
<li>tolerates missing <em>land unit</em> as of 26th March 2019.</li>
</ul>
</li>
<li>
<p><strong>units to groupings military permissions</strong></p>
<ul>
<li>tolerates missing military group as of 12th December 2018.</li>
</ul>
</li>
<li>
<p><strong>ui unit bullet point unit overrides</strong></p>
<ul>
<li>tolerates wrong <em>unit</em> as of 27th February 2019.</li>
</ul>
</li>
</ol>
<a class="header" href="#unit-card-guide" id="unit-card-guide"><h1>Unit Card Guide</h1></a>
<a class="header" href="#by-cataph-2" id="by-cataph-2"><h2>By Cataph</h2></a>
<a class="header" href="#why" id="why"><h2>Why</h2></a>
<p>Hello, my name is Cataph and I am a cardoholic.</p>
<p>You made a new unit and you need a new flashy unit card. Simple. No, it ain’t.
Unit cards are probably <strong>the unit’s component you will be staring at for the majority of the time</strong>, even more than the actual variant. Get it wrong and it can be an eyesore for the entire campaign and battle.</p>
<p><strong>A good unit card will</strong>:</p>
<ul>
<li>blend in with other vanilla pieces</li>
<li>show the unit’s appearance</li>
<li>display, possibly, its character and gear and role</li>
</ul>
<a class="header" href="#what" id="what"><h2>What</h2></a>
<p>But first things first.
<strong>A unit card is a 60x130 PNG</strong>. Don’t make it larger than that or it will automatically be compressed in-game and lose more quality than if you did it yourself.
<strong>Its location is ui/units/icons</strong>, and it’s a good idea to open the data.pack and extract that folder for future reference. Its name needs to be the same in the card column in the <code>unit_variants</code> table.
In units/info you may find a version with a larger “shredded frame”, this is however only used in loading screens, so ignore that unless you need those for promo or stuff like that.</p>
<a class="header" href="#how" id="how"><h2>How</h2></a>
<p>You can use stuff like GIMP or Photoshop to assemble a unit card. Personally I use the latter so I will use its lingo.
Making nice cards is not easy. During the transition between Rome2’s and Warhammer’s art style I made truly <em>horrendous</em> cards myself, but with time I noticed things and developed some tricks.</p>
<p>Most CA cards are similar to existing GW artwork, but are still made by a proper artist. I am surely not one, but you’ll want to respect these factors:</p>
<ul>
<li><strong>Positioning</strong> of the portrayed unit: not too zoomed in, not too far away; varies with races too (notice how Empire cards tend to have a western knee-cut, Dwarfs a full body).</li>
<li><strong>Lighting</strong>: CA cards are generally good luminosity, low contrast but with drawn highlights. This is important, you don’t want your card to be a confused blob.</li>
</ul>
<p>Before we get to the chase, <a href="files/template.psd">get this template</a>! Always periodically test with the card frame on top, I used to get immensely pissed off when important details of my card got hidden by the UI. You will never see the entire card in the game, especially on ranged units due to the additional ammo bar. Remember to hide the frame again when you’re done. It’s a PSD file, but should work just fine in GIMP too.</p>
<a class="header" href="#the-three-jedi-ways" id="the-three-jedi-ways"><h2>The Three Jedi Ways</h2></a>
<p><strong>[please don't use the sampled pictures without permission]</strong></p>
<ol>
<li><strong>THE ARTWORK</strong>. You grab a <em>legal</em>* and beautiful artwork around, and tweak it until it fits and shines. Usually the quickest method, but it requires a good sample. Example below, for my Skullreapers, <a href="https://vignette.wikia.nocookie.net/warhammerfb/images/7/76/BORKIL.jpg/revision/latest?cb=20130829160001">based on this artwork</a>.</li>
</ol>
<p><img src="images/1_3-01.png" alt="skullreepz" /></p>
<ol start="2">
<li><strong>THE MONTAGE</strong>. You grab parts from existing CA cards and glue them together. This may look simple but it’s actually an excellent way to get god-awful cards, because each bloke in a card may have its size, positioning and lighting, and mixing them may not work like you’d think. You don’t want your card to look like the portrait of the Frankenstein’s Monster, or too samey with the neighbouring unit.
Working examples: below for my Estalian Lancers, <a href="https://cdn.discordapp.com/attachments/374122686034477057/452435403610259457/berserker_champion.png">or this infopic by not-a-spoon</a>.</li>
</ol>
<p><img src="images/1_3-02.png" alt="lancels" /></p>
<ol start="3">
<li><strong>THE PHOTOSHOOT</strong>. You take things in your hands and start taking screenshots of the unit in-game. This can be a lengthy process, especially for cavalry and ranged units, but can be quite satisfying and produce a faithful portrait of the unit. It’s my favourite and most used method, and the one I’m going to describe.
This is also where Positioning and Lighting really come to play.</li>
</ol>
<p>* Remember that you can't use non-WHFB stuff and if fan-art, you want to check/ask permission.</p>
<a class="header" href="#guide-to-the-photoshoot" id="guide-to-the-photoshoot"><h2>Guide to the Photoshoot</h2></a>
<p><strong>First off you need to take a good screenshot</strong> in which the unit comes with a good pose, possibly no animation glitches and clipping. As said, you need something that will fit in a 60x130, so some photography experience may come in handy.</p>
<p>Here are two examples that can give you an idea of how to crop and photoshop a battle screenshot and what the final result can potentially look like.</p>
<p><img src="images/1_3-03.png" alt="ayy" /></p>
<p>These two blokes are Estalian reskins for Swordsmen and Spearmen. As you can see, the pose needs to fit in a quite longilineal frame, so not all stances will work and also why cavalry is more difficult. You want to show at least part of the body and weaponry.
<em>Protip! Use a better camera mod and the &gt;N&lt; key high-detail camera for better screenshots.</em></p>
<p><img src="images/1_3-04.png" alt="bee" /></p>
<p>Usually you will want a decent lighting, so no early dawn or cloudy battles. You can still make those work but it’s harder. For these guys I wanted a sunny look instead of the gloomy Empire cards.</p>
<p>The beginning may be as simple as auto-tuning Luminosity and/or Tone to remove weird tints.
Afterwards you want to reduce contrast (by a lot, even up to 100!) and probably still increase luminosity (otherwise they are likely going to look quite bleak in-game).
Test in custom battle selection until it’s not a grey blob anymore.</p>
<p>Then comes the holistic and complicated part.</p>
<p><strong>Protagonism</strong>: the bloke must be instantly distinguishable from the background. Selecting them and making them a separate layer is always a good idea. Afterwards you may further lighten or darken the background stuff. Blurring also works but I usually don’t like it, it can look too fake. Giving it a <em>minimalist</em> oil paint touch can also help.</p>
<p><strong>Background</strong>: when you have extra time and experience in your hands, you may want to add smoke, happy clouds, grim clouds, that sort of thing, behind the protagonist’s layer. Can look really cool.</p>
<p><strong>Contours</strong>: this is the secret recipe and why we lowered contrast. We said CA cards are artworks, and they have visible dark contours to highlight parts. So we start drawing them (1-2 pixel width) with medium hardness brush or pencil in black and white in a new layer. Usually it looks good when it’s set as Soft Light, probably between 60 and 100% opacity, tweak at will. Contours can make a huge difference between a flat icon and one that can blend in with vanilla ones.
Examples (Empire Archers and Teutogen Guard) without and with contour:</p>
<p><img src="images/1_3-05.png" alt="yaaaas" /></p>
<p>The cards were already heavily-engineered, but you can still notice an improvement.
In any case, you will still check how the card looks in custom battle (where it’s extra tiny) and in the following loading screen. Sometimes it will suck so hard that it’s back to the drawing board, but that’s ok.</p>
<p>For a true step by step tutorial I’m gonna need a fresh unit card project. Stay tuned.</p>
<p>Consolation prize, my first and terrible unit card for WH1, versus the same unit in WH2:</p>
<p><img src="images/1_3-06.png" alt="rip" /></p>
<p><img src="images/1_3-07.png" alt="yay" /></p>
<a class="header" href="#appendix-character-icons" id="appendix-character-icons"><h2>APPENDIX: Character Icons</h2></a>
<p><strong>Characters want their portraits too</strong>, of course.
Their cards are kept in ui/portraits/units/(designated culture) and are quite simpler to make. You follow the Photoshoot method, fix the tone, lower contrast, increase luminosity, and bam, done. Except that you want to use that faction’s face-to-frame size ratio to make it look better next to the other heroes and lords. For example Empire characters tend to be more zoomed-out, whereas Vampires have a creepier and closer portrait (you can recognize a bloodsucker by their selfies).
Making that stuff actually work in campaign is done <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1194811468">by following the binning guide</a>.</p>
<a class="header" href="#building-buildings" id="building-buildings"><h1>Building Buildings</h1></a>
<a class="header" href="#by-vandy" id="by-vandy"><h2>By Vandy</h2></a>
<a class="header" href="#so-you-want-to-build-a-building" id="so-you-want-to-build-a-building"><h3>So you want to build a building?</h3></a>
<p>Buildings are a great feature in the game, and editing them can allow for a lot of fun new mechanics! New building chains can allows new units, new effects, and new landmarks. The best news of all is that most ideas with building chains are possible.</p>
<a class="header" href="#vocabulary" id="vocabulary"><h3>Vocabulary</h3></a>
<p>I want to first cover some vernacular that we will be using throughout this tutorial. These terms are conceptual but critical to understanding what Creative Assembly is manipulating in their game files.</p>
<ul>
<li><strong>Key</strong>: A key is an identifier, a definition point in the database.</li>
<li><strong>Id</strong>: An id is similar to a key in that it is an identifier, except it is a randomly generated number used in certain tables of the database.</li>
<li><strong>Level</strong>: A level is each individual building that you can construct in the game. They can be one-off or individual, or they can be upgraded into other buildings. The Empire tier 1 barracks, tier 2 barracks, and the tier 3 barracks are each a level.</li>
<li><strong>Chain</strong>: A chain is much like it sounds - a direct chain of buildings. In the images, below. each vertical set of buildings that can be upgraded is a chain. The tier 1 barracks, the tier 2 barracks, and the tier three barracks are each a level.</li>
<li><strong>Building Availability Set (BAS)</strong>: A building availability set is the link between building chains and the faction/culture/subculture that can build them.</li>
<li><strong>Superchain</strong>: A superchain can be seen as a collection of various chains from different races/factions, which can save data space when linking to slot templates (the only way to link buildings to locations). For instance, all settled factions except for the Wood Elves (due to their unique building style) have their standard infantry building linked to the <code>wh2_main_sch_military1_barracks</code> superchain, which is available at all settlements. It consolidates the entirety of your buildings into one package.</li>
<li><strong>Set</strong>: A set is more or less a visual effect that conveys a category. As you'll see in the images below, &quot;Military Recruitment&quot; and &quot;Infrastructure&quot; are examples of buildings sets, which lump together various different building chains into a specific group.</li>
<li><strong>Slot Template</strong>: The database (db) classification of various locations, and the union between buildings and regions. Slot templates allow you to lock buildings to specific locations (for example, landmarks). However, <strong><em>not every settlement has a unique slot template.</em></strong> For instance, Altdorf has the slot templates <code>wh_main_special_altdorf_primary</code> and <code>wh_main_special_altdorf_secondary</code>, while Bibali has the basic &quot;wh_main_human_minor_primary_coast&quot; slot template. As we see in an unmodded game, Altdorf has unique buildings in, while Bilbali does not, so we can infer that Creative Assembly had no need to add in a custom slot template for the latter.</li>
</ul>
<p><img src="images/2_1-01.png" alt="test" />
<img src="images/2_1-02.png" alt="test" /></p>
<a class="header" href="#getting-started" id="getting-started"><h3>Getting Started</h3></a>
<p>First off, you'll want to get your idea(s) in order. You want to make a building, but what will this building do? Where can it be built? Is this building locked to certain cultures/factions? How many levels will it have? Having an answer to each of these questions will help you carry on through the tutorial.</p>
<p>Now, you'll want to open up Rusted Pack File Manager (RPFM) and the Assembly Kit. RPFM is where you'll be peforming all of your work - the Assembly Kit is more of less going to be used as a glorified search engine.</p>
<p>Open up RPFM, go up to Packfile -&gt; New Packfile. Right click this new packfile (called unknown.pack) -&gt; Add -&gt; Add from Packfile.
The &quot;Select Packfile&quot; window will open, go to wherever you installed Warhammer 2 -&gt; click on the data folder -&gt; and then find and select the data.pack to open.</p>
<p>On the right hand side, the &quot;Add from Packfile&quot; Mode will open, and you'll see a file hierarchy of the different folders and tables within the pack. Look for the folder marked &quot;db&quot; and expand it. There will be a list of subfolders. Scroll through, expand the following subfolders and add the following tables from the data.pack:</p>
<ul>
<li>building_chains_availability_sets_tables</li>
<li>building_chains_tables</li>
<li>building_culture_variants_tables</li>
<li>building_effects_junctions_tables</li>
<li>building_instances_tables</li>
<li>building_levels_tables</li>
<li>building_set_to_building_junctions_tables</li>
<li>building_superchains_tables</li>
<li>building_units_allowed_tables (Only needed if you will be linking units to the building)</li>
<li>building_upgrades_junction_tables (Only needed if you will have more than one level)</li>
<li>slot_template_to_building_superchain_junctions_tables</li>
</ul>
<p>Once you have added each table, click the &quot;Exit 'Add from Packfile' Mode&quot; at the top center of the screen.</p>
<p>You will also have to add a few files for the localisation of the building mod, so let's do that now. As before, right click the packfile and add from packfile, this time grabbing the local_en.pack to open.
Scroll through and add the following tables from local_en.pack:</p>
<ul>
<li>building_chains__.loc</li>
<li>building_culture_variants__.loc</li>
<li>building_short_descrptions_texts__.loc</li>
</ul>
<p>That's it for importing! In the future, you may need more tables such as effects if you're going in to that, however this tutorial will not be covering that action.</p>
<a class="header" href="#inputting-data" id="inputting-data"><h3>Inputting Data</h3></a>
<p>The very first thing that I recommend is to go into the building_superchains table and delete all rows. If you have not changed around any hotkeys (which you can do by the way by going to Packfile -&gt; Preferences), you can delete all rows in the table by clicking an entry in the table -&gt; <code>CTRL+A</code> to select all in the table -&gt; <code>DELETE</code>.</p>
<p>Let's add in a new row by pressing <code>CTRL+SHIFT+A</code>. From here, we can add in your new key. It can be named whatever you want, but we advise that you rename it to something that's not already a vanilla key or looks like it could be a vanilla key. You don't want to assume vanilla keys, as it will make the game freak out. Depending on what I'm making, I either prefix with vandy_ or prussian_, but you could go with whatever works for you. <strong>Just don't assume vanilla keys.</strong></p>
<p>I recommend writing an easy key, one that you can copy over through various tables and use interchangeable. If I were to make a new horde building for the Empire, I would probably call it &quot;vandy_empire_horde_main&quot; if it were the primary building, or &quot;vandy_empire_horde_barracks&quot; if it were the barracks. You could also easily do &quot;empire_main&quot; and &quot;empire_barracks&quot;, but keeping a unique prefex on all of your work helps with organization.</p>
<p>After that, go the slot_template_to_building_superchains_junctions. Don't delete anything just yet! Here is where we actually want to link the building we are making to a location or locations. There are three columns we want to worry about: building_superchains, id, and slot_templates.</p>
<p><strong>Note:</strong> If the building or building chain is not in here, then it will not show up in any settlements.</p>
<p>If you are making this into a horde building, you would assign it to the horde_primary slot for the main building, or horde_secondary for any others.</p>
<p>If you are making this into a settled building, you would have to have to input your building to all the different slot_templates. The four main slot_templates are</p>
<ol>
<li>wh_main_human_major_primary (a province capital's main building)</li>
<li>wh_main_human_major_secondary (any other building in a province capital)</li>
<li>wh_main_human_minor_primary (a regular settlement's main building)</li>
<li>wh_main_human_minor_secondary (any other building in a regular settlement)</li>
</ol>
<p>Remember, there are also unique slot_templates for all different resources, all unique locations, several new resources made for Warhammer 2, and some older and antiquated slot_templates such as &quot;wh_main_dwarf_orc&quot;, used for the Regional Occupation system in Warhammer 1 that is currently unused in Warhammer 2.</p>
<p>I'll let you in on a little secret - typing out all the slot_templates is unnessary and tedious. Open up the Assembly Kit real quick, go into the slot_template_to_building_superchains_junctions table and open up the Search function. Change the column filter to &quot;building_superchain&quot; and type in &quot;wh2_main_sch_military1_barracks.&quot; This will only show the junctions between the barracks superchain and all slot templates that the barracks superchain is available in. Thus, this superchain includes all beginner military superchains for each race - such as the Cemetary for the Vampire Counts. Grab the entire Slot Templates column from the Assembly Kit and paste it into the corresponding table in your mod back in RPFM. Secondly, take your building_superchain key and paste it in each entry of the column.</p>
<p>One last step - we need to assign unique id numbers to each of these entries. Now, Creative Assembly used random generated id numbers for their entries, and there are hundreds of thousands of entries within these game files. Thus, you probably can't use 1 or 10 or 100 for any of these entries. I recommend being safe and using 8 digit (1906015) id numbers for each superchain entry.</p>
<p>If you did this right, this action should now apply that superchain's availability to each and every settlement on the map. You'll have to repeat this step for each new building chain.</p>
<p><strong>Note:</strong> There is only the need for one superchain for a link of buildings you can upgrade, but you will need one superchain for each separate link of buildings.</p>
<a class="header" href="#building-the-building" id="building-the-building"><h3>Building The Building</h3></a>
<p>Now that the boring part is done, we can move into the nitty-gritty! Next step is in building_chains_tables. Most of this table does not actually do much, yet we still need it. Again, <code>CTRL+A</code> to select all, then <code>DELETE</code> to delete all previous entries in this table. There are 9 coluymns in this table but we are only going to be worried about 3 of them: key, chain category, and building superchain. In the first column, &quot;key&quot;, input a unique key for your building chain. I recommend using the same key as the superchain, but you do not have to! Skip over to chain category. For this column, you're either going to enter in &quot;military&quot; or &quot;money&quot; as an entry. Ask yourself: Is this building or building chain that I am making going to be used for recruitment or combat capabilities? If so, enter in &quot;military&quot;, otherwise input &quot;money&quot;. Lastly, enter in your building_superchain key in the building superchain column. Voila, another table completed!</p>
<p>Next up, you want to make a new_building_instances key. This table determines how many of a certain building we can have in a settlement. Delete all those previous entries, make a new row. You're going to want to input your building_chain key in the first column. For the second column, &quot;1&quot; is the most common value, but if you wanted to add in a set of, say, three buildings, and allow the player to only choose <strong>two</strong> of them at once, you would enter &quot;2&quot;. Keep in mind that this is only for a <strong>single settlement</strong>, not an entire province.</p>
<p>After this we will click on over into the building_levels_tables, which will be each individual link in the building chain. Much as a Cemeetary upgrades into a Graveyard, you can have your building upgrade into another building.</p>
<p><strong>Note:</strong> If your building only has one level, like a landmark, you still need this table.</p>
<p>For the &quot;level_name&quot;, type in your building_chain name with the sufix &quot;_1&quot;, and increase it for each further step in the chain. The &quot;chain&quot; column should have you put in your unique building_chain key. For &quot;level&quot;, enter 0 for the first level, then increase by one as you go up the chain. Every building chain MUST start with a building at level 0, this does not mean that you can build your building when the settlement is a ruin! From here, a lot of stuff is just details - how many turns does your building take to build, how much does it cost to construct, does your building have an upkeep cost (which is a negative value taken every turn from your treasury), and a whole string of things that are no longer used for this game.</p>
<p>After upkeep, scroll to &quot;can_convert&quot; and put a check in each of your building entries. Without this, the buildings cannot be destroyed. Insert the building_instance_key that you made earlier into the &quot;building_instance_key&quot; column. Scroll over again to the &quot;can_be_damaged&quot; and put a check in each of your building entries, so that your building can be damaged after bring razed or sacked.</p>
<p><strong><em>Note:</em></strong> The Development Point Cost column is a modifier to make the building cost Population Surplus. This can be used for any building, but it is seen in the game through main settlement and horde buildings only.</p>
<p>We are not done yet in here! The next column, Primary Slot Building Building Building Level Requirement, determines what level the main building needs to be at to construct this building. If you input &quot;1&quot;, then this building can be constructed at a Tier 1 settlement. Conversly, if you input a &quot;3&quot;, then this building can only be constrcuted at a Tier 3 settlement. Each separate level needs to have a different primary slot requirement! Lastly, check off each entry in the Visible in UI column and head on over to building_culture_variants_tables.</p>
<p>This is where you build what your building looks like - its name, its icon, its description. You can use this table to change how it looks between cultures/factions as well.
For now, however, delete all previous entries like usual, add a new row, and input your building chain entries in the Building column, so i.e. &quot;vandy_empire_barracks_1&quot; to &quot;vandy_empire_barracks_3&quot;. Next, enter the culture, subculture, or faction key of the group you're making this for in each entry - use the Assembly Kit to search for that! For instance, my building was for the Empire, so I entered &quot;wh_main_sc_emp_empire&quot;. The Description column is not used, just put in &quot;wh_main_PLACEHOLDER&quot;. For the Artpiece column, enter either the name of the vanilla icon or import your own. The UI location is ui/buildings/icons/%.png. At the end, check off for each entry the display_tooltip.</p>
<p><strong>Note:</strong> This table needs either a &quot;faction&quot; entry or a &quot;culture&quot; entry. You can use both, but it needs at least one to function.</p>
<a class="header" href="#only-a-few-more-db-tables-to-go" id="only-a-few-more-db-tables-to-go"><h3>Only a few more db tables to go!</h3></a>
<p>From here, we have to make this building do stuff, link it to who can built it, and edit where it shows up in the buildings panel, finishing off with flavor text for all of it in game.</p>
<p>Go to building_chain_availability_sets_tables. <strong>(You should know by now to clear out these existing entries and making new rows for your own entries by now, so I'll stop saying it)</strong> This table is used to link the bulding to who can build it. The first column we input, you guessed it, the building_instances key, so i.e. &quot;vandy_main_empire_barracks&quot;. Continuing with the example, I am making my buildings for the Empire, so I enter &quot;wh_main_bas_emp&quot; for the second column. If your building is not supposed to be bult by the Empire, the Assembly Kit will help you find the availability set you want to use.</p>
<p><strong>Note:</strong> If you wanted to, you can make your own custom BAS, but it is not always required unless you're making a new culture or subculture. if you tie your building to an existing BAS - say, wh_main_bas_emp but then only give a culture variant to the Midenheim faction, then only Middenheim will be able to build it. This is very useful for excluding certain factions from buildings and much more flexible (and simpler) than using a custom BAS.</p>
<p>Let's now open up building_set_to_building_junctions_tables. This is where the building will show up in the Building Panel in-game, whether it's in &quot;Military Recruitment&quot;, &quot;Military Support&quot;, &quot;Infrastructure&quot;, or &quot;Defense.&quot; Building sets are culture specific, so once more let's open up the Assembly Kit and look in this table for what building set you need. I entered my building in &quot;wh_main_set_empire_military_support&quot;, so it will show up in-game under the Military Support category in the Building Panel. Find your key and enter in the new building. I recommend entering the building_instances key instead of the building_levels.</p>
<a class="header" href="#whoo-hoo" id="whoo-hoo"><h3>Whoo-hoo!</h3></a>
<p><strong>You now have a useless icon that costs money</strong></p>
<p>Let's give it something to do - go into the building_effects_junctions tables, and let's add in an effect. My building for this example is going to add +10 Public Order for this tutorial (even though we've been running with a barracks example... -pw), so I will go back to the Assembly Kit and search for a public order effect in the vanilla buildings and see how they add it.</p>
<p>Looks like I have to add my building in here, then use the effect key &quot;wh_main_effect_public_order_base&quot; under the Effect column, link &quot;province_to_province_own&quot; in the Effect Scope column, and add in my own value. I'm giving it +10 Public Order, so I'll enter &quot;10&quot; in for the value. The Value Damaged and the Value Destroyed columns convey the amount of effect to give when the building is damaged and when the building is ruined, respectively.</p>
<a class="header" href="#localisation-or-fleshing-out-what-the-heck-you-made" id="localisation-or-fleshing-out-what-the-heck-you-made"><h3>Localisation, or fleshing out what the heck you made</h3></a>
<p>Localisation files can be annoying and fickle, so let's get through this as smoothly as we can. Open the building_culture_variants.loc and make sure you add one new row for each &quot;level&quot; you made after you cleared out the previous entries.</p>
<p><strong>The format needs to be as follows:</strong> &quot;building_culture_variants_name_[name_of_your_building_1][culture][subculture][faction]&quot;</p>
<p>Whatever culture or subculture or faction you linked in the culture_variants table NEEDS to be formatted properly here or it will not pop up.</p>
<p><strong>My entry would look like this:</strong> &quot;building_culture_variants_name_vandy_main_test_building_1wh_main_sc_emp_empire&quot;</p>
<p>In the localised string, I input &quot;Test Building.&quot; This will be the name of each individual level. In building_short_description_texts.loc, you ONLY ned the name of the building, and the description you want to pop underneath the name. I input &quot;building_short_description_texts_short_description_vandy_main_test_building_1&quot;, with a localised string that says &quot;This is a test building!&quot;</p>
<p>Lastly, in building_chains.loc we can enter the chain name that pops up under the name of the building. I input: &quot;building_chains_chain_tooltip_vandy_main_test_building_1&quot; with the localised string &quot;Testing!&quot; for the entry.</p>
<a class="header" href="#you-did-it" id="you-did-it"><h3>You Did it!</h3></a>
<p><img src="images/2_1-03.png" alt="test" /></p>
<p>Your first building or building chain is completed! Go on, pat yourself on the back. There are plenty of creative options with buildings - you can introduce penalties and consequences to new building chains, or create interesting links of, say, two different buildings that can both get to level 3, but you can only get one to level 4 or 5. It is possible to link units to buildings, either vanilla or custom; link new technologies, and even create band new landmarks.</p>
<a class="header" href="#troubleshooting" id="troubleshooting"><h3>Troubleshooting</h3></a>
<p>Something happened and now you are getting a crash.That happens and it's okay, we can fix it. There's a couple things that you can check off the list to figure out where it's coming from.</p>
<ol>
<li>Typos in the .loc files, or the absence of them, will not cause a crash. It just means that the text that you wrote will not show up.</li>
<li>Typos in the data/tables will <strong>100%</strong> cause a crash. If you reference a non-existent key in one of the above tables, like linking a misspelled superchain to the wh_main_human_major_secondary slot template, the game will crash on start-up. This is because when the game is loading up the data, it cannot establish or identify that non-existent key in the ways it knows how and cannot continue.</li>
<li>Missing information can sometimes cause issues, for example, if you did not link a culture_variant for your levels.</li>
<li>Empty rows! This is a fun one that can also cause unintended results. Make sure you go through each table and delete any rows that you do not need.</li>
<li>Did you assume a vanilla key would work before verifying it exists? The Total War Franchise was developed and coded by people, and if we know anything about people, it's that consistency is more an ideal than a standard at times. Naming schemes, formats, and even data entries themselves have been changed and removed from patch to patch. Go back and verify that effect scope from the Assembly kit, it could be the issue.</li>
<li>Please rename your tables and your mod. There is no reason to not rename your tables and your mod, and problems can ensue otherwise. Oh, and please make sure you are using unique id's for these tables! If you use vanilla ones/id's from other mods, then you're ensuring incompatibility.</li>
</ol>
<p>Thanks for reading!</p>
<a class="header" href="#localisation" id="localisation"><h1>Localisation</h1></a>
<a class="header" href="#by-vandy-1" id="by-vandy-1"><h2>By Vandy</h2></a>
<p>Hello and welcome! Look no further for a simple tutorial to create custom text in <em>Total War!</em></p>
<p><strong><em>PLEASE NOTE:</em></strong> <em>This tutorial assume basic knowledge of PackFiles, the modding tools available, and other basic nomenclature regarding modding.</em></p>
<p>Firstly, yes - obviously, custom text is possible, otherwise I wouldn’t have typed these words into this internet. Text in-game is known as localisation, and consists of basically all text you see - from the Help Pages, to building names, to mission text, to subtitles in quest battles - all of these are localisable text, meaning we can edit or add text.</p>
<p>There are two ways to edit and add text, and I'll show them both in turn. While the PackFile editing method is probably the one most will use - and the one I recommend - we'll go over both. Assembly Kit Localisation is good to know just for visualization, and it will help me teach your how to use it in the PackFile, so please read on!</p>
<a class="header" href="#ak-localisation" id="ak-localisation"><h4>AK Localisation</h4></a>
<p>Making new localisation in the Assembly Kit is remarkably simple. All you have to do is find the columns with the localisation you want to add, fill in the text, apply your changes. After using <code>Export -&gt; Export Changes to Binary</code>, close DaVE and open up BoB. Within BoB, use the <code>Retail Pack</code> option, and boom, your localisation files are done!</p>
<p>One BIG thing to note here: just like exporting db in the Assembly Kit, it has <em>all</em> records within that .loc file, not just the ones you've edited. This is real bad for compatibility, so you should know how to directly edit the .loc file. Read on!</p>
<p><strong><em>WARHAMMER II USERS:</em></strong> <em>At the date of this publication (July 3, 2019), the Localisation feature of the retail AK for WH2 is disabled. To enable it (which is really easy), check out the bottom section, way down below..</em></p>
<a class="header" href="#packfile-localisation" id="packfile-localisation"><h4>PackFile Localisation</h4></a>
<p>You can either copy over a .loc file, thieved from either a CA retail pack or something exported from AK like above, or create a new one from scratch. The former can be done either with the <code>Add -&gt; Add from Packfile</code> action in RPFM, or just &quot;Add File&quot;, whereas created a new one can be done with the <code>Create -&gt; Create Loc</code> action. Make sure the path for the .loc file is in <code>.pack/text/db/</code>.</p>
<p>However you do it, you'll get something like the following picture, with three columns: <code>Key</code>, <code>Text</code>, and <code>It Doesn't Really Matter, Just Set It To True</code>.</p>
<p><img src="images/chapter_1_vandy_2/04.png" alt="test" /></p>
<p>With some understanding of how AK Localisation works, this is rather simple. First thing's first - the <code>Text</code> column is the text that shows up in-game. That's all I'm gonna say about it for now, though I'll go over some extra things we can do with localisation later on.</p>
<p>The <code>Key</code> is the important part. It is composed of three separate parts - the <strong>table</strong>, the <strong>column</strong> within the table, and the <strong>key of the db object</strong>.</p>
<p><code>tablename_columname_key</code></p>
<p>We can see in the image above, all of them start with <code>effect_bundles</code>, which is a reference to the db table.</p>
<p>After that, all of them have either <code>localised_text</code> or <code>localised_description</code>. These are the two columns we can see in the Assembly Kit for the effect_bundles table. Some tables have only one localisable field, some have many - just check the Assembly Kit or existing .loc files for what those are and what they're used for.</p>
<p>The last one is the <em>db</em> key. For example, if we look up <code>wh_main_payload_disaster_flood_region</code> in the effect_bundles table in the Assembly Kit, we can see it's an actual key used in that table:</p>
<p><img src="images/chapter_1_vandy_2/05.png" alt="test" /></p>
<p>For the case of the flood_region effect bundle, we can see it broken down into the three parts.</p>
<p>First, there's the table name: <strong>effect_bundles_</strong></p>
<p>Then, there's the column name: <strong>localised_text_</strong></p>
<p>Then, the key: <strong>wh_main_payload_disaster_flood_region</strong></p>
<p>The three of those link up to make <code>effect_bundles_localised_text_wh_main_payload_disaster_flood_region</code>, which links to the text &quot;Flooding&quot; within the effect_bundles__.loc file!</p>
<p>That's all there really is to localisation! You can add new rows in a .loc file, set the <code>Key</code> properly and the <code>Text</code> will show up.</p>
<p>When doing PackFile Localisation, you need to keep a handful of things in mind:</p>
<ul>
<li>The <strong>name</strong> of your .loc file needs to be <em>different</em> than the vanilla .loc file, and a <em>higher alphanumerical priority</em>. If the vanilla .loc file is called <code>effect_bundles__.loc</code>, call yours something like <code>!mod_name_effect_bundles.loc</code>. You can really call it whatever, like <code>!yay_I_made_a_mod.loc</code>.</li>
<li>You can divide the .loc files up by table, like they are in vanilla - or you can have them all in one big .loc file. It's up to you!</li>
<li>The .loc files <em>need</em> to be in the folder structure <code>./pack/text/db</code>.</li>
</ul>
<a class="header" href="#excelling-at-localisation" id="excelling-at-localisation"><h4>Excelling at Localisation</h4></a>
<p>If you have Excel, or another data program, it's incredibly easy to automate localisation. I used to type every single loc key, until one day I decided to start concatenating, and it's reduced time spent <em>tremendously</em>. Continuing with the same example above, I would set up a new worksheet with the following:</p>
<p><img src="images/chapter_1_vandy_2/06.png" alt="test" /></p>
<p>Column A, the table key, Column B the db column key. Column C will be filled out with db keys (normally, copied from RPFM or the AK).</p>
<p><img src="images/chapter_1_vandy_2/07.png" alt="test" /></p>
<p>In Column D, I set up a concatenation formula to combine columns A, B, and C.</p>
<p><img src="images/chapter_1_vandy_2/08.png" alt="test" /></p>
<p><img src="images/chapter_1_vandy_2/09.png" alt="test" /></p>
<p><img src="images/chapter_1_vandy_2/10.png" alt="test" /></p>
<p>At that point, copy the D2 function, and paste it for the rest of the rows.</p>
<p><img src="images/chapter_1_vandy_2/11.png" alt="test" /></p>
<p>And that's it. Copy the stuff you want to export, and paste it into a .loc file within RPFM.</p>
<a class="header" href="#common-pitfalls" id="common-pitfalls"><h4>Common Pitfalls</h4></a>
<p>It doesn't work! Here are some common mistakes with localisation:</p>
<ul>
<li><strong>Misnomer</strong>: Double, triple, and double check your spelling.</li>
<li><strong>Underscore</strong>: Make sure every bit of a loc key is split by an underscore. There should be one between table and column, and another between column and key.</li>
<li><strong>The Final Frontier</strong>: Make sure there are no spaces in the loc key.</li>
<li><strong>Combo keys</strong>: common case localizing building_culture_variants, you have to include any culture/subculture/faction key you have in the building's line, in that order, whenever present. Analogous to how UITR work (below).</li>
<li><strong>Who Knows?</strong>: Sometimes it just doesn't work. If nothing else, try remaking it from scratch.</li>
</ul>
<a class="header" href="#localisation-options" id="localisation-options"><h4>Localisation Options</h4></a>
<p>There are a couple of cool things we can put in the localised text, such as colored text, or images. I'll go over the most common ones here:</p>
<p><strong><strong>VALUE</strong></strong></p>
<p>You'll see in the <code>effects</code> table <code>%+n</code>. This is a wildcard that replaces itself with whatever the value in the <code>value</code> column is, when that effect is linked to an effect bundle or building or skill or what-have-you. So if the effect's text is something like &quot;This increases something by %+n&quot;, and the value in <code>effect_bundle_to_effects</code> is 5, it'll read &quot;This increases something by 5&quot;.</p>
<p><strong><strong>COLOURS</strong></strong></p>
<p>If you'd like to make coloured text, you can wrap text with <code>[[col:col_key]] %text% [[/col]]</code>. You can find the keys in the table <code>ui_colours</code>. I don't believe it's possible to setup new colours, but I haven't tried.</p>
<p>I am told there is also used, somewhere, the following format: <code>[[rgba:91:30:0:255]] text [[/rgba:91:30:0:255]]</code>, for <strong>r</strong>ed <strong>g</strong>reen <strong>b</strong>lue <strong>a</strong>lpha. If you find this works, please confirm with me!</p>
<p><strong><strong>TAGGED IMAGES</strong></strong></p>
<p>You can make little cute images within a localised text. For exmaple, there are icons often in help pages before keywords. All you have to do is use the following tags: <code>[[img:img_key]][[/img]]</code>. You can find the keys in the table <code>ui_tagged_images</code>. You <strong>can</strong> make new images!</p>
<p><strong><strong>PARAGRAPHS</strong></strong></p>
<p>You can make a line break with <code>\n</code>. Use it sparingly, it won't work in most locations, but works fine for things like missions, events, loading screen quotes. I recommend checking vanilla application before using it.</p>
<p>There is also a CA shorthand for creaking line breaks on UI components, <code>||</code>. I'm not perfectly familiar with when this should or shouldn't be used, but I've seen it for things such as: occupation options, frontend text, loading screen quotes, and most commonly, UI localisations. Test as you wish to see it work or not, and check with vanilla.</p>
<p><strong><strong>UI TEXT REPLACEMENTS</strong></strong></p>
<p>UI Text Replacements (uitr, henceforth) are awesome lil' buggers to help you from typing the same thing over and over again. You can refer to a uitr with the tag <code>{{tr:tr_key}}</code>. You can find keys with the table <code>ui_text_replacements</code>. New ones are doable! Just make a new key in the table, and make a new row in a .loc file.</p>
<p>One great application is to prevent typing the same thing over and over again, and instead refer to the same text replacement. You can define one and refer to it within various different localised fields.</p>
<p>A <em>greater</em> application is to allow the same text to show differently between different factions. For instance, the text for money shows up as 'Treasury' for most factions, and 'Dark Magic' for Vampire Counts, in WH2.</p>
<p><img src="images/chapter_1_vandy_2/12.png" alt="test" /></p>
<p>There's an extra <em>suffix</em> to some uitr loc keys, which can refer to <em>subcultures</em>. In this above example, the treasury header text changes for Beastmen/Chaos/Vampire Counts, and it's read automatically. All you have to do is add a new row in the db file and the .loc file!</p>
<p><img src="images/chapter_1_vandy_2/13.png" alt="test" /></p>
<a class="header" href="#addendum-warhammer-ii-assembly-kit-localisation" id="addendum-warhammer-ii-assembly-kit-localisation"><h4>Addendum: Warhammer II Assembly Kit Localisation</h4></a>
<p>First things first, get <a href="files/TExc_LocalisableFields.xml">this file</a>. Take it, and move it to: <code>steam/steamapps/common/Total War WARHAMMER II/assembly_kit/raw_data/db</code>, overwrite the existing file.</p>
<p>That will <em>enable</em> localisation. There's a small and slightly annoying thing that must be done to get around it. When you edit a localisable field, you'll get a small little exclamation to the left of the text like this:</p>
<p><img src="images/chapter_1_vandy_2/01.png" alt="test" /></p>
<p>If that exclamation is there, any changes won't be exported. To filter out all unchanged text, press the checkbox marked <code>Only Display Records Without Text State</code> in the top right.</p>
<p><img src="images/chapter_1_vandy_2/02.png" alt="test" /></p>
<p>Now that we have only our edited cells, highlight all of them - ONLY the localisation spots - and press the <code>For Editing/Approval</code> button on the top right, which is right next to the checkbox we just used.</p>
<p><img src="images/chapter_1_vandy_2/03.png" alt="test" /></p>
<p>After doing so, they should vanish from the filter for <code>Only Display Records Without Text State</code>, and will export properly! And that's all!</p>
<a class="header" href="#summary" id="summary"><h4>Summary</h4></a>
<p>Get out there and get localising. I don't have much more to say here.</p>
<a class="header" href="#creating-custom-units" id="creating-custom-units"><h1>Creating Custom Units</h1></a>
<a class="header" href="#by-cryswar" id="by-cryswar"><h2>By Cryswar</h2></a>
<a class="header" href="#preface--tools" id="preface--tools"><h4>Preface &amp; Tools</h4></a>
<p><strong><strong>Preface</strong></strong></p>
<p>The basics of creating new units are fairly easy and fast, but alien for someone just starting modding. While there are already a few unit creation guides out there (including <a href="http://www.twcenter.net/forums/showthread.php?749888-Sebidee-s-Complete-Guide-to-Warhammer-Unit-Modding">Sebidee's</a>), there are often issues with them being out of date or (imo) laid out confusingly, and I have a few other guides I'd like to do that build off of this, custom lords and skills and such, so I figured I'd start out the series with a simple unit creation guide.</p>
<p><strong><strong>Tools</strong></strong></p>
<p>You will only really NEED one tool - <a href="https://github.com/Frodo45127/rpfm/releases">Rusted Pack File Manager</a>, hereafter referred to as RPFM. It's basically a better and actively updated version of the classic Pack File Manager (PFM) with a lot of useful tools like dependency checkers and MyMod functionality that I mostly won't go heavily into here.</p>
<p>The one thing I will stress is to get the <strong>Dependency Checker</strong> going ASAP; <code>ctrl+P</code> to open Preferences, check &quot;Enable dependency checker for DB tables&quot;, and (if you didn't do this on initial startup) make sure that your Total War Warhammer game is correctly linked in Packfile-&gt;Preferences as well as that going to Game Selected and ensuring it's set to Warhammer 2. Dependency manager will catch most simple errors for you.</p>
<p>I also suggest having two instances of RPFM open at once when modding, one opening the Data file to compare with vanilla tables and one for your mod. I usually keep a notepad file open as well with just the unit key so I can copy-paste it easily.</p>
<p>As one final note - you don't HAVE to follow the exact order I did this guide in. Many things can be done in any order, though you will often run into red dependencies temporarily if you do stuff in a weird order. I tried to lay everything out in the way I found most natural and easy to do, but if you find you REALLY like doing main_units before land_units... suit yaself.</p>
<a class="header" href="#cheat-sheet" id="cheat-sheet"><h4>Cheat Sheet</h4></a>
<p>While I will go down the list and explain what to do with each, I'm going to share my shortform list of tables for unit creation; once you get comfortable with unit modding you'll generally only need this rather than the full guide.</p>
<p><strong>Basic Tables</strong></p>
<ul>
<li>land units</li>
<li>main units</li>
<li>ui_unit_bullet_point_overrides</li>
<li>unit_description_short_texts</li>
<li>unit_set_to_unit_junctions</li>
<li>units_to_groupings_military_permissions</li>
</ul>
<p><strong>Visual Stuff</strong></p>
<ul>
<li>variants</li>
<li>unit_variants</li>
<li>variantmeshdefinitions</li>
<li>unit icon</li>
</ul>
<p><strong>Utility Tables</strong></p>
<ul>
<li>units_custom_battle_permissions</li>
<li>cdir_military_generator_unit_qualities</li>
<li>culture_to_battle_animation</li>
<li>building_units_allowed</li>
</ul>
<p><strong>Localisation</strong></p>
<ul>
<li>land_units.loc</li>
<li>unit_description_short_texts.loc</li>
</ul>
<a class="header" href="#initial-setup-and-naming-conventions" id="initial-setup-and-naming-conventions"><h4>Initial Setup and Naming Conventions</h4></a>
<p>First things first, we're going to create a new packfile (Ctrl-N). This gives us a blank pack with no tables or name. If this is your first mod, I would suggest saving it now, NOT in the data folder, with a simple name. There are a lot of different naming conventions out there; some people like prefacing their stuff with their username, some just name everything after the mod's name, whatever. Ideally you do want it to be unique so it doesn't run into incompatibility issues (don't name it mod.pack lmao).</p>
<p>Note that you can muck with mod order by adding characters to the start, it's common to see packs with ! or !!!!! at the start to ensure they load first. I would not recommend doing this unless you know exactly what you're doing, it's more of a tool for startpos mods and other major overhauls that really want to be loaded first; for most purposes something basic will do just fine.</p>
<p>While you may not find this works for you, I personally use the same key as much as possible throughout unit creation - if I name a land unit crys_skinwolves, you had damn well better believe the unit variant will be named crys_skinwolves, the main unit will be called that, etc etc. I just find it helps keep things simple, especially when you get into creating agents (lords/heroes) and start needing to attach campaign art and skill sets and all that jazz, and it's just REALLY nice to just have to copy-paste &quot;chs_styrbjorn&quot; instead of remembering 20 different things.</p>
<a class="header" href="#adding-tables" id="adding-tables"><h4>Adding Tables</h4></a>
<p>There are two ways to go about adding tables to your mod, both perfectly valid.</p>
<ul>
<li>Right clicking on the packfile-&gt;add-&gt;add from packfile-&gt;navigate to Steam\steamapps\common\Total War WARHAMMER II\data-&gt;open data.pack-&gt;open the DB folder-&gt;doubleclick on the tables you want to add, then delete all entries in the table and rename it</li>
<li>Right clicking on the packfile-&gt;create-&gt;create DB and fill it out</li>
</ul>
<p>For simple DB editing purposes, the latter is infinitely faster, easier, and simpler, with the added benefit of letting you name the table and not having to clean it out. However, it is good to know the former because for some purposes, like variants, you will need to do it that way.</p>
<p>If you do add a db table the first way for whatever reason, an easy way to clean it out is to use Special Stuff-&gt;Warhammer 2-&gt;Optimize Packfile.</p>
<hr />
<p><strong>land_units</strong></p>
<p>For now, let's just create a new table. The bottom box lets you filter results; type in &quot;land_units&quot;, then open the dropdown list - there's only 4 tables there; &quot;land_units&quot; is the one you care about. Add it and name it whatever you like, the game doesn't care as long as it doesn't clash with vanilla table names or other mod tables. Now rightclick and select &quot;add row&quot;, and... oh jesus lord what the hell are all these things?!</p>
<p>Fret not, you don't actually have to know all of them! This is where having a second window of RPFM open in the data version of the table is useful. Just copy the row from the closest vanilla unit to get us started. At the bottom right is a dropdown menu to change what to filter by; change to &quot;key&quot; and then type in the unit name you want to copy from, which may take a few tries depending on CA's weird naming conventions. In general, only type in 1 word, like &quot;champions&quot; instead of messing around trying to figure out how CA decided to name Marauder Champions with Great Weapons (wh_dlc08_nor_inf_marauder_champions_1 as it happens).</p>
<p>Some important notes:</p>
<ul>
<li>Key is incredibly important - it should be unique and not shared with any mod or vanilla unit. I recommend NOT using CA conventions, keep it simple; if you're making Chaos Fimir then chs_fimir is a decent start, though for compatibility you may want to add more text, say crys_chs_fimir. Whatever you use, save it now and keep it handy somewhere else, you'll be copy-pasting that key a lot in this guide.</li>
<li>When in doubt, just use the entry from the closest vanilla unit. Good rule of thumb. You don't have to know what the heck dr2_hydra is, but if the vanilla war hydra uses it as an animation, your budget hydra probably should too.</li>
<li>&quot;Man Entity&quot; references the battle_entities table, which controls unit speed, mass, resistance to knockback, etc. Many vanilla entities are shared between many units; if you want to mess around I'd suggest making custom entities.</li>
<li>Primary Melee/Missile weapons are fairly self explanatory in what they do; making new melee weapons is almost trivially easy, new missile weapons take some extra tables for projectile stuff but isn't that hard either.</li>
<li>New attribute Groups have to be defined in unit_attribute_groups and attached to actual attributes in unit_attributes_to_groups.</li>
<li>Note that you have to either reference vanilla armor/shield values or define new ones in their respective tables - you can't just fill in wh2_main_leather_88 and expect it to work.
Damage mod [whatever] is the unit's resistance to that type of damage. Flame can be negative, the rest can't as far as I can tell.</li>
</ul>
<hr />
<p><strong>main_units</strong></p>
<p>Similar to how you added the land_units table, do the same for main_units and copy the closest vanilla unit over.</p>
<p>As a general rule of thumb, the Main Units table is more focused on out of battle stuff - unit costs, caps in campaign or multiplayer, additional building requirements, etc.</p>
<ul>
<li>Change the &quot;unit&quot; field to your personal key, ideally the same one you used for your land unit.</li>
<li>Additional Building Requirement is used if you want the player to have a secondary building to make the unit, and is left blank otherwise. References the building_levels table if needed.</li>
<li>Campaign Cap is -1 for most units, but can be limited as desired if you only want a faction to be able to make, say, 6 Steam Tanks total</li>
<li>Land Unit is a direct reference to the land_units table entry you just filled out, make sure you have your unit's key there.</li>
<li>Unique Index should be, well, unique. Not much else to say there. Just pick a number that isn't in vanilla.</li>
<li>Ui Unit Group Land/Naval can be customized if you make a new one in UI Unit Groupings, but using vanilla ones is much easier starting off.</li>
</ul>
<hr />
<p><strong>ui_unit_bullet_point_overrides</strong></p>
<p>Despite having an utterly terrifying name, this is just the table that assigns those little green/red text lines on the unit card. Note that these DO NOT HAVE ANY MECHANICAL EFFECT, they're solely visual, but you still want to make them as accurate as possible since they're the #1 way you can communicate to users what your unit actually does. You can make custom ones as well but again, that gets into loc editing and if this is your first unit it's probably easiest just to copy and paste from the closest vanilla unit.</p>
<hr />
<p><strong>unit_description_short_texts</strong></p>
<p>Super simple table, just put your unit's key (chs_fimir or whatever) here. This is the stuff that occasionally pops up in events when you recruit a unit, just flavor text.</p>
<hr />
<p><strong>unit_set_to_unit_junctions</strong></p>
<p>Ah, unit sets, love of my life. Much maligned and little understood, unit sets are a huge part of how your unit interacts with campaign mechanics; they define what technology, lord skills, faction effects, etc. work on them. If you're just making, say, tier 4 Empire Halberdiers you can just copy the same unit set junctions from the empire version; new units may take a little more work and especially if you have custom skills targeting specifically them you may need to define some additional unit sets (explained below) as well. Kinda as usual, Unit Record references the main_units key. As usual, this is ezpz if you just use the same key for everything LOL.</p>
<p>Unit Set can be a bit confusing at times, but as a loose rule of thumb, there are some main types of groups to look out for;</p>
<ul>
<li>Oftentimes there's a faction_all set, ex. chs_all, that is used for some factionwide effects</li>
<li>Some techs and skills may involve unique sets, like empire_infantry or chs_manticores. Try to match up against vanilla units as relevant.</li>
<li>The format varies by faction, but most units will be in a set of 2-4 units with a name vaguely similar to wh2_dlc11_emp_spearmen_swordsmen_flagellants_halberdiers or something along those lines. That's for the basic red line skill that buffs those unit types. If you put your new unit in that set, they will benefit from those redline buffs.</li>
<li>Similarly, there's usually a set with &quot;vet&quot; somewhere in the name, ex. wh2_dlc11_chs_vets_chariots_chaos_knights_dragon_ogres_warhounds_manticore. That is for the rank 7+ locked skills.</li>
</ul>
<p>You can generally ignore caste, category, and class, and unless you WANT to exclude a unit from a set, leave &quot;exclude&quot; unchecked too.</p>
<p>As a general rule of thumb, most vanilla units are in 4-6 unit sets.</p>
<p>Note that if you make a custom unit set (using the <strong>unit_sets</strong> table), you can replicate the vanilla rank 7+ groups by checking &quot;use unit EXP level range&quot; and defining the inclusive range, say from 7-9 or 4-9 or whatever. Otherwise leave that unchecked.</p>
<hr />
<p><strong>units_to_groupings_military_permissions</strong></p>
<p>This table is quite simple and basically just tells the game &quot;yes, this is a Chaos unit and should be accessible to factions using the Chaos military group&quot;. You'll need other tables to actually recruit the unit in campaign for example, this is just a prerequisite.</p>
<p>--
<strong>variants</strong></p>
<p>This table is pretty simple; aside from starting to attach variants together (more on that soon) it also lets you scale your units up or down as desired. &quot;Scale&quot; lets you change the side of non-mounted entities as desired, while &quot;Scale Variation&quot; is how much randomization there is within a unit, often 0.05 in vanilla so not everyone is exactly the same height.</p>
<p>Note that the actual physical height of the unit, for purposes of being hit by artillery etc, is defined in battle_entities, NOT here, this is just visual.</p>
<p>Tech folder can be left blank in almost all situations - it's only needed if you're making a custom mount which is A. complex as hell and B. WAY out of the scope of this guide.</p>
<hr />
<p><strong>unit_variants</strong></p>
<p>This table just links units to variants, cards, etc. I just use the same key for every column to keep things simple.</p>
<hr />
<p><strong>variantmeshdefinitions</strong></p>
<p>This is where things get tricky. So the basic idea is that you are going to import a variantmeshdefinition from one of the &quot;variants&quot; files in the actual data folder, then rename it for your unit and customize what's in it. The complexity of this depends a lot on the unit and how many moving parts there are, but as some general commentary;</p>
<ul>
<li>Any given variantmeshdefinition is divided into multiple slots, usually stuff like &quot;body&quot; and &quot;head&quot; and &quot;weapon 1&quot;.</li>
<li>If a given slot has multiple variant meshes inside it, the game will randomly pick one for each model of the unit. Five entries - five possible visuals for that slot. On lower graphics settings the game only cares about the first three, so keep that in mind.</li>
<li>Weapons have a very specific set of hooks that must be done correctly. As a simple version;</li>
<li>Dual wielders define their weapons in slots 2 and 5 individually</li>
<li>Two-handed weapons go in slot 1</li>
<li>Shields go in the shield slot, huge surprise</li>
<li>Units with multiple weapon types (ex. Marauder Hunters, Darkshards, etc) vary WILDLY in where each weapon is and should generally be referenced from vanilla</li>
</ul>
<p>Beyond that, different models have very different setups - for example a vanilla variantmeshdefinition may or may not have a randomized head slot or just the one. You can mess around and do some seriously cool stuff but be aware that a lot of stuff is built specifically for one model or animation and can be hard to muck with.</p>
<p>As usual, just copy-pasting from a vanilla unit's definition is a safe start.</p>
<p>I already mentioned this above, but to repeat, make sure to rename the file to fit whatever you set up in the variants db table so the game knows to link this definition to your unit.</p>
<hr />
<p><strong>Unit Icon</strong></p>
<p>Unit icons are the visuals on the bottom bar of campaign map or in battle. You can find vanilla ones in data/ui/units/icons.</p>
<p>Depending on what your unit is, you can just steal an existing vanilla one wholesale (ex. if you're giving Fimir to the Warriors of Chaos), or edit it to look a bit different, or use an entirely new image. The only real rules here are that it should be 60x130 and NOT use any copyrighted material from other people that isn't warhammer related.</p>
<p>Some people are wizards with art and can customize an existing icon in photoshop/gimp to look amazing, others of us are dain bramaged and stuck taking ingame screenshots of the unit then doing some basic editing to focus on the unit and get them down to 60x130, then using &quot;add-&gt;add file&quot; to get that icon into the correct folder layout.</p>
<p>While creating custom lords is out of the scope of this guide and will be focused on later in the series, I will note that they actually store their icon in a different place, specifically ui/portraits/units.</p>
<p><strong><em>NOTE FROM VANDY:</em></strong> <em>You can also check out <a href="(./chapter_1_3.html">Cataph's guide on unit cards</a>.</em></p>
<hr />
<p><strong>units_custom_battle_permissions</strong></p>
<p>This is a completely optional table but one that is very useful for testing units quickly. Overall very self explanatory, just define the faction(s) that can get this unit and link the unit key.</p>
<hr />
<p><strong>cdir_military_generator_unit_qualities</strong></p>
<p>Another optional table, this one loosely defines how the AI views the unit's quality, which decides how likely it is to actually recruit it.</p>
<p>As a general rule of thumb, the lower the number the more likely the AI is to pick it. Don't stress it too much, just rip off the closest unit from vanilla and call it a day.</p>
<hr />
<p><strong>culture_to_battle_animation</strong></p>
<p>This table is only necessary if you're using a cross culture animation - for example, a Wood Elf animation for a Norscan unit. Some factions share cultures with similar ones (ex. Norsca and Chaos don't need to worry about this, the Norscan Berserker animation will work fine on a custom Chosen unit) but if you're trying to give Bretonnians a War Hydra unit, you will need to use this.</p>
<p>The &quot;Man Animation&quot; column in land_units is the animation you'll want to put here.</p>
<hr />
<p><strong>building_units_allowed</strong></p>
<p>This table allows your unit to be recruited in campaign, using the cost and recruit time values designated in main_units. Pretty self explanatory overall, just note that you need a unique string of numbers for the Key and that EACH level of a building needs a separate entry. For example, if you want to add your new custom Empire Swordsmen to all levels of the Chaos Warrior building (why????), you have the unit key, ex. &quot;emp_my_awesome_swordsmen&quot;, and have three entries for &quot;wh_main_horde_chaos_warriors_1&quot; &quot;wh_main_horde_chaos_warriors_2&quot; &quot;wh_main_horde_chaos_warriors_3&quot; that each attach to your swordsmen.</p>
<p>If you don't do this and only define it at say, &quot;wh_main_horde_chaos_warriors_1&quot;, then while the chaos warrior building is at rank 1 you'll be able to recruit your new unit there, but as soon as it upgrades to 2 or 3 you'll permanently lose access to recruiting your unit.</p>
<hr />
<p><strong>land_units_to_unit_abilities</strong></p>
<p>Thankfully this is another simple and easy table - you just link your <strong>land unit</strong> (you DO remember your key, right?) to a unit ability - you can either compare across in the vanilla version of this table for a common one (ex. Frenzy) or check <strong>unit_abilities</strong> if you want to add another ability.</p>
<a class="header" href="#loc-files" id="loc-files"><h4>.loc Files</h4></a>
<p>You could load up your mod now and see the unit ingame, assuming you didn't muck anything up, but you'll quickly notice there's a problem - the unit's name, description, and (if you made any) ui unit groupings etc. are all blank! That's because you need localization files, which can be found in the &quot;local_en&quot; file in the data folder. You add them the same way you do a normal table, importing from that file and purging the unclean entries, and same as with DB you'll want a second instance of RPFM open to compare.</p>
<hr />
<p><strong>land_units.loc</strong></p>
<p>This may look ugly at first, but is very easy to setup thankfully!</p>
<p>So the first important thing to know is that your Key will ALWAYS start the same way: &quot;land_units_onscreen_name_&quot;. Then you append your unit's key. So if your unit is &quot;crys_naked_skinwolves&quot;, you end up with a key that looks like &quot;land_units_onscreen_name_crys_naked_skinwolves&quot;. Kinda long and intimidating but whatever.</p>
<p>For the Text column, just put in the name you want to show up. &quot;Unarmored Skinwolves&quot; or whatever.</p>
<hr />
<p><strong>unit_description_short_texts.loc</strong></p>
<p>You remember about 80,000 years ago when we added that one super small table about unit descriptions? This is where you write the actual description.</p>
<p>Same as with the last .loc, you preface your unit key with &quot;unit_description_short_texts_text_&quot;</p>
<p>I don't think there's TECHNICALLY any length cap, I've seen some seriously gnarly long descriptions, but for practical reasons I'd suggest keeping it concise.</p>
<hr />
<p><strong>Other Loc Files</strong></p>
<p>Unless you went crazy with customizing stuff you won't need any extra loc files for a generic unit, but if you're like me and can't stop with the verbal diarrhea, you may need to add more, like &quot;ui_unit_groupings.loc&quot; if you made a new UI group for your unit to add extra flavor text to them.</p>
<a class="header" href="#troubleshooting-1" id="troubleshooting-1"><h4>Troubleshooting</h4></a>
<p>First thing you always do: after making sure that your preferences are set up correctly, <strong>look for red boxes</strong>! It's almost always the reason the game crashes or the unit doesn't work right, and even as an experienced modder you can still make dumbass mistakes and leave the &quot;shield&quot; column blank instead of &quot;none&quot;. Speaking from experience on that one.</p>
<p>.loc files will almost never cause a crash (apparently there are a few edge cases with some tables) but in general, mucking up loc files will only lead to invisible text rather than crashes.</p>
<p>Variants USUALLY only make your unit invisible instead of crashing but it depends on what you mucked up there - be sure that you named the variantmeshdefinition correctly for example.</p>
<a class="header" href="#balancing" id="balancing"><h4>Balancing</h4></a>
<p>This is on many levels a deeply subjective and heavily mod reliant subject so I won't tell you what you have to do here, but as a few loose rules of thumb;</p>
<ul>
<li>I highly recommend using vanilla reference points for most numbers - if your unit is just a set of Fimir with, idk, shields, then price them around other Fimir, maybe a bit higher if they have all better stats, or similar if they have tradeoffs.</li>
<li>Similar to the above - tradeoffs are fun! If your unit has incredibly powerful offense, making them squishy or short ranged can make up for it. If you're making 80 speed Irondrakes riding boars, strip off most of their armor. Maybe your new custom Hellcannon hits harder but fires slower.</li>
<li>AP damage is a weird subject that not even CA seems to know exactly what to do with, given that they've been slowly buffing a number of duelist characters to have a much more AP heavy profile. As a general rule of thumb, if the unit doesn't have a good reason to be AP heavy, don't make them too AP heavy by default; almost all weapons have a healthy balance of AP or not, 99 ap damage and 1 normal can be a fun gimmick but if all your units look like that and have no downsides, they're probably OP.</li>
<li>Balance is friggin' hard, and you shouldn't feel bad if you aren't sure about it initially! I'm by no means an expert myself, just try testing stuff and see how it feels in practice. Some ideas work out great, others don't.</li>
</ul>
<a class="header" href="#closing-note" id="closing-note"><h4>Closing Note</h4></a>
<p>This is my first TWW2 guide and I am under no illusions about myself being a flawless master of my craft - I am sure there are parts of this guide that will be confusing for newcomers where I accidentally used unnecessary lingo or forgot to explain what the heck to do. Please, let me know! Nicely if possible, I would greatly appreciate that part, but I am eager to improve the guide and constructive criticism is greatly appreciated.</p>
<a class="header" href="#credits-and-links" id="credits-and-links"><h4>Credits and Links</h4></a>
<p>I cannot in good faith fail to link <a href="http://www.twcenter.net/forums/showthread.php?749888-Sebidee-s-Complete-Guide-to-Warhammer-Unit-Modding">Sebidee's Complete Guide to Warhammer Unit Modding</a>, which is what got me into unit modding in the first place. It goes into a lot of detail on many things, and the dude is clearly VASTLY more skilled at the fancy pants art side of things than I am. I did not copy anything from it, but at the same time I feel that credit where credit is due.</p>
<p>I highly, highly, HIGHLY recommend the <a href="https://discord.gg/vtRPChd">C&amp;C Modding Discord</a>; there are a lot of very knowledgeable modders there who have helped me out greatly over time, and the community as a whole is pretty great. Modding tech 1-4 channels are where you ask questions, they don't always get answered, especially if it's about extra complex or poorly known stuff like startpos modding and the few people who are super knowledgeable about that aren't around, but in general it's helped me a ton.</p>
<p>I linked it above, but <a href="https://github.com/Frodo45127/rpfm/releases">Rusted Pack File Manager</a> is incredibly valuable to all modding I do and I cannot recommend it highly enough, especially over the aging PFM that older guides often recommend. Nothing against PFM, it has its uses, but in general RPFM is just better on almost every level.</p>
<a class="header" href="#creating-a-custom-legendary-lord" id="creating-a-custom-legendary-lord"><h1>Creating a Custom Legendary Lord</h1></a>
<a class="header" href="#by-cryswar-1" id="by-cryswar-1"><h2>By Cryswar</h2></a>
<a class="header" href="#setup" id="setup"><h4>Setup</h4></a>
<p>This guide assumes that you have created the actual unit for your custom lord - if you don't know how to do that, my <a href="(./chapter_1_cryswar_1.html">previous guide</a> covers the basics of unit creation. Same process, just copy from a vanilla lord as much as possible instead of a normal unit. And remember that you need their card in portraits instead of units!</p>
<p>We will be using <a href="https://github.com/Frodo45127/rpfm/releases">Rusted Pack File Manager</a> (RPFM) again for this guide. If you don't have it, get it, it's free and easy to learn.</p>
<p>One section of the guide touches on the possibility of using the Assembly Kit, specifically DAVE. I recommend against it unless absolutely necessary, but it is a decent search engine; if you mouse over Library, go to Tools, and install the TWW2 Assembly Kit, then open it, DAVE is the DB editor.</p>
<hr />
<p><strong>agent_subtypes</strong></p>
<p>All lords and heroes are 'agents' as far as the game is concerned, and we'll start here since most of the future tables will reference this one.</p>
<p>Fortunately this is fairly self explanatory and very similar to our previous work; your &quot;Key&quot; is extremely important and should be saved since you'll be referencing it a lot.</p>
<p><strong>Auto Generate</strong> should be checked ONLY if you are making a generic hero/lord, and left off if you are making a unique lord or hero.</p>
<p><strong>Is Caster</strong> is self explanatory - do they use magic?</p>
<p><strong>Associated Unit Override</strong> links to the main_unit key, not land_unit, though I would use the same key for both when possible personally.</p>
<p><strong>Audio Voiceover Actor Group</strong> is the set of lines they'll use on the campaign map, just pick the closest you can get.</p>
<p>The rest can just be copied from a similar vanilla lord without issue.</p>
<hr />
<p><strong>agent_uniforms</strong></p>
<p>This is a lot like the unit_variants table, it just links various things together. I like to use the same name for all of them but you can do whatever you want as long as you stick to your scheme and more importantly remember it.</p>
<hr />
<p><strong>campaign_character_art_sets</strong></p>
<p>This table sets up some of the basics of your agent on the map - their size, whatever faction or culture/subculture they're linked to, what type of agent they are, etc.</p>
<p>Since we're making a custom Lord, their agent type will be general; obviously for say, Exalted Heroes, you would use a different agent type.</p>
<p>DON'T toggle &quot;is custom&quot;, stuff gets weird.</p>
<p>ALWAYS toggle &quot;is male&quot; to true! I don't know why but the game gets super weird if you call them female, it can break scripts and lords very badly. Learned that one from Mixu. Even vanilla doesn't understand how this field works, most female lords, legendary or otherwise (ex. Hellebron, Supreme Sorceresses, Isabella von Carstein) are marked as male here.</p>
<p>Campaign Map Scale is self explanatory - how big your guy is on the campaign map - but be warned that you may have to fiddle with it, some base models are friggin' huge and have to be scaled down to .5 or less to function well, others are fine at 1.0. If you're making monstrous lords, like Arachnaroks or something, you will very likely have to fiddle with this a lot, human lords usually work fine at 1.0.</p>
<hr />
<p><strong>campaign_character_arts</strong></p>
<p>Almost all of this table can just be copy-pasted from a similar vanilla lord without needing much explanation or understanding.</p>
<p>Ensure that your numerical ID is unique and that the <strong>art set ID</strong> and <strong>uniform</strong> link to the correct ones for your lord - especially if you copy pasted stuff.</p>
<p>Land Animation must exist already and this can be a problem, most monsters, monstrous infantry, and basically anything that isn't a generic human or a mount don't have campaign map animations, or may only have limited ones, ex. giants have one since there's a giant boss, but it has no walking animation, just idle. It's up to you if you're willing to let your giant lord moonwalk across the map (sorry, Prometheus) or want to limit yourself to only lords who have existing animation types.</p>
<p>Your land animation can usually be just ripped off of a vanilla lord by comparing vanilla agents in RPFM, but you can view ALL existing campaign map animations in the table <strong>campaign_anim_set_enums</strong> which I believe can only be opened in the Assembly Kit.</p>
<hr />
<p><strong>character_skill_node_sets</strong></p>
<p>A full overview of how skills work is outside the scope of this guide, but we do need to touch on this table regardless. This table is how we attach a set of skill nodes to an agent type; thankfully it's pretty simple and if you've gotten this far it shouldn't be too hard to figure out that your agent subtype goes in the agent subtype field etc.</p>
<p>Leave the campaign/faction/subculture/army/navy fields empty, they're not used.</p>
<p>This will leave you with a blank skill tree - I go into MUCH more detail on how to create and customize skills in <a href="(./chapter_1_cryswar_3.html">this guide</a> but if you want to get a ghetto skeleton up, copying a similar lord, I would go to <strong>character_skill_nodes</strong> in the vanilla data file, search character_skill_node_set_key for a similar lord; ex. if you're making a new Chaos custom Legendary Lord, search for &quot;chs&quot; to see all Chaos lords, find <strong>wh_main_skill_node_set_chs_lord</strong> which is the generic Chaos Lord, then change the search parameters to that. That will only show you his nodes (and unfortunately the Lord of Change too...) but still, that tells you all the basic nodes you need.</p>
<p>How you go from there is up to you, but what I personally do is copy ALL of that lord's generic rows over to <a href="https://notepad-plus-plus.org/">Notepad++</a>, then go to Search -&gt; Replace..., and find &quot;wh_main_skill_node_chs_lord&quot; and replace it with say &quot;my_lord&quot;. That turns <strong>wh_main_skill_node_chs_lord_battle_01</strong> into <strong>my_lord_battle_01</strong> which is a lot easier to keep track of lol, at least for me. <strong>chs_gaius_battle_01</strong> is even easier to remember... assuming your lord is a Chaos lord named Gaius anyways.</p>
<p>After you're done, just copy that entire set of rows back into RPFM, specifically your mod's character_skill_nodes table, and make sure that the <strong>character_skill_node_set_key</strong> matches whatever you put in <strong>character_skill_node_sets</strong>. Again, I like to keep it simple; agent subtype chs_gaius, node set named chs_gaius, node set key chs_gaius.</p>
<hr />
<p><strong>faction_agent_permitted_subtypes</strong></p>
<p>Another easy table, this one just tells the game that it's cool for a faction to have your lord.</p>
<hr />
<p><strong>Portraits Part 1 - Portholes</strong></p>
<p>Portholes are the round character avatars you see at the bottom left when you select them, in diplomacy, etc. Note that they don't actually have to be round images, the game just clips a round section of it so they can be square or whatever.</p>
<p>Portholes are placed in ui/portraits/portholes, but actually getting them ingame is a bit trickier; as far as I know it's not possible with pure vanilla tools - so I will refer you to the best guide I've found to do it! This guy <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1194811468">wrote up a great guide AND most importantly provides a super handy tool to do it with</a>, and I'd rather give him the attention than waste your time pretending I have a solution haha.</p>
<hr />
<p><strong>Portraits Part 2 - Unit Cards</strong></p>
<p>I mentioned in the unit creation guide that if you were making a lord, you put the unit card in <strong>ui/portraits/units</strong> instead of ui/units/icons. This section is just there to remind you of that.</p>
<p>I personally find that taking a screenshot of the lord and then mucking around a bit in GIMP gives the best, most fitting cards since that's what the game does for the most part with vanilla lords - but you can use any image of appropriate size.</p>
<hr />
<p><strong>names</strong></p>
<p>The naming system is a bit whack, but I'll try to explain it simply.</p>
<p>First you define a surname or forename here (the numerical <strong>ID</strong>, must be unique).</p>
<p>Next you assign it to a <strong>names_group</strong> which tells the game &quot;oh this is a Chaos-ey name&quot;</p>
<p>Finally you tell the game what <strong>type</strong> of name it is - Forename is 0, Family Name is 1.</p>
<p>Gender doesn't actually matter I think, I usually just leave it 0, but can be male (0), female (1), or no gender (3).</p>
<p>Similarly, Frequency is left at 0 for any legendary lord/hero/etc and 1 if you want it to be added to the autogen pool.</p>
<p>Keep in mind that if you have a multi part name, like Sarthorael the Everwatcher or Sigvald the Disappointment, you will need to define two name IDs here - one for the first part (Sarthorael) and the other for the second (The Everwatcher). And don't screw up their Type!</p>
<p>We'll actually define the name later via localization.</p>
<hr />
<p><strong>agent_subtypes.loc</strong></p>
<p>This localization file is most commonly used for the &quot;Legendary Lord&quot; subtitle in vanilla, using <strong>agent_subtypes_onscreen_name_override_</strong> followed by the agent_subtype key on the left, and just &quot;Legendary Lord&quot; in the <strong>text</strong> field</p>
<p>You can also override description with <strong>agent_subtypes_description_text_override_</strong> followed by the key, which seems to be used for generic heroes and such.</p>
<hr />
<p><strong>names.loc</strong></p>
<p>Remember when we defined some arbitrary unique IDs in the &quot;names&quot; DB table earlier? Now we can FINALLY attach them to an actual damn name - use <code>names_name_</code> followed by that number for the key, ex. <strong>names_name_1234567</strong>, and whatever name you like in the Text field.</p>
<a class="header" href="#actually-spawning-your-lord" id="actually-spawning-your-lord"><h4>Actually Spawning Your Lord</h4></a>
<p>There are a few ways to go about this depending on what kind of lord you went with.</p>
<ul>
<li>Generic lords will spawn ingame without any further effort if you set them to &quot;auto generate&quot; in agent_subtypes.</li>
<li>Legendary lords can be added via script fairly simply, more on that soon.</li>
<li>You CAN startpos the lord in DAVE, but unless you're making a new faction and want a custom lord this destroys compatibility for no good reason.</li>
</ul>
<hr />
<p><strong>Spawning Part 1 - Scropting</strong></p>
<p>No that's not a typo in the title, Vandy calls it scropting and I find it hilarious.</p>
<p>Anyways, there are many ways to actually script a lord spawn but for the sake of simplicity (and multiplayer compatibility) I'll just go with the simplest option possible here: <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1312347007">linking to an amazing basic scripting guide</a>!</p>
<p>That explains the basic folder organization and Notepad++ usage better than I could and I'd rather not plagiarize their work, so let's move on to what we actually want to do - making the script add our lord.</p>
<pre><code class="language-lua">    function modname_script()
        if cm:is_new_game() then
            cm:spawn_character_to_pool(&quot;faction_key&quot;, &quot;names_name_XXXXXXXX&quot;, &quot;names_name_YYYYYYYY&quot;, &quot;&quot;, &quot;&quot;, 18, true, &quot;general&quot;, &quot;agent_subtype&quot;, true, &quot;&quot;)
        end;
    end
</code></pre>
<p>What does this do? It adds the lord to your factions lord recruit pool at the start of a new campaign. Actually spawning characters can be a little funky in MP and I don't want to get into some of the complexities of finding a valid spawn location, I'd rather keep it VERY simple here and I don't know lua well enough to teach y'all every possible way to do it. So let's look over how to fill the skeleton above out.</p>
<ul>
<li><code>modname_script()</code> - make sure this is the exact same as what you named the file! In other words, if you named the file &quot;storm_script.lua&quot;, this should be &quot;storm_script()&quot;.</li>
<li><code>faction_key</code> is the, uh, faction key, stolen from the <strong>factions</strong> table. For example, if you're adding this lord to Clan Rictus (Tretch's faction), fill in <strong>wh2_dlc09_skv_clan_rictus</strong></li>
<li><code>names_name_XXXXXXXX</code> is whatever the character's forename is, based on what you defined in the names table earlier.</li>
<li><code>names_name_YYYYYYYY</code> is the character's surname. If you don't need a surname, leave this completely blank, so it looks like &quot;&quot;,</li>
<li>The first &quot;true&quot; is for gender; as discussed earlier, the game gets super derp about women for some reason so just leave this true (male).</li>
<li><code>General</code> can be changed to say, champion if you're spawning a Champion or Runesmith or something, but since this guide is for lords, we're just gonna assume you leave it as <strong>general</strong>.</li>
<li><code>Agent_subtype</code> should be easy to fill in, we've been copy-pasting the damn key all throughout this guide!</li>
<li>The next &quot;true&quot; is a boolean as to whether or not the character is immortal. Unless you specifically want your legendary lord to perma-splat when they die, leave this true like with normal vanilla Legendary Lords.</li>
</ul>
<p>I'll post a few versions of what the final result might look like, using examples from my mod.</p>
<pre><code class="language-lua">    function storm_script()
        if cm:is_new_game() then
            cm:spawn_character_to_pool(&quot;talons_of_tzeentch&quot;, &quot;names_name_19880600&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, 18, true, &quot;general&quot;, &quot;chs_prometheus&quot;, true, &quot;&quot;);
        end;
    end
</code></pre>
<pre><code class="language-lua">        function storm_script()
        if cm:is_new_game() then
            cm:spawn_character_to_pool(&quot;blades_of_khorne&quot;, &quot;names_name_515043905&quot;, &quot;names_name_769371438&quot;, &quot;&quot;, &quot;&quot;, 18, true, &quot;general&quot;, &quot;chs_styrbjorn&quot;, true, &quot;&quot;);
        end;
    end
</code></pre>
<p>Note that if you're adding multiple lords, you can just have multiple of those cm lines, the game doesn't mind, ex.</p>
<pre><code class="language-lua">    function storm_script()
        if cm:is_new_game() then
            cm:spawn_character_to_pool(&quot;blades_of_khorne&quot;, &quot;names_name_19880603&quot;, &quot;names_name_19880604&quot;, &quot;&quot;, &quot;&quot;, 18, true, &quot;general&quot;, &quot;chs_atropos&quot;, true, &quot;&quot;);
            cm:spawn_character_to_pool(&quot;talons_of_tzeentch&quot;, &quot;names_name_19880601&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, 18, true, &quot;general&quot;, &quot;chs_saenathra&quot;, true, &quot;&quot;);
        end;
    end
</code></pre>
<hr />
<p><strong>Spawning Part 2 - Asspossessed</strong></p>
<p>I want to reiterate what I mentioned above - DO NOT DO THIS unless you have to, specifically, if you are making a new playable faction with a custom lord. Startpos.esf mods cannot function alongside each other, only one will work - so making a startpos mod means your mod will never be compatible with say, Crynsos's Faction Unlocker, or any mod that changes how many slots major cities have, etc.</p>
<p>A full guide for making a new faction in AssKit is outside of the scope of this guide and will be explained in more detail when I post the Faction Creation guide, but as an oversimplified note; the notable parts of the lord that NEED to be done in Assembly Kit are: land_units, main_units, agent_subtypes, character_skill_node_sets, in that order. You can use dummy entries for all of them, it's possible to edit them in RPFM (as we did earlier in the guide), but the game will not let you finish a start_pos_character without the first three defined and for some dumbass reason, the skill node set HAS to be startposed for the faction leader or they can never access their skills/items ingame.</p>
<p>You'll also need to fill out a number of other tables (ex. start_pos_characters, start_pos_generals, mercenaries, etc). but again, that's outside the scope of the guide.</p>
<a class="header" href="#the-next-step" id="the-next-step"><h4>The Next Step</h4></a>
<p>Custom skills, ancillaries, effects, etc. are an extremely widespread topic overall so they are not covered in this guide, however I do have a guide for them! If you <a href="(./chapter_1_cryswar_3.html">follow this link</a> I explain them all.</p>
<a class="header" href="#credits-and-links-1" id="credits-and-links-1"><h4>Credits and Links</h4></a>
<p>I could not possibly have come as far as I have as a modder without the excellent people at the <a href="https://discord.gg/xs6DMbn">C&amp;C Modding Discord</a>. I cannot recommend it highly enough; while you won't ALWAYS get an answer, I've found it to be by far the best place to get help and interact with other modders. Plus you get to bug Vandy for scripting help!</p>
<p>thesniperdevil has a series of Steam guides about scripting, touching on various subjects such as listeners, but <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1312347007">this specific guide</a> was my intro to basic scripting and he explains script folder design better than I could so I wanted to link and credit it again here.</p>
<p>Special thanks to Vandy and Mixu in particular for the times they've helped me break through roadblocks in modding in the past! Mixu was the reason I could figure out the game's weird hatred for female lords and get Saenathra working properly as a result, Vandy is just like the #1 guy in the C&amp;C discord in terms of how crazy much he helps people all the time.</p>
<a class="header" href="#custom-skills-items-and-effects" id="custom-skills-items-and-effects"><h1>Custom Skills, Items, and Effects</h1></a>
<a class="header" href="#by-cryswar-2" id="by-cryswar-2"><h2>By Cryswar</h2></a>
<a class="header" href="#setup-1" id="setup-1"><h4>Setup</h4></a>
<p>As with basically every guide I write, we will be using <a href="https://github.com/Frodo45127/rpfm/releases">Rusted Pack File Manager</a> as much as possible. Since this guide builds off of unit creation and lord creation, I will not be explaining the usage of RPFM in detail and will assume you understand the basics of adding tables, creating packfiles, etc.</p>
<p>Note that unlike the last two guides, you DON'T need to, and shouldn't necessarily fill out every table mentioned here for everything. Skills, items, and effects all link together regularly but in general you use different skills to grant items than you do to grant effects, and ancillaries can grant effects instead of skills, so it's up to you to scope exactly which tables you need - I just tell you what they do and how.</p>
<hr />
<a class="header" href="#skills-overview" id="skills-overview"><h3>Skills Overview</h3></a>
<p>First, let's discuss the basics of how skills actually work</p>
<p>Every lord and hero has a <strong>character skill node set</strong>, which lets you connect skill nodes to the character.</p>
<p><strong>Character Skills</strong> are defined as their own 'thing', then attached to <strong>nodes</strong> which are the fancy buttons you see ingame.</p>
<p>Skills can be attached to either <strong>effects</strong> (stats, abilities, etc) or <strong>ancillaries</strong> (items, mounts, banners, etc).</p>
<p><strong>Character Skill Nodes</strong> can be organized in a variety of ways, such as which row they are in, which other nodes are required and how many of them, organized in sets, made mutually exclusive, and other things.</p>
<p>Essentially, the process of adding a custom skill to a lord involves making the skill, telling the game what the skill DOES, adding the skill to the lord's node set, and then telling the game where the skill should be in the set and what requirements or special mechanics it has, if any. It's not THAT complicated once you wrap your head around it, I promise, but can be a little obtuse starting off.</p>
<hr />
<p><strong>character_skills</strong></p>
<p>This is the first and perhaps most important table since huge chunks of it are fundamental to how it functions at all.</p>
<p><strong>Key</strong> is the same as it always is - unique and important - whatever you call it, you'll be copy pasting this a lot later so make sure to save it.</p>
<p><strong>Image Path</strong> is crucially important, this is what will show up ingame. Compare to vanilla to decide which to use, in general if the skill buffs in battle stats then the name will have &quot;battle_&quot; in it, campaign focused stuff will be &quot;campaign_&quot;, self-buffs usually have &quot;character_&quot; in the name, etc. If you're making a new lord trait, look for &quot;innate&quot; in the vanilla &quot;key&quot; section, or &quot;trait&quot; in the image path section.</p>
<p><strong>Localized Name</strong> and <strong>Description</strong> are irrelevant, you'll fill them out properly in loc later.</p>
<p><strong>Unlocked at Rank</strong> doesn't actually matter, another table actually defines the unlock level.</p>
<p><strong>Is Background Skill</strong> is incredibly important - the starting traits lords and heroes start off with are all actually just background skills. Don't turn this on for 'normal' skills though.</p>
<p>The rest of the table is irrelevant unless it's a background skill (background weighting 5 in that case). Influence cost is a high elf thing.</p>
<hr />
<p><strong>character_skill_level_details</strong></p>
<p>This table exists pretty much entirely to limit what level(s) the skill is available at. Most of the fields are rarely or never used.</p>
<p><strong>Level</strong> is the level of the skill, not character level. Usually just 1 (once you unlock a skill, all levels of it can be bought immediately) but some skills may have different character level requirements for each level of the skill; if so, you will need to define multiple rows for skill levels 1, 2, etc.</p>
<p><strong>Unlocked at Rank</strong> references the character level requirement. Notice that it starts at 0 not 1; rank 9 is actually level 10 ingame for example. Otherwise very simple.</p>
<hr />
<p><strong>character_skill_nodes</strong></p>
<p>This table is the alpha and the omega of skill trees - and needs some explanation before I start.</p>
<p>Visually speaking, the window people see ingame is defined in terms of up to 7 <strong>Indents</strong> and any number of <strong>Tiers</strong>. Indents are numbered from 0 to 6 going from top to bottom, while Tiers go from 0 to infinity from left to right.</p>
<p>Only indents 0 through 5 are actually visible in the window, 6 is an invisible indent used for background skills, dummies that grant spells, etc. The window will expand rightward to fit in extra tiers, though I'm sure there's a cap. Now, let's go through this...</p>
<p><strong>Key</strong> is actually not used as much as keys usually are; this mostly just exists for node link and organization purposes. But it's still important! Try to name them clearly, it makes node links a LOT less obnoxious to do.</p>
<p><strong>Character Skill Key</strong> is where you link the actual Character Skill. This is also where you link a lord or hero's innate 'trait' (actually a background skill as we discussed earlier).</p>
<p><strong>Character Skill Node Set Key</strong> attaches this node to the character's node set - I told you we'd need it eventually a guide ago!</p>
<p><strong>Indent</strong> was discussed in detail earlier. All skills with the same Indent will be in the same row. Remember that Indent 6 is not visible ingame!</p>
<p><strong>Tier</strong> <strong>MUST BE UNIQUE IN THAT INDENT</strong> - if two skills both have Indent 2 and Tier 2, one will not appear ingame! You can have the same Tier in different Indents, though; one skill at Indent 0 Tier 0 will coexist fine with a skill at Indent 1 Tier 0.</p>
<p><strong>Points on Creation</strong> is mostly used for lord/hero innate background skills and for dummy skills that give access to spells. 'Normal' skills start with 0 points invested.</p>
<p><strong>Required Num Parents</strong> is where you define how many points the player needs to put into skill(s) to satisfy the conditions laid out in character_skill_node_links. 0 for most skills but be careful how you fill this one out.</p>
<hr />
<p><strong>character_skill_node_links</strong></p>
<p>You know how in vanilla, you usually have to waste 1 skill point in the leadership skill to unlock the rest of the basic red line abilities, then ~6 points in them to unlock Rally, then that unlocks the rank 7 buffs? That's all done here.</p>
<p><strong>Child</strong> and <strong>Parent</strong> keys link two skills together; if you have four rows that say skills 2, 3, 4, and 5 all require rank 1, the game will realize &quot;ok, the player needs to put points in skill 1 before they can get any of the others.&quot; How MANY points you need is defined elsewhere, this just tells the game there's a link.</p>
<p><strong>Link Type</strong> is the... type... of link... yeah. There are two that you'll be using;</p>
<ul>
<li><strong>REQUIRED</strong> means that the child key requires the parent key.</li>
<li><strong>SUBSET_REQUIRED</strong> means that any parent keys in this set count for unlocking the child.</li>
</ul>
<p>To use our above example, that leadership skill (Skill 1) is a Required Parent for all 6 of the initial red line skills - you can't get any of them without knowing it. Meanwhile, those 6 skills are all SUBSET_REQUIRED Parents of the child Rally skill (Skill 8), while the leadership skill isn't - the game only cares that you know the leadership skill to unlock skills 2-7, and then it turns around and only cares that you put points into skills 2-7 to unlock skill 8, Rally.</p>
<p>If my explanation didn't help, just go look at the vanilla, it'll make sense pretty fast.</p>
<hr />
<p><strong>character_skill_level_to_effects_junctions</strong></p>
<p>This table links skills to <strong>effects</strong>. What are effects you may ask? Boy howdy are YOU going to be happy dealing with my verbal diarrhea about effects later in the guide! Seriously though, the short version is that <strong>effects</strong> tell the game WHAT to do and how; this table on the other hand tells you how much to do with the effect. I'll go through it in parts.</p>
<p><strong>Character Skill Key</strong> is - well, the key I told you to save earlier.</p>
<p><strong>Effect Key</strong> I will go into a GREAT amount of detail on later, but there are a ton of useful vanilla effects that you can filter by and use for many simple purposes. If your new skill is just supposed to add +500% hp to your lord, <strong>wh_main_effect_character_stat_mod_unit_health</strong> is a vanilla effect that will do that no questions asked. Want melee attack instead? <strong>wh_main_effect_character_stat_mod_melee_attack</strong>. Want to add melee attack to Norscan warhounds? <strong>wh_dlc08_effect_skill_melee_attack_increase_warhounds</strong>. We'll get into scope very soon, don't worry...</p>
<p><strong>Level</strong> is the skill level; you need to define each effect at each skill level you want it available at. For example, if you have a 2 level skill, and it gives melee attack to the character, you'll have two different rows, each with the same skill name and effect, but one will be level 1 and the other will be level 2.</p>
<p><strong>Effect Scope</strong> is quite frankly obnoxiously complex and you will probably mess it up at least once while modding if you try ANYTHING fancy. My #1 piece of advice is to blatantly rip off the closest vanilla thing - you don't have to UNDERSTAND what faction_to_faction_own_provincewide is, but if a vanilla skill uses it in a certain way... yea. I'll list some of the most commonly useful scopes here.</p>
<ul>
<li><strong>character_to_character_own</strong> is used for self-buffs and unlocking abilities/attributes for the lord/hero learning this skill alone.</li>
<li><strong>general_to_force_own</strong> is used for buffs that apply to the entire army or segments of the army based on the effect - if the effect is attached to a unit set, only those units will get the effect's.... effects, otherwise your entire army will.</li>
<li><strong>character_to_force_own_unseen</strong> is mostly used for Winds of Magic buffs</li>
<li><strong>general_to_force_enemy_regionwide</strong> applies to all enemies in the region, used mostly for reducing enemy WoM or morale.</li>
</ul>
<p>There are MANY others but most are used in other contexts, those are the big 4 for character skills.</p>
<p><strong>Value</strong> is very straightforward - what is the value of the effect? If you're boosting Melee Attack, 5 means +5 melee attack. If your effect is a % boost, 5 here means 5%. Mostly self explanatory, I'll go A LOT more into detail on effect shenanigans later.</p>
<p>~~</p>
<p>One final note - for most skills you will want to add an extra row using the effect <strong>wh_main_effect_agent_action_success_chance_enemy_skill</strong>. Most vanilla skills have this effect attached; it is why higher level lords/heroes are typically more resistant to enemy agent actions. There is a similar but opposite effect called <strong>wh_main_effect_agent_action_success_chance_skill</strong> which only needs to be used for agent skills that increases action success chance. Both effects use the scope <strong>character_to_character_own</strong> and typically have the same value (albeit negative) as the skill level, ex. a skill with two levels will have -1 at level 1 and -2 at level 2.</p>
<p>You do not NEED to do this for a functional skill, however I suggest getting into the habit of doing so. It's a good habit to get into and I feel it shows that you care enough about your mod to not halfass skills.</p>
<hr />
<p><strong>character_skill_level_to_ancillaries_junctions</strong></p>
<p>Thankfully we're back to another easy table. I'll touch a lot more on ancillaries later, but to briefly summarize; items, mounts, and banners are all ancillaries.</p>
<hr />
<p><strong>character_skills_to_quest_ancillaries</strong></p>
<p>Similar to last table this one is just a basic link.</p>
<p>DO NOT check the &quot;enable quest for prefix&quot; field unless you're actually doing a quest battle. Way way way way waaaaaaaaay easier to just give the item for learning the skill.</p>
<hr />
<p><strong>character_skills.loc</strong></p>
<p>Two different prefixes, name and description as usual.</p>
<p>character_skills_localised_name_
character_skills_localised_description_</p>
<hr />
<a class="header" href="#ancillaries" id="ancillaries"><h3>Ancillaries</h3></a>
<p><strong>Ancillaries</strong> are a catchall term for the various item types that you can get - mounts, items, banners, etc. We'll go over how to make a skill grant an ancillary below; for the sake of simplicity I will focus on items but the same general approach applies to all.</p>
<hr />
<p><strong>ancillaries_tables</strong></p>
<p>As usual, your key needs to be unique and copied to notepad or w/e since you'll be referencing it a lot. Most of the fields here are deprecated from older games and easily solved by copy-pasting from a vaguely similar item, but some important columns...</p>
<p><strong>Type</strong> is what kind of ancillary you're making; wh_main_anc_arcane_item, wh_main_anc_weapon, wh_main_anc_talisman, wh_main_anc_enchanted_item, wh_main_anc_armour are the item types, but they can also be various kinds of followers, mounts, etc.</p>
<p><strong>Transferrable</strong> means tradable - leave empty if it's a unique item/mount/whatever unless you WANT your lord to be able to give it away!</p>
<p><strong>Category</strong> should match with type; if it's a <strong>wh_main_anc_weapon</strong>, its category should be <strong>weapon</strong></p>
<p><strong>Uniqueness Score</strong> is 200 for legendary lord items as a general rule of thumb, and decreasing rarity from there.</p>
<hr />
<p><strong>ancillary_info</strong></p>
<p>This just links the ancillary to its description.</p>
<hr />
<p><strong>ancillary_included_subcultures</strong></p>
<p>Basically, what subculture does this ancillary go to? Check the vanilla ones to see.</p>
<hr />
<p><strong>ancillaries_included_agent_subtypes</strong></p>
<p>If you only want a specific character or character type to be able to equip this, say, ONLY King Louen can equip the new mount you're making for him, this is your table.</p>
<hr />
<p><strong>ancillary_to_effects</strong></p>
<p>This is basically the exact same deal as character_skills_to_effects, just without the levels. Scope and Value work the same way.</p>
<hr />
<p><strong>ancillaries.loc</strong></p>
<p>Ancillaries have two loc fields needed, as always they go in different rows:</p>
<ul>
<li>ancillaries_onscreen_name_ is the prefix for its name</li>
<li>ancillaries_colour_text_ is the prefix for description</li>
</ul>
<hr />
<a class="header" href="#effects" id="effects"><h3>Effects</h3></a>
<p>Effects are among the most powerful tools in TWW2 modding - think of them as messengers that tell the game this skill should boost those stats or give that item. They have so many uses that actually elucidating all of them is fairly difficult, but since they are core to most skill modding, I'll list most of the commonly used ones.</p>
<p>To oversimplify it, you create the Effect in the effects table, link it to a bonus value in any of a number of other tables, then actually apply it with one of the X_to_effects_junctions tables; ancillary, character skill, building, etc.</p>
<hr />
<p><strong>effects_tables</strong></p>
<p>This table just registers your effect to the game - it doesn't DO anything yet, but this does decide what the icon is and how high priority it is in a list of effects.</p>
<p>The <strong>Effect</strong> column is basically just Key in every other table - name it what you want, and save it in notepad or something 'cuz it's gonna come up a lot.</p>
<p><strong>Icon</strong> and <strong>Icon Negative</strong> are very simple to copy from vanilla; if you want this effect to give extra Melee Attack to Hexwraiths, filter the vanilla table Icon column by &quot;melee&quot; and oh hey, &quot;melee.png&quot;, we gucci. Generally speaking you just use the same icon for both positive and negative.</p>
<p><strong>Priority</strong> tells the game where the effect goes in a list of effects - priority 1 goes at the top, 600+ is gonna be way down at the bottom. Most vanilla effects range from 50-100 and yours probably should too, but effects that grant abilities tend to be in the 600s for whatever reason. It doesn't REALLY matter, just an aesthetic thing.</p>
<p><em>Category</em> tells the game if this effect will be used for battle related stuff (ex. boosting melee attack) or campaign stuff (ex. upkeep).</p>
<p><strong>Is Positive Value Good</strong> can usually just be left checked, HOWEVER, you want it unchecked for good but negative numbers - upkeep reduction, most spell upgrades (WoM cost, cooldown, miscast reduction, etc), that kind of thing. Otherwise your -30% upkeep effect will show up red in the UI.</p>
<hr />
<p><strong>effect_bonus_value_ids_unit_sets</strong></p>
<p>This is probably the overall most used effect table - it's used for direct stat boosts from effects. The layout is fairly simple thankfully!</p>
<p><strong>Bonus Value ID</strong> is crucial - this is how the game actually knows what the heck the effect DOES. Definitely look up values in vanilla, but most are pretty easy to figure out. <strong>mod_land_movement_battle</strong> gives movespeed in battle - big surprise there. <strong>ammo_mod</strong> increases your ammo, who would have guessed. Note that weapon damage is split into several possibilities, the main 3 are:</p>
<ul>
<li>melee_damage_ap_mod_mult</li>
<li>melee_damage_mod_mult</li>
<li>melee_damage_ap_mod_add</li>
<li>melee_damage_mod_add</li>
</ul>
<p>Mult just means it's a multiplier, so when you define the # value of the skill later, 30 actually means 30%. Add, surprise, means it's added - so a 30 there means you ADD 30 damage.</p>
<p><strong>Effect</strong> is just the effect you named in the last section.</p>
<p><strong>Unit Set</strong> is related to, surprise, unit sets! I explained them in a fair bit of detail in my unit creation guide, but to summarize, you define them in unit_sets, add units to them in unit_set_to_unit_junctions, and then this bonus value will apply to all units in that set once you turn the effect on (usually via a skill). Vanilla already has a bunch of unit sets defined; If you want your skill to buff ALL chaos units, for example, you can just use the existing chs_all.</p>
<hr />
<p><strong>effect_bonus_value_unit_ability_junctions</strong></p>
<p>This is a very simple table - you attach an effect to an ability, and tell the game how to interpret it. Does your effect enable a skill? Reduce the Winds of Magic cost of one? Make it recharge faster?</p>
<p>Making a custom ability is outside the scope of this guide but whether you have a vanilla or custom ability, the unit_abilities table is where you're drawing from here.</p>
<p>The <strong>effect_bonus_value_unit_attribute_junctions</strong> table works identically to this one if you want to add, say, Stalk to your lord instead (though there's at least one vanilla effect that already does that!)</p>
<hr />
<p><strong>effect_bonus_value_unit_set_unit_ability_junctions</strong></p>
<p>This is... similar to the last table but more complex; as you may notice on the right, you're relying on the <strong>unit_set_unit_ability_junctions</strong> table to tell the game to apply this ability to an entire set of units; the first vanilla example to come to mind is the Tomb Kings banner that gives Frenzy to all Ushabti.</p>
<p>Thankfully if you look at that table, it's actually not that complex, you just attach the unit set to the unit ability, give it a key, and use that key back in this section's titular table.</p>
<p>The Attribute version of this table works the same way and links to <strong>unit_set_unit_attribute_junctions</strong> similarly.</p>
<hr />
<p><strong>effect_bonus_value_agent_junction</strong></p>
<p>This table and <strong>effect_bonus_value_agent_subtype_junctions</strong> are used to make agents available or add to their caps. Not much to explain here honestly, it's very straightforward.</p>
<hr />
<p><strong>effect_bonus_value_military_force_ability_junctions</strong></p>
<p>You know how some factions can give themselves abilities on the sidebar on the right? Black Ark bombardments, Lizardmen spawning those clever girls or the holy stella, Skaven spawning clanrats, all that stuff? We do that here. Pretty simple for the most part.</p>
<p>Note that you'll need a secondary table - <strong>army_special_abilities</strong> - to actually attach the ability to its so called &quot;army special ability&quot;, which also lets you check the Enables Siege Assault box if you're doing something like Vaul's Hammer.</p>
<p>Note that unless your faction already has this ability in vanilla, you will most likely need to import the UI for it to look good. You can make your own if your a gfx wizard I guess, or just import it from <strong>data_2</strong>, ui&gt;skins, extract both hexagon_ability_frame and hexagon_ability_holder, then create a folder following that path + the faction key in your mod replicating how it looks in vanilla, ex. ui&gt;skins&gt;wh_main_chs_chaos if you're going to be giving army abilities to Chaos like I did.</p>
<hr />
<p><strong>effect_bonus_value_special_ability_phase_record_junctions</strong></p>
<p>I haven't explained phases here yet, that's more of a unit ability thing, but to briefly summarize them, <strong>phases</strong> are the buffs/debuffs that abilities apply for a certain length of time. Contact phases in particular are debuffs like poison, sundered armor, Discouraged, etc.</p>
<p>This table lets you give them to whatever the scope of the effect is, as far as I'm aware you can't attach it to a unit set, it's either defined as only to the character or to the entire army with no in between. We'll talk about effect scope more when we get to character_skills_to_effects later.</p>
<hr />
<p><strong>effect_bonus_value_faction_junctions</strong></p>
<p>This table lets you affect diplomacy with specific factions, with their keys taken from the factions_tables as needed.</p>
<hr />
<p><strong>effect_bonus_value_subculture_junctions</strong></p>
<p>This table lets you affect diplomacy, ex. if you have a skill that gives +10 diplomatic relations to vampire counts. Unlike the previous table, this works for entire subcultures rather than specific factions - good if you want to torpedo relations with ALL dwarfs for example.</p>
<hr />
<p><strong>effect_bonus_value_battle_context_junctions</strong></p>
<p>There's a couple of very similar tables that all work basically the same way so I'll just focus on this one - these tables are for effects that only kick in under certain contexts, like one that gives bonus attack while at sea, or physical resistance when fighting any Chaos culture, or sieging an enemy walled settlement. They generally work the same as the basic versions I detailed earlier in the guide.</p>
<p>Note that these context tables DO NOT support unit sets - you can't do &quot;regeneration to dwarf warriors while underground&quot;, only &quot;regen to all units in army while underground.&quot;</p>
<hr />
<p><strong>effects.loc</strong></p>
<p>As a pleasant surprise, you only have one prefix needed for effect localization files - effects_description_</p>
<p>On the flip side, the actual text part is a lot more complicated since any good effect will reflect the number you give it in character_skill_level_to_effects or ancillaries_to_effects. How? Well... let's go over a few common tools.</p>
<ul>
<li><strong>%+n</strong> displays the number as itself, no fancy stuff. Good if the effect is a flat boost.</li>
<li><strong>%+n%</strong> displays the number followed by a %, used if the effect is a % boost.</li>
<li><strong>{{tr:rank7}}</strong> gives you that fancy little chevron dealio that the vet rank 7 skills use</li>
</ul>
<p>Surprisingly those are the only three you'll really need for much, if an effect grants an ability or attribute you just type it out, ex. &quot;<strong>Passive ability &quot;Earthshaker Rounds&quot; for Ereshkigal-Namatar.</strong>&quot;</p>
<a class="header" href="#example---buffing-specific-units" id="example---buffing-specific-units"><h3>Example - Buffing Specific Units</h3></a>
<p>So in this series of guides I've talked a lot about all the things you can do, but now let's try a practical example - we want to give Karl Franz a custom skill that grants 10 armor and 5 Melee Defense to Halberdiers.</p>
<p>As an important caveat, you can do this is any order - I will just suggest the order that I would do it in to minimize how many red boxes you see along the way.</p>
<p><strong>Effects</strong></p>
<p>First of all, we make the effects and ensure there's a functional unit set. The effects are easy; create one for armor and one for melee defense, ripping off similar vanilla effects.</p>
<p>We then skip on over to <strong>unit_set_to_unit_junctions</strong> to look up vanilla unit sets; search Unit Record by Halber - oh hey we can already see there's an &quot;emp_halberds&quot; set, copy that and search by unit set... ah hell, that includes the halberd wielding demigryph knights. So do you want to buff them too? If so, we can just use this set. Otherwise, if you ONLY want Halberdiers to get the buff, we make a custom set in unit_sets, ex. <strong>emp_halberdiers</strong> and then go back to junctions and ONLY add the unit record <strong>wh_main_emp_inf_halberdiers</strong> to our new unit set.</p>
<p>BUT WAIT, THERE'S MORE! Now we need to attach the effects to actual stats - which, as we discussed earlier in the guide, is done in <strong>effect_bonus_value_ids_unit_sets</strong> for this particular example. As usual you'll shamelessly plagiarize similar vanilla effects to find the <strong>Bonus Value IDs</strong> you're looking for; searching effects for &quot;armour&quot; (darn Britbongs) will reveal that the necessary ID for armor is <strong>armour_mod</strong> and doing the same with melee stats reveals <strong>melee_defence_mod</strong> for MD. So we create two new rows in our mod's version of the table, and attach the effects we made two paragraphs ago to the bonus value IDs we just found, and then put the relevant unit set on the right - either emp_halberds or emp_halberdiers depending on your decision above.</p>
<p><strong>Skills</strong></p>
<p>Well, now we have the effects, but no way to apply them, and even if we did they wouldn't have any text. So let's take care of the first bit - applying them.</p>
<p>As we discussed earlier in the guide, first we make the skill in <strong>character_skills</strong>, and add an entry in <strong>character_skill_level_details</strong> for the level requirement. We then move to <strong>character_skill_level_to_effects_junctions</strong> where we add three rows, each level 1 - two for the effects we made in the last section, with scope <strong>general_to_force_own</strong>, and in the third row we use the vanilla effect <strong>wh_main_effect_agent_action_success_chance_enemy_skill</strong> (scope: character_to_character_own), set to -1, which means that learning that skill makes it slightly harder for enemy agents to cuck us - vanilla skills do this and it's a good habit to get into. Then we put the actual values of the effects on the far right (again, 10 for the armor one, 5 for the MD one).</p>
<p>If your skill is gonna have two levels, repeat these steps with three new rows each set to level 2 and higher values for the effects. Maybe you want 20 armor and 10 MD when maxed. Whatever. You do you fam.</p>
<p>Unfortunately the skill isn't actually ATTACHED to anyone, so now we have to go to <strong>character_skill_nodes</strong>. First off we need to figure out what the heck Karl Franz's character skill node set even is, so filter by that and look for some variation of his name; thankfully his, <strong>wh_main_skill_node_set_emp_karl_franz</strong> includes both halves of his name - some lords don't! Balthasar Gelt, for example, is <strong>wh_main_skill_node_set_emp_balthasar</strong> and searching by &quot;gelt&quot; will bring up nothing.</p>
<p>Now that we know what Franz's skill node set is, we can look over it and see how it's laid out. Army buffing unique skills are usually in indent 1, and we see that indent 1 tier 0-5 are all taken by vanilla skills. So you can either go for Indent 1 Tier 6, or if you're concerned another mod will overwrite it, you can go for tier 128 or some BS number. If you're making generic skills, for the love of god, use a high number for compatibility, but lord unique skills are generally fine at low numbers. Anyways. For the sake of this guide, we'll just use Indent 6.</p>
<p>So here, we're gonna use the key of the character_skills entry we made earlier for the character_skill key, whatever we want for this table's key (I'd use <strong>wh_dlc08_skill_emp_lord_unique_karl_6</strong> personally), make sure it's attached to Franz's character skill node set, and doublecheck to make sure it looks similar to his existing skills. If you want to test the skill, you can put points into it at creation so you can go ingame and check, but be sure to remove them when you release the mod.</p>
<p><strong>Locs</strong></p>
<p>Ok, the skill works now, but if you test it you'll see it doesn't have jack for text. Woops. Let's fix that. You're gonna want to create/import a couple loc files, nothing too much. Rename them when you create/import them so they don't overwrite vanilla ones.</p>
<p>character_skills.loc
effects.loc</p>
<p>character_skills is easy to fill out; just append the skill name after the last underscore for each of the two rows you need</p>
<p>character_skills_localised_name_
character_skills_localised_description_</p>
<p>So say your skill is named <code>karl_franz_halberdiers</code>, your keys will look like</p>
<p>character_skills_localised_name_karl_franz_halberdiers
character_skills_localised_description_karl_franz_halberdiers</p>
<p>Fill out the flavor text however you want, but try to spellcheck it for everyone's sake.</p>
<p>Effects are pretty easy; you only need one row for each of the two effects we made, in this format</p>
<p>effects_description_</p>
<p>So say the first effect is <code>emp_halberdier_armor</code>, we're looking at</p>
<p>effects_description_emp_halberdier_armor</p>
<p>As we discussed above, you'll be looking to fill out the text field with something like:</p>
<p><strong>Armor: %+n for Halberdiers</strong></p>
<p>You can fluff it up a bit if you want, but something along those lines. Repeat for the MD effect, and you should be good to go!</p>
<hr />
<a class="header" href="#the-next-step-1" id="the-next-step-1"><h3>The Next Step</h3></a>
<p>Yes, I'm shilling another guide, deal with it. Seriously though, abilities and phases are definitely linked heavily to effects, but are out of the scope of this already pretty huge guide so I wanted to split them up. Hence, <a href="(./chapter_1_cryswar_4.html">we have one more guide</a> covering those things! If you want to make custom(ish) spells, tinker with existing ones, or just give your dude a buff that grants him 50 million MA forever, check it out! ...Please don't do that last one tho.</p>
<a class="header" href="#creating-and-editing-abilities" id="creating-and-editing-abilities"><h1>Creating and Editing Abilities</h1></a>
<a class="header" href="#by-cryswar-3" id="by-cryswar-3"><h2>By Cryswar</h2></a>
<a class="header" href="#preface" id="preface"><h3>Preface</h3></a>
<p>As with every one of my guides, we will be using <a href="https://github.com/Frodo45127/rpfm/releases">RPFM</a> as much as possible. Since abilities are a relatively complex subject and I've explained the basics a few times already in previous guides, I will assume you already know how the basics of importing and editing tables works.</p>
<a class="header" href="#overview" id="overview"><h3>Overview</h3></a>
<p>Fist of all, let's define what an <strong>ability</strong> isn't; it is NOT a skill, character skills are a very different subject. I will not refer to abilities as skills in this guide and I recommend you learn not to do so as well.</p>
<p>So what is an ability? Spells, augments, many passives, vortexes, summons (including army abilities like Tomb King's Ushabti summon), etc. Despite some similarities and functional overlap, they are NOT predefined attributes like Stalk, Vanguard, etc.</p>
<p>As a general rule of thumb, abilities have a very similar initial setup - you setup mostly frontend stuff in unit_abilities, linking them to the unit_special_abilities entry which covers most of the simple numbers (recharge, initial cooldown, range, etc) and details of the actual ability, and link to the relevant vortex, projectile, phase, etc. as needed depending on spell type.</p>
<hr />
<p><strong>unit_abilities</strong></p>
<p>This table covers mostly frontend UI stuff for your ability, but it's important to get right, so let's go through each field!</p>
<ul>
<li><strong>Key</strong> must be unique and should be easy to remember, same as keys... usually are. As always, copy it to notepad or something for easy access.</li>
<li><strong>Supersedes Ability</strong> is very rarely used in vanilla, I think just for the Black Ark ability progression. You can ignore it for the vast majority of abilities.</li>
<li><strong>Requires Effect Enabling</strong> is used if you're going to have a skill, tech, etc. make the ability available; if you're just going to attach the ability to a unit permanently via say land_units_to_unit_abilities you can leave this blank though.</li>
<li><strong>Icon Name</strong> is simple but annoying; either include your own skill icon or reference one of the vanilla ones from ui/battle ui/ability icons in the vanilla data file. You may want to open it in a separate instance of RPFM to peruse them at your leisure.</li>
<li><strong>Overpower Option</strong> is commonly used for spells that have a more powerful version that does more damage but costs more/can miscast. This links to a separate special ability that just looks similar!</li>
<li><strong>Type</strong> is just a UI thing, basically tells the game what kind of ability this is, rip it off from a similar vanilla ability.</li>
<li><strong>Uniqueness</strong> is another UI deal that decides if the spell's background is blue, purple, whatever. It's just an aesthetic thing. As usual, rip off vanilla unless you have a specific goal.</li>
<li><strong>Source Type</strong> varies based on what you're making the spell for; an army ability has source type army while a spell has source type spell. Fairly simple, just rip off vanilla as usual LOL.</li>
</ul>
<hr />
<p><strong>unit_special_abilities</strong></p>
<p>This is a good contender for the most complex table you'll find, but if you take it bit by bit it's not that bad. That said, while I say this a lot, USE VANILLA ABILITIES FOR REFERENCE! It's almost always easier to literally just copy-paste the entire row from the closest vanilla ability and then change keys and some details rather than trying to do it all from scratch. With that said...</p>
<ul>
<li><strong>Key</strong> references the key you just made in unit_abilities.</li>
<li><strong>Active Time</strong> is how long your character directly interacts with the spell; special ability phases, vortexes, projectiles, etc. all have separate parameters. As a general rule of thumb this is the same as the duration and staves off recharge until the spell is done.</li>
<li><strong>Recharge Time</strong> does exactly what it says on the tin, in seconds. Not much else to explain here.</li>
<li><strong>Num Uses</strong> is a little weird; -1 means infinite uses (or a passive that isn't 'used' at all per se), everything else lets you use the ability that many times. So 3 means 3 uses, separated by the recharge time (or recharge+active time if relevant).</li>
<li><strong>Effect Range</strong> is self explanatory for the most part - 40 range means 40 range - but similar to the last one, -1 means mapwide. 0 means self-only.</li>
<li><strong>Num Effected Friendly/Enemy units</strong> can usually be left 0 but if you want to mess around with them they follow similar same rules as before.</li>
<li><strong>Initial Recharge</strong> starts the spell on that amount of cooldown. Most abilities start at 0, but army abilities (Black Ark calldowns, Ushabti summons, etc) bug out BADLY if you have them at 0 so you should at least have a short initial cooldown (ICD) on them.</li>
<li><strong>Activated Projectile</strong> is how you actually call the projectile for spells like Fireball and Shem's Burning Gaze, and is left completely blank if your spell doesn't create projectiles.</li>
<li><strong>Target Friends/Enemies/Ground</strong> are simple - what can you target with the spell? If the spell doesn't have a target per se and just goes off when you hit the button, you can leave these all unchecked.</li>
<li><strong>Target Intercept Range</strong> is how close to the target you have to be to successfully cast the spell.</li>
<li><strong>Assume Specific Behavior</strong> is VERY rarely used but that's how stuff like Bretonnia's Lance Formation works; this tells the unit &quot;ok go into wedge formation&quot; or whatever.</li>
<li><strong>Wind Up Time</strong> is how long it takes your caster to jerk off before actually casting the damn ability.</li>
<li><strong>Passive</strong> is... passive? idk what else to say</li>
<li><strong>Unique ID</strong> should be unique, no surprise there.</li>
<li><strong>Bombardment</strong>, similar to the Projectile field, links the spell to a bombardment type - think Piercing Bolts of Burning, Wraithstorm, Doombolt, that kind of thing. When the big boom comes from above instead of the caster.</li>
<li><strong>Spawned Unit</strong> is... self explanatory, link it to a land_unit key.</li>
<li><strong>Mana Cost</strong> is the cost of the ability in Winds of Magic, most non-spells have a 0 here.</li>
<li><strong>Min Range</strong> is how far away from the caster you have to start the spell.</li>
<li><strong>Targeting/Passive/Active AOEs</strong> are all best plagiarized from a similar vanilla spell.</li>
<li><strong>Vortex</strong> links the spell to a relevant entry in battle_vortexes - think stuff like Flame Storm, Banishment, etc. Note that most Wind type spells are actually vortexes with special parameters for movement!</li>
<li><strong>Miscast Chance</strong> doesn't need a ton of explanation if you've ever overcasted an ability. Note that most base level spells and almost all abilities have 0 miscast chance, but you can do whatever you want for flavor. 0.0 to 1.0 is 0 to 100% chance of miscasting.</li>
<li><strong>Miscast Explosion</strong> links your miscast to whatever actually happens. Usually just a vanilla explosion like wh_main_fire_miscast, but you can make your own. One unusual usage is to set miscast to 100%, then make a custom explosion that does minimal damage but imbues an effect to the character.</li>
<li><strong>AI Usage</strong> tells the AI how to use the ability.</li>
<li><strong>Additional Melee/Ranged CP</strong> tells the game that your character is that much stronger, as far as I know mostly/only used for autoresolves.</li>
<li><strong>Spawn Type</strong> either creates the spawned unit at the location you click, or at an offset from that location.</li>
</ul>
<p>Most of the rest is either self explanatory or useless 99-100% of the time so I won't go into detail on it.</p>
<hr />
<p><strong>battle_vortexs</strong></p>
<p>Weird spelling CA's, not mine.</p>
<p>Anyways, despite the name, all breath and wave spells are also vortexes. In general, vortexes just kinda... do their own thing, once you create them they follow the rules set in this table and don't really give a god damn about whatever else you set up in the ability's other tables.</p>
<ul>
<li><strong>Vortex key</strong> - ok look honestly I've explained keys so many times now that there's not much point in doing it again. Keep it unique, write it down, this is old news.</li>
<li><strong>Change Max Angle</strong> is what decides what kind of zany directional shenanigans your vortex can pull off. 0 means it never changes directions at all, 360 means it can go any direction each move tick.</li>
<li><strong>Contact Effect</strong> applies a phase of your choice to anyone hit by this vortex; commonly used for vanilla effects like poison, discouraged, etc. but you can make your own. Read the phases section for more info.</li>
<li><strong>Damage/Damage AP</strong> do exactly what you expect them to. For balance purposes, I'd suggest copying from vanilla and then making minor changes as needed.</li>
<li><strong>Duration</strong> is just how long the vortex survives. Some like Flame Storm have abnormally long durations.</li>
<li><strong>Expansion Speed</strong> isn't used much, at least not meaningfully. Set to positive for explosions and expanding breath attacks. In my experience negative values don't actually make the vortex shrink.</li>
<li><strong>Goal Radius</strong> is how much the vortex will expand to. Seems to be hardcapped by the actual animation in most cases.</li>
<li><strong>Infinite Height</strong> seems to pretty much just be a fancy way to say &quot;does this hit fliers?&quot;.</li>
<li><strong>Move Change Frequency</strong> is how often, in seconds I believe, the vortex will try to pull movement shenanigans.</li>
<li><strong>Movement Speed</strong> does exactly what it says on the tin - how fast does your vortex move? 0 is great for immobile vortexes, ex. Pit of Shades, or point blank AOEs like targeted explosions that expand outwards.</li>
<li><strong>Ignition Amount</strong> (set to 1 for ignite) and Is Magical just change the vortexes damage types.</li>
<li><strong>Composite Scene</strong> is basically a fancy way of saying &quot;what vanilla vortex are you plagiarizing today?&quot;</li>
<li><strong>Detonation Force</strong> is similar to mass in charges - more force means more throwing people around.</li>
<li><strong>Height Off Ground</strong> is only ever used in vanilla for vortexes that ONLY hit air units - Tempest and Storm of the Night. Normally you leave this at 0.</li>
<li><strong>Num Vortexes</strong> is my favorite field in this table for how stupid it is. If you set this higher than 1, the game spawns additional vortexes from the same spot as the original vortex, following all the same rules. If you have Change Max Angle set to anything other than 0 and Movement is on, they can go in random directions and do weird stuff. If two vortexes are on the same location, they both do damage to anything unfortunate enough in its path. Use this sparingly, it's crazy OP in most uses, but it's super fun to play with. Mazdamundi's Ruination of Cities uses this column.</li>
<li><strong>Affects Allies</strong> can be turned off if you don't want the vortex to do friendly fire. Most vanilla abilities have it on, but a few, like Settra's Wrath of Ptra, don't.</li>
</ul>
<hr />
<p><strong>projectiles</strong></p>
<p>Projectiles are extremely versatile, used for everything from missile weapons (archers, crossbowmen, handgunners, etc) to really big missile weapons (artillery) to many spells (Fireball, Shem's Burning Gaze, etc). Somewhat similar to vortexes, once the projectile is fired it stop really caring about your ability and just does its own thing based on this table.</p>
<p>Note that many vanilla units do not have any animation for casting projectiles and will glitch the game severely if you try to force them to - projectile spells will often cast (no animation) and instantly refund all cooldown/WoM to the user anyways. So far as I can tell there is no way around this, just use vortexes, bombardments, or augments/debuffs instead for those units.</p>
<p>Also note that if you give a projectile ability to a group of units, each of them will try to cast it whenever you use the ability. I don't think there is any way around this aside from maybe toning the spell down in damage enough that all of their combined projectiles are roughly equivalent to what you had planned originally? A 200 count unit of zombies all casting fireball might fry some computers, though, so... yea. Maybe steer clear.</p>
<p>As one final note - projectiles are complicated. Like, really complicated. I HIGHLY recommend just copying the closest vanilla row and then editing a few things as needed.</p>
<ul>
<li><strong>Category</strong> tells the game what kind of projectile this is; arrow, grenade, fireball, etc. Use the vanilla categories.</li>
<li><strong>Shot Type</strong> is similar and generally lines up with Category; a Musket category projectile is almost always gonna be a small_arm_default shot type. Ushabti ROR is one of the few exceptions,
an arrow that explodes into an artillery canister</li>
<li><strong>Explosion Type</strong> links to the projectiles_explosions table and tells the game what the explosion is like. To use the last section's example again, the Ushabti ROR projectile spawns the wh2_dlc09_tmb_ushabti_bolt_ror projectile explosion when it, uh, explodes.</li>
<li><strong>Spin Type</strong> is usually none, but projectiles with really funky looks, like Vindictive Glare, Gaze of Nagash, Shem's Burning Gaze, etc. definitely have a spin.</li>
<li><strong>Projectile Number</strong> is one way of creating multiple projectiles; again, the Gaze type spells usually spawn 5-10 individual projectiles, as do shotgun type weapons like gunnery wight blunderbusses or gunnery mob handcannons.</li>
<li><strong>Effective Range</strong> is the range stat ingame - this is the maximum range, we'll get more into detail on range later.</li>
<li><strong>Muzzle Velocity</strong> is how fast the projectile starts out moving; air resistance and enemy bodies can slow it down after firing though.</li>
<li><strong>Marksmanship Bonus</strong> is one of the levers for accuracy, the higher this is the more accurate.</li>
<li><strong>Spread</strong> is pretty self explanatory, but note that while any number 0 or above works, larger projectiles like fireballs may need relatively large spreads (2+) to actually visibly move apart.</li>
<li><strong>Calibration Distance</strong> is the other side of Effective Range - your calibration distance is the max range at which you get your full accuracy, usually ~60-80% of range - you get full accuracy up to calibration distance and then reduced accuracy up to your max range.</li>
<li><strong>Calibration Area</strong> is another field for accuracy - basically how much 'wobble' there is in aiming, the smaller it is the smaller the area that the projectile will land in.</li>
<li><strong>Bonus vs. Infantry/Cav/Large</strong> is pretty simple, works the same way as melee weapons - note that Bonus vs. Cav is deprecated and doesn't do jack in Warhammer 2, everything is either Infantry or Large.</li>
<li><strong>Overhead Stat Effect</strong> is mostly used for artillery; stuff like the Hellcannon debuff for any units under the projectile.</li>
<li><strong>Contact Stat Effect</strong> is for projectiles that actually hit stuff. Often used for stuff like Shieldbreaker.</li>
<li><strong>Burst Size</strong> is pretty rarely used in vanilla; best known for its use with Irondrakes/Warpflame Throwers, the ROR necrofex Colossus, and some high level towers.Add in its Delay in the next column and you can have several rapid-successive shots.</li>
<li><strong>Ignition Amount</strong> defines if they are Flaming attacks - 1 is on fire, 0 is not.</li>
<li><strong>Expiry Range</strong> is the max max range for a projectile; at this range it just goes splat. Should definitely be higher than Effective Range/Calibration Distance haha. -1 means it doesn't expire until it hits something.</li>
<li><strong>Shots Per Volley</strong> is another way to do multishot, used more commonly than Burst Size. Dragon/Hydra breaths use this, hence why you see many projectiles in very rapid succession; organ guns and helblaster volley guns do as well. Interestingly the ROR Necrofex has both burst size AND shots per volley but I think it's the only unit that does.</li>
</ul>
<hr />
<p><strong>projectile_bombardments</strong></p>
<p>After the massive clusterfraggle that is projectiles, this table is a lot simpler. Most of it is fairly self explanatory, especially if you copy from a vanilla one AS YOU SHOULD, but a few notes;</p>
<ul>
<li><strong>Arrival Window</strong> is the duration of the bombardment - your number of projectiles will spawn in this window. If you have &quot;Randomize Launch&quot; toggled at the end of this table, they'll spawn randomly throughout this window, otherwise it seems to just divide arrival window by projectile number.</li>
<li><strong>Projectile Type</strong> links you to the projectile you want to use - covered projectiles in the last section but stuff like damage, homing, speed, etc. are all changed there, not here.</li>
</ul>
<hr />
<p><strong>special_ability_to_invalid_target_flags</strong></p>
<p>This table isn't used by all abilities, but is used to tell the game that an ability can't be used against enemies on a wall, or only works on commanders, or can't be used if you're climbing a ladder. Fairly situational but useful at times.</p>
<hr />
<p><strong>special_ability_to_invalid_usage_flags</strong></p>
<p>This is the opposite of the previous table; that one limits what you can target, this one limits when you even have the option of targeting at all. <strong>climbing</strong> is a common flag that means you can't cast the ability when climbing a ladder for example, but you can also have abilities deactivate automatically when morale drops too low (ex. frenzy) or health drops too low (ex. martial expertise)</p>
<hr />
<p><strong>special_ability_to_recharge_contexts</strong></p>
<p>Rarely used, this table lets you limit when the countdown to ability recharge is even allowed to happen. Usually used for an <strong>engaged_in_melee</strong> check for stuff like WAAAAGH! or <strong>out_of_melee</strong> if the character has to avoid melee instead. You don't need this for 99% of abilities but it's good to know it exists.</p>
<hr />
<p><strong>special_ability_phases</strong></p>
<p>Yaaaay another obnoxiously large table! This table is optional and only used for abilities that have buffs/debuffs baked in, NOT for vortexes that inflict poison or fireballs that sunder armor. But if your ability is a buff/debuff, you will need a phase.</p>
<ul>
<li><strong>ID</strong> has to be unique, yada yada you guys know the drill by now.</li>
<li><strong>Duration</strong> is very important! Unlike Active Time in special abilities, this directly decides how long the phase lasts; -1 for forever (for passives or permanent buffs/debuffs) or 60 for 60 seconds, etc.</li>
<li><strong>Effect Type</strong> is either positive or negative. If it's a debuff go negative, obviously.</li>
<li><strong>Requested Stance</strong> is used, like, twice in vanilla and seems to be for skills that auto revive the user, I'm not sure much more than that honestly.</li>
<li><strong>Unbreakable</strong> is the first example of an attribute that an ability can imbue. Note that this only lasts as long as the phase's duration, though you can make a permanent ability just for that, but then you'd be a lot better off just giving them the unbreakable attribute for 1/10 the work, so...</li>
<li><strong>Can't Move</strong> - derp I wonder what this does???</li>
<li><strong>Freeze Fatigue</strong> means you don't lose fatigue for the duration of the effect, don't think you can gain it either. It's never used in vanilla so may be deprecated. The attribute of Perfect Vigor does this anyways without having to muck around with abilities.</li>
<li><strong>Fatigue Change Ratio</strong> is a little complicated. Negative is good here, positive is bad. Used to give a burst of positive/negative to fatigue.</li>
<li><strong>Inspiration Aura Range Mod</strong> is only really used if you want a temporary AOE boost, otherwise doing it via effects is usually better.</li>
<li><strong>Ability Recharge Change</strong> adds or subtracts that many seconds from ability cooldowns.</li>
<li><strong>HP Change Frequency</strong> is only used for heal/damage over time abilities and is in seconds; 0.5 means every 0.5 seconds, the ability will try to do whatever you filled out the heal/damage fields with.</li>
<li><strong>Heal Amount</strong> and <strong>Heal Amount Duplicate</strong> define how much the ability heals for each time it ticks based on the frequency field. Ex. your ability heals for 20 health every 4 seconds.</li>
<li><strong>Damage Chance</strong> is the chance that the ability will actually do damage each time the Frequency pops. Spirit Leech is 60% for example.</li>
<li><strong>Damage Amount</strong> is how much damage the ability actually does. This number is NOT magical damage, it's 'just' damage, so it bypasses magical/physical resistance (but not ward save).</li>
<li><strong>Max Damaged Entities</strong> lets you tune how many people it tries to do this to. Some AOE spells, like Flck of Doom, have a hardcap on entities effected per tick; damaging passive abilities like Mist of the Lady usually have a much lower hardcap (ex. 4) to keep them from just casually doing X damage to every individual - entity in rnage and multiplying their power several hundred fold. Obviously, if it isn't a damaging phase, you don't need a cap (0).</li>
<li><strong>Resurrect</strong> is a toggle that lets you overheal models back to life. Set to false for most heals, Earth Blood for example doesn't revive people, but true for - Invocation of Nehek.</li>
<li><strong>Mana Regen Mod</strong> and <strong>Mana Depletion Mod</strong> ADD directly to the WoM per second and max WoM respectively. Think Arcane Conduit and Greater Arcane Conduit.</li>
<li><strong>Imbue Magical</strong> is self explanatory. Imbue Ignition is a little weirder, set it to 10 to enable flaming attacks.</li>
<li><strong>Imbue Contact</strong> lets the unit this phase is active on inflict another phase on enemies when attacking them. Think Poison, Discouraged, Blinded, etc. Since they're just phases, you can define your own to say, create a custom poison that lowers stats and does damage over time.</li>
<li><strong>Phase Display</strong> and <strong>Phase Audio</strong> should just be plagiarized from a similar vanilla ability, self explanatory and simple.</li>
<li><strong>Recharge Time</strong> is the cooldown for a phase - VERY rarely used in vanilla, usually -1 is fine, but if you want to limit a passive like &quot;heal 2000 hp when at low health&quot; to a 120 second cooldown, this is where you do it.</li>
<li><strong>Affects Allies/Enemies</strong> is generally only relevant if you have an AOE heal/debuff/whatever that you DON'T want to touch the opposite of whoever you cast it on.</li>
<li><strong>Replenish Ammo</strong> is fairly new, and allows you to heal a burst of ammo as soon as the phase starts. If you want an ability to slowly regen ammo (say, 10% every X seconds) you'll need to chain multiple phases together. A vanilla example is the Gunnery Wight's ability.</li>
</ul>
<hr />
<p><strong>special_ability_phase_stat_effects</strong></p>
<p>This table lets you affect a unit's stats while under a phase, either for better or for worse. This is the only easy way to affect some stats in battle; <strong>accuracy</strong> for example can't be easily done by character skills and effects alone, similar to explosion size. The way it works is pretty simple; you pick your desired stat from the dropdown, give it a value, and then select whether to <strong>add</strong> the value (can be negative) or <strong>mult</strong> (above 1 is good, between 0 and 1 is bad).</p>
<p>Note that similar to effects, you can affect non-AP and AP damage separately. If you want to do both you'll generally need 2 rows.</p>
<hr />
<p><strong>special_ability_phase_attribute_effects</strong></p>
<p>This is a fun little table that adds attributes for the duration of the phase only. You can give people temporary Perfect Vigor or make them cause terror. If the phase is permanent then this will always apply, but usually for permanent attributes you want to just give them via an actual effect so they show up outside of battle too.</p>
<hr />
<p><strong>special_ability_to_special_ability_phase_junctions</strong></p>
<p>This is a fairly simple table that a unit_special_abilities key to the special_ability_phases key we just made. Note that you can link multiple phases to a single ability - depending on the Order on the left here. So you can have say, 3 phases, each of which lasts for 3 seconds and replenishes 10% ammo, if you want to have to replenish ammo in small chunks over 9 seconds instead of all at once, or if you want an ability to give a huge buff to stats for 90 seconds and then a significant debuff for 30 seconds.</p>
<p>If your ability only has 1 phase, as most do, then just put 0 for the order here and don't worry about this table further.</p>
<hr />
<p><strong>special_ability_groups_to_unit_abilities_junctions</strong></p>
<p>This table is almost exclusively used to assign new spells to a Lore. Great if you're adding new spells. You can also define your own special ability groups to create new lores (ex. Lore of Tzeentch) but in my experience it's buggy as hell.</p>
<hr />
<a class="header" href="#actually-getting-your-ability-in-game" id="actually-getting-your-ability-in-game"><h3>Actually Getting Your Ability In-game</h3></a>
<p>There are a number of ways to do this which I will cover below. As a general rule of thumb, you use an <strong>effect</strong> to attach the ability to a unit, but army abilities and other mechanics get a little weirder.</p>
<hr />
<p><strong>land_units_to_unit_abilities</strong></p>
<p>Completely belying what I just said, this is the simplest and easiest way to attach an ability to a unit - but very inflexible in turn.</p>
<p>Doing things this way permanently attaches the ability to every single unit of that land_unit key from turn 1; in vanilla this is typically used for built-in abilities like Frenzy, Rage, Martial Mastery, Regeneration, etc.</p>
<hr />
<p><strong>Character Skills</strong></p>
<p>I touched on this in the lord guide but essentially...</p>
<ul>
<li>Create an effect in the <strong>effects</strong> table.</li>
<li>If you want to give the effect to a lord for learning the skill, link the effect to the unit_ability in <strong>effect_bonus_value_unit_ability_junctions</strong>. Then attach the effect to the skill in <strong>character_skills_to_effects_junctions</strong>.</li>
<li>If you want to give the ability to a set of units (say, only Empire Swordsmen, or to Giants and Trolls), you set up the <strong>unit_set</strong> and <strong>unit_set_to_unit_junctions</strong> tables, link the set and ability in unit_set_unit_ability_junctions, link the unit set ability we just created to the effect in <strong>effect_bonus_value_unit_set_unit_ability_junctions</strong>, and then attach the effect to the skill as above.</li>
</ul>
<hr />
<p><strong>Army Abilities</strong></p>
<p>You know how Tomb Kings can summon Ushabti, Dark Elf Black Arks can call down magic-esque abilities, and Vampire Coast can calldown artillery barrages? Those are all army abilities, and they're surprisingly easy to do yourself! At least the simpler ones, heavy UI scripted stuff is hard to replicate.</p>
<p><strong>army_special_abilities</strong> to actually attach the ability to its so called &quot;army special ability&quot;, which also lets you check the Enables Siege Assault box if you're doing something like Vaul's Hammer. Then use <strong>effect_bonus_value_military_force_ability_junctions</strong> to attach it to the effect.</p>
<p>Most commonly army abilities are linked to buildings (ex. vamp coast barrages), which means <strong>building_effects_junctions</strong>. As with all building stuff, remember that you have to enable the ability for every tier of the building you want to have access to it! By the same token, if you want the second tier of the building to have access to a better version of the ability but NOT the weaker one, attach the weaker ability only to tier 1 of the building, and the better ability only to tier 2 of the building.</p>
<p>Note that unless your faction already has this ability in vanilla, you will most likely need to import the UI for it to look good. You can make your own if your a gfx wizard I guess, or just import it from data_2, ui&gt;skins, extract both <strong>hexagon_ability_frame</strong> and <strong>hexagon_ability_holder</strong>, then create a folder following that path + the faction key in your mod replicating how it looks in vanilla, ex. ui&gt;skins&gt;wh_main_chs_chaos if you're going to be giving army abilities to Chaos like I did.</p>
<hr />
<p><strong>Ancillaries</strong></p>
<p>You know how the Fay Enchantress can call down a ghetto Comet of Casadora from her item? That's an ancillary-granted ability. You know how that one Tomb Kings lord gives a banner that gives Frenzy to all Ushabti units? That's also an ancillary granted ability!</p>
<p>Actually very simple to do ingame - you make the effect as usual and attach it to the ability as desired (can add the ability to the lord only (Chalice of Potions) or if desired give it to a unit set (Lahmizash's Ushabti Frenzy), then use the <strong>ancillary_to_effects</strong> table to make it kick in whenever the ancillary is equipped.</p>
<a class="header" href="#credits-and-links-2" id="credits-and-links-2"><h3>Credits and Links</h3></a>
<p>I could not possibly have come as far as I have as a modder without the excellent people at the <a href="https://discord.gg/xs6DMbn">C&amp;C Modding Discord</a>. I cannot recommend it highly enough; while you won't ALWAYS get an answer, I've found it to be by far the best place to get help and interact with other modders. Plus you get to bug Vandy for scripting help!</p>
<a class="header" href="#database-editing" id="database-editing"><h1>Database Editing</h1></a>
<a class="header" href="#lua-3" id="lua-3"><h1>Lua &lt;3</h1></a>
<p><em>Lua</em> is a popular, lightweight, and wildly versatile programming language used in tons of modern video games, for its flexibility and very quick response time. Lua is an interpreted language, which means its code is executed and generated on the fly, as opposed to compiled languages like C or C++ which need to be “translated” - or, well, compiled - into a different file format prior to running. Its usage in the Total War series is pretty wide-spread, and is the guiding force for a lot of fun goodies, from the content of a quest battle to the implementation of the Chaos Invasion. Unlike db entries, which are compiled during the initial loading screen of the game and turned into engine data, and are often very static with very few exceptions, Lua is a dynamic energy within the game, and is the only direct way to access a multitude of game features, background data, and more.</p>
<p>This section seeks to cover a few specifics about Lua, as well as a (hopefully) solid overview of the language in the Total War context.</p>
<p>It should be noted that this tutorial series is focused on Total War: Warhammer II's Lua environment, and there can and will be many differences between the games. Efforts will be made to universal-ize this series, in the future.</p>
<a class="header" href="#from-start-to-scratch" id="from-start-to-scratch"><h1>From Start To Scratch</h1></a>
<p>Howdy and welcome, and hi, and hello. This section of the Lua section is devoted to covering as many <strong>basics</strong> of Lua one can touch on, as they pertain to Total War modding. The assumption is that the tutorial-reader has absolutely no background in coding or programming, so we will begin from the absolute top.</p>
<p>This very first section, before we get into the language itself - we'll be covering the setup and introductory phases. Next section, we'll be writing our first ever actual script, and we'll go on from there, but DO NOT skip this lesson. It's short, sweet, and gives you all the background one needs to go on.</p>
<p>I'll be covering a handful of setups that I find vital for programming in Lua. I'll be showing Notepad++, Visual Studio Code, and VSCode extension that helps debug your scripts. I find all of this to be essential, but you'll be safe with just starting as Notepad++ and returning for the rest later, when you feel more comfortable. For the love of all things holy, don't use Notepad basic.</p>
<p>This tutorial assumes you already have RPFM downloaded. If you don't yet, go grab it.</p>
<a class="header" href="#notepad-setup" id="notepad-setup"><h4>Notepad++ Setup</h4></a>
<p>First off, <a href="https://notepad-plus-plus.org/">we need to grab Notepad++</a>. Download it, install it wherever.</p>
<p>Notepad++ is a beautiful text-editing program, and we'll be using it for a couple things. At this point in my existence, I use Notepad++ mainly for global searching through libraries of scripts, it's a great way to quickly read very many scripts at the same time.</p>
<p>While you wait for Notepad++ to finish installing, you should open RPFM, and use the &quot;Open All CA Packs&quot; command (after making sure you have the proper game selected, under Game Selected).</p>
<p>Now, go find a spot to create a script dump folder. You'll need to grab all CA's vanilla scripts and put them somewhere on your PC - I recommend an HDD, if you have two drives! - in order to easily browse through their files. Once you have one created and pinned and you know where it is, go back to RPFM, and go find the main &quot;script&quot; directory. Right-click it and select &quot;Extract&quot;, and target the new folder you just made.</p>
<p>And, boom! You now have a script dump. I personally recommend renaming the &quot;script&quot; folder within your script dump folder to something like either the current patch of the game, or the current date. I do that so I can quickly reference different patches and compare versions when new DLC and updates are released.</p>
<p>Lastly, open up Notepad++, and press &quot;File -&gt; Open Folder As Workspace...&quot;. Target your renamed &quot;script&quot; folder within the script dump directory, and you'll notice that the directory appears on the left-hand side. If you right-click the main folder over there, and press &quot;Find in Files...&quot;, you'll be able to global-search all CA scripts. Incredibly handy for looking at their usage of commands, or to see any references to, say, a lord.</p>
<p>And that's Notepad++! You can make scripts in there as well, using &quot;File -&gt; New&quot; and naming it &quot;whatever_you_want.lua&quot; when saving. Though, I personally prefer using Visual Studio Code for programming in Lua (and it's what I'm typing this tutorial in), and that's where I have my IDE setup. If you're interested in VSCode, continue reading, if not carry on to the Hello World tutorial!</p>
<a class="header" href="#visual-studio-code-setup" id="visual-studio-code-setup"><h4>Visual Studio Code Setup</h4></a>
<p>Clearly, one needs Visual Studio Code. <a href="https://code.visualstudio.com/">Go get Visual Studio Code</a>.</p>
<p>You got it? No? Why are you reading this?</p>
<p>Okay, now you're ready? Good.</p>
<p>Visual Studio Code is really nice for a handful of reasons. You can save &quot;code workspace&quot; files, which allow you to easily access several folders or files that you have saved for one project. I can jump really easily between, say, my Return of the Lichemaster code workspace, and my Other Currently Secret Things code workspace, with only a couple clicks. It has a really pretty dark mode, and the syntax highlighting for Lua is gorgeous, in my opinion.</p>
<p>To use VSCode well, I suggest you setup one of these code workspaces, one for each project. To start, create a new folder on your PC, call it whatever you'd like. It's just to run through this example, so I don't really care. In VSCode, use File -&gt; Open Folder, and target that brand new folder.</p>
<p>Within VSCode now, you can create new folders, open extras, and all, and it will be within the same code workspace. I use this constantly to replicate the paths needed in CA packfiles to load scripts - so I'll make a /script folder in all of my workspaces, and I'll replicate my packfile directories within the VSCode workspace.</p>
<p>And that's it, VSCode is really simple to use (for our application atm). However, if we wanted to get more complicated and enable an IDE, keep reading!</p>
<a class="header" href="#kailua-setup" id="kailua-setup"><h4>Kailua Setup</h4></a>
<p>Within VSCode, click the bottom button on the far-left docker, the one with the title &quot;Extensions&quot;. Search for Kailua.</p>
<p><img src="images/3_1-01.png" alt="test" /></p>
<p>Install it, and enable it once it's finished installing (there will be a button saying &quot;Enable&quot;, if it says &quot;Disable&quot; just ignore it.)</p>
<p>Once you're done, open a new folder to work in within VSCode. The first thing you'll do is create a new folder in that folder (reference the image below), and name that folder &quot;.vscode&quot;.</p>
<p><img src="images/3_1-02.png" alt="test" /></p>
<p>Create a new file within the &quot;.vscode&quot; folder, and name that new file &quot;kailua.json&quot;. Within that file, input the following exactly:</p>
<pre><code class="language-json">{
   &quot;start_path&quot;: &quot;.vscode/entry.lua&quot;,
   &quot;preload&quot;: {
       &quot;open&quot;: [&quot;lua51&quot;],
       &quot;require&quot;: [&quot;.vscode/ca_types&quot;, &quot;.vscode/uimf_types&quot;]
   }
}
</code></pre>
<p>This file is the injection point for Kailua, so it knows what to do and how to do it. So you're aware for the future - the &quot;start_path&quot; directive tells it &quot;this file leads me to the other files that I have to read and error-check&quot;; the &quot;require&quot; directive tells it &quot;these files give me the definitions to check for errors.&quot; The ca_types.lua file defines many CA functions, so Kailua knows to look for two numbers when using the &quot;cm:random_number(max, min)&quot; command. The entry.lua file will be where we target our own files, to get them debugged.</p>
<p>Next up - let's create those three new files! In the same folder (.vscode), create entry.lua, ca_types.lua, and uimf_types.lua.</p>
<p>Now, shoot back to the Tools &amp; Resources page, and pick up the files of those same names, and copy-and-paste their contents in your new files.</p>
<p>And that's it! I would recommend regularly-ish checking for new ca_types.lua files within <a href="https://discord.gg/HFKff2y">the Modding Den</a>.</p>
<a class="header" href="#devtool-console" id="devtool-console"><h1>Devtool Console</h1></a>
<p>Throughout this tutorial series, I will be referencing the &quot;Devtool Console&quot;, a mod made by mklabs that allows one to run some Lua code while <em>in</em> the game. It's awesome, and I highly recommend it. I'll be suggesting you use it throughout the tutorial series. Do so.</p>
<p><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1574469690">The long and convoluted series of words that you should press on to download and subscribe to the Devtool Console.</a></p>
<p>The big thing to note is that, if you want to print stuff out onto the Devtool Console itself, you can replace out(text) with print(text). Likewise, some statements in Lua are too big to fit on one line in the Devtool Console, but you can have a statement span several lines if you'd like, as long as it doesn't involve assignment. If you don't know what I mean, read a couple lessons first and then come back.</p>
<a class="header" href="#hello-world" id="hello-world"><h1>Hello World!</h1></a>
<p>As with basically every programming tutorial on the globe, I'll begin where they all do - printing a message that says &quot;Hello World!&quot;</p>
<p>I'd like to quickly note that as this tutorial series progresses, I'm going to be helping less and less and explaining more and more. I don't want to hand-hold you through the entire project, and each lesson will include at least one &quot;challenge&quot;, where I give you an objective and tell you to go do it. Self-guided teaching is important, and once you're done this tutorial series, you'll be expected to be at least remotely competent and able to work this stuff out independently. I highly recommend you stick to the challenges and give them a shot, they'll benefit you if you really want to get good with Lua.</p>
<p>Alright, within your text editor of choice, create a new file. Within that file, type the following block:</p>
<pre><code class="language-lua">function testing_init()
    out(&quot;Hello World!&quot;)
end
</code></pre>
<p>This is our first look at functions, which I'll go much further in detail about next lesson. &quot;testing_init()&quot; is a function, which does the &quot;out(&quot;Hello World!&quot;) line when it's called. Likewise, &quot;out(&quot;Hello World&quot;)&quot; is a function of its own, and it prints the text within the brackets to a log.txt file, which CA uses for error-checking scripts and printing out details. We're using it for this first tutorial, but we'll see it many more times as we go on.</p>
<p>Save it, and save as &quot;testing_init.lua&quot; within your modding folder on your PC. Boom, your first Lua file. And you did it <em>all</em> by yourself!</p>
<p>Open up RPFM, and create a new packfile. Within the packfile, make the following script directory: &quot;script/campaign/mod&quot;. Within the &quot;/mod&quot; folder, add your testing_init.lua file. Save it as whatever you'd like.</p>
<p>I mentioned that the &quot;out()&quot; function is a CA function that prints text onto a log.txt file, but I missed a detail - on retail, that log file is never made. So, what we need to do is go and download/enable the <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=1271877744&amp;searchtext=script+debug+activator">Script Debug Activator</a> mod, by theSniperDevil, which enables the creation of that log file.</p>
<p>Now go grab your new .pack file, and drop it into Steam/steamapps/common/Total War WARHAMMER II/data (which will here-to-for be referred to as <strong>/data folder</strong>). Enable the .pack file with the mod manager of your choosing, load up the game, and load up a campaign.</p>
<p>In your game folder (Steam/steamapps/common/Total War WARHAMMER II), you should see a new file - script_log_DDMMYY_HHMM.txt. Open that up with a text editor, use find to search for &quot;Hello World&quot;. If it's there, it worked, and if it isn't, something went fatally wrong! Go back and try again.</p>
<a class="header" href="#post-credits-explanations" id="post-credits-explanations"><h4>Post-Credits Explanations</h4></a>
<p>At this point, I'd like to quickly cover how CA loads and runs script mods for modders. There is a mod-script loader built into TW:WH2, and it's pretty simple for us to use. We can load our mods automatically in different game modes, using the following paths:</p>
<ul>
<li><strong>Campaign (Mortal Empires)</strong>: script/campaign/main_warhammer/mod</li>
<li><strong>Campaign (Vortex)</strong>: script/campaign/wh2_main_great_vortex/mod</li>
<li><strong>Campaign (either)</strong>: script/campaign/mod</li>
<li><strong>Battle (excluding quest-battles)</strong>: script/battle/mod</li>
<li><strong>Frontend</strong>: script/frontend/mod</li>
</ul>
<p>And lastly, there's one path that is available during all game modes, and loads before any of the other paths (so if you load campaign, and have a script in the following directory, it will be loaded before any in the script/campaign/mod directory). I must warn, though, that this directory should only be used if you're being very smart about what's within, making sure it's all game-mode-agnostic, or making sure you're checking for the game-mode within</p>
<ul>
<li><strong>Lib</strong>: script/_lib/mod</li>
</ul>
<p>Within each of these directories (barring the battle one), if you have a function named the same thing as the .lua file (like testing_init from our last example), it will be automatically called. We'll talk more about what this means, and some alternatives to this method that I prefer, but for now we'll stick with it. Remember, if the <strong>function name</strong> matches the <strong>file name</strong> of the script, then it'll be run, except when it's in the /battle directory.</p>
<a class="header" href="#challenge" id="challenge"><h4>Challenge</h4></a>
<p>And time for your challenge. We're going to start from the top. Make a brand new pack, and a brand new script file, with a new name. Have this print out the text &quot;Goodbye World!&quot; on to the log file, as before. This time, however, make it print while in the frontend game mode (post-startup menus to select between Custom Battle/Campaign and what not).</p>
<a class="header" href="#fun-stuff" id="fun-stuff"><h1>Fun Stuff</h1></a>
<p>For our second lesson, we're going to go right into something more complicated, and I'll give you a few challenges within this. I'll voice this note right at the beginning: <strong>you won't understand every single thing I use here</strong>, and that's literally the point. This second lesson is a quick, semi-complicated script to show you some of the possibilites of scripting, with some intro knowledge on new concepts, and the next few lessons following will go right back into the bare basics.</p>
<p>First up - challenge time!</p>
<a class="header" href="#challenge-1" id="challenge-1"><h4>Challenge 1</h4></a>
<p>Your first challenge is to make a new .pack file, with a single Lua file named &quot;example_script.lua&quot; that will load exclusively in the Eye of the Vortex campaign. Create a blank function within the Lua file, named as we addressed in the last lesson.</p>
<a class="header" href="#what-were-doing" id="what-were-doing"><h4>What We're Doing</h4></a>
<p>The project here is to build a slightly solid script that affects a good amount of change. What we'll have by the end of this lesson is a script that gives Lothern control over the Phoenix Gate at the start of a new campaign, and will spawn a new army automatically when the Cult of Excess faction is destroyed.</p>
<a class="header" href="#transfer-region-on-campaign-start" id="transfer-region-on-campaign-start"><h4>Transfer Region on Campaign Start</h4></a>
<p>First thing's first, let's grant the region to them! It's important to note <em>when</em> we call <em>what</em> in our scripts. For things we want to do only once, on game start, we can use a nice CA command, <code>cm:is_new_game()</code>. All that command does is check if it's the very first turn, and the game hasn't been saved yet. We'll use that within an &quot;if&quot; statement, as follows:</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so it'll run this stuff here
    else
        -- it isn't a new game, so it'll run this stuff here
    end
end
</code></pre>
<p>You might be wondering the point of those &quot;--&quot; bits. Those dashes - two are necessary - allow you to comment your script, which I will be doing quite a bit and try to make a habit of with all scripts. Everything on that line after the &quot;--&quot; is ignored, and allows you to write whatever you want. It's really helpful when you go and look back over very old scripts and are wondering why the heck you did something a certain way. I've been there many times.</p>
<p>You might be wondering about the &quot;if cm:is_new_game() == true then&quot; bit, too. More or less, when you use the command &quot;cm:is_new_game()&quot;, it returns a value of true/false, depending on whether or not it's currently a new game. We can read that value, like I show above, and go down different branches of our script depending on the answer.</p>
<p>In a future tutorial, I'll be showing how to find these commands and use them, but for now, blind faith will make this tutorial go quicker and easier.</p>
<p>On our &quot;if cm:is_new_game() == true&quot; branch, we'll be transfering the region over to Lothern. The command we need to use is <code>cm:transfer_region_to_faction(region_name, faction_name)</code>. region_name and faction_name are both database keys, easy enough to find using the Assembly Kit.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
    else
        -- it isn't a new game, so it'll run this stuff here
    end
end
</code></pre>
<a class="header" href="#challenge-2" id="challenge-2"><h4>Challenge 2</h4></a>
<p>This one's pretty simplistic, but it'll get harder, don't worry. For now, I would like you to give Lothern a second new region, and to output some text if it isn't a new game.</p>
<a class="header" href="#are-they-dead-yet" id="are-they-dead-yet"><h4>Are They Dead Yet?</h4></a>
<p>Alright, next step - we need to create something that checks if the Cult of Excess faction is dead, before we create the thing that'll spawn the new army.</p>
<p>And no, I won't give you the answers to that challenge above! Figure it out, chap!</p>
<p>First, a new concept - listeners. One of the lessons very soon, after the basics, goes over listeners in big depth, but suffice it to say: listeners are love, listeners are life. They allow you to &quot;listen&quot; for different things happening in the game - like a battle, a region being captured, a character dying - and to &quot;trigger&quot; a function afterwards. It's the mechanic that powers things like Legendary Lord/Rite unlocks, the Chaos Invasion in big part, post-battle Chivalry or Infamy gains, and a whooole lot more!</p>
<p>We're going to use a listener that &quot;listens&quot; for Lothern's turn to start, and it'll <em>check</em> to see if the Cult of Excess faction is dead-o-rama. If they are, it'll <em>trigger</em> the spawn of the new army.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        -- the second region you should've added in the challenge!
    else
        -- it isn't a new game, so it'll run this stuff here
        -- the output you should've added in the challenge!
    end

    core:add_listener(
        &quot;MyFirstListener&quot;,
        &quot;FactionTurnStart&quot;,
        function(context)
            -- is it Lothern's turn?
            return context:faction():name() == &quot;wh2_main_hef_eataine&quot;
        end,
        function(context)
            -- check to see if the Cult of Excess is living!
        end,
        true
    )
end
</code></pre>
<p>Again, don't fear - I'll cover all this in way more depth, and this is the last time I'm gonna give this warning or clarification. Just accept it.</p>
<p>To check if they're dead yet, we have to <em>get</em> the faction object, and run a quick check on if they're living or not. We can do that with the CA command <code>cm:get_faction(faction_name)</code>. That returns what CA calls a &quot;FACTION_SCRIPT_INTERFACE&quot;. You can run a lot of functions on a faction object, a &quot;FACTION_SCRIPT_INTERFACE&quot;, as one of them is <code>is_dead()</code>. You can see more if you go to the scripting-doc.html file in Tools &amp; Resources, and search for &quot;FACTION_SCRIPT_INTERFACE&quot;.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        -- the second region you should've added in the challenge!
    else
        -- it isn't a new game, so it'll run this stuff here
        -- the output you should've added in the challenge!
    end

    core:add_listener(
        &quot;MyFirstListener&quot;,
        &quot;FactionTurnStart&quot;,
        function(context)
            -- is it Lothern's turn?
            return context:faction():name() == &quot;wh2_main_hef_eataine&quot;
        end,
        function(context)
            -- define a local variable that can be used to shorthand the faction's name
            local excess_name = &quot;wh2_main_def_cult_of_excess&quot;

            -- define a local variable to access the FACTION_SCRIPT_INTERFACE for Cult of Excess
            local excess_faction = cm:get_faction(excess_name)

            -- check if they're dead, and if they are ... 
            if excess_faction:is_dead() == true then
                -- ... spawn that army!
            end
        end,
        true
    )
end
</code></pre>
<p>Sweet! This is our first look at variables and the keyword &quot;local&quot;, which defines where that variable exists and can be accessed. More on this later on!</p>
<a class="header" href="#spawn-that-aaaaarmy" id="spawn-that-aaaaarmy"><h4>Spawn That Aaaaarmy!</h4></a>
<p>We're coming up close to being done here! All we've gotta do left is spawn the army, and all I've gotta do is challenge you a couple more times!</p>
<p>The next and penultimate CA command we'll be using is <code>cm:create_force(faction_key, army_list, region_key, x_position, y_position, exclude_named_chars, success_callback)</code>. The parameter list looks slightly daunting, but if you take some time to critically think, the only strange thing should be the very last parameter - success_callback. Luckily for you, we won't even be using that one, really.</p>
<pre><code class="language-lua">function example_script()
    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        -- the second region you should've added in the challenge!
    else
        -- it isn't a new game, so it'll run this stuff here
        -- the output you should've added in the challenge!
    end

    core:add_listener(
        &quot;MyFirstListener&quot;,
        &quot;FactionTurnStart&quot;,
        function(context)
            -- is it Lothern's turn?
            return context:faction():name() == &quot;wh2_main_hef_eataine&quot;
        end,
        function(context)
            -- define a local variable that can be used to shorthand the faction's name
            local excess_name = &quot;wh2_main_def_cult_of_excess&quot;

            -- define a local variable to access the FACTION_SCRIPT_INTERFACE for Cult of Excess
            local excess_faction = cm:get_faction(excess_name)

            -- check if they're dead, and if they are ... 
            if excess_faction:is_dead() == true then
                -- define a few local variables that we'll use in the command to save some space!
                local army_list = &quot;&quot;
                local region_key = &quot;wh2_main_vor_straits_of_lothern_lothern&quot;
                local x_position = 516
                local y_position = 430

                -- ... spawn that army!
                cm:create_force(
                    excess_name,
                    army_list,
                    region_key,
                    x_position,
                    y_position,
                    true,
                    function(cqi)
                    end
                )
            end
        end,
        true
    )
end
</code></pre>
<p>Those of you critically-thinking will notice that I kept a completely blank string for <code>army_list</code>. Guess what!</p>
<a class="header" href="#challenge-3" id="challenge-3"><h4>Challenge 3</h4></a>
<p>Create the army list! It's one single string, with unit keys separated by commas, NO spaces within the string. Give it a shot, I dare you.</p>
<p>HINT: If you're hitting a wall, global search CA scripts! I won't tell you <strong>what</strong> to search.</p>
<a class="header" href="#packaging-and-testing" id="packaging-and-testing"><h4>Packaging and Testing</h4></a>
<p>Alright, with the <code>army_list</code> string expanded, this mod should be fully functional. There is one definite bug that I know will exist, and I'll point out now - if there's a character already standing on (516, 430) game coordinates, the army will not spawn. Explaining how to avoid so would take more time than I want to spend on this lesson, so deal with it.</p>
<p>Your final task - start testing! If it doesn't work, here's a quick tip: use the out(text) function! You can use it throughout scripts to take a look at what's triggering and what isn't, like so:</p>
<pre><code class="language-lua">    if cm:is_new_game() == true then
        -- it's a new game, so give Lothern the Phoenix Gate region
        out(&quot;It's a new game!&quot;)
        cm:transfer_region_to_faction(&quot;wh2_main_vor_phoenix_gate&quot;, &quot;wh2_main_hef_eataine&quot;)
        out(&quot;Added Phoenix Gate&quot;)
        -- the second region you should've added in the challenge!
        out(&quot;Added the second region!&quot;)
    else
        -- it isn't a new game, so it'll run this stuff here
        out(&quot;It's not a new game!&quot;)
        -- the output you should've added in the challenge!
    end
</code></pre>
<p>And that's it, yo. Next up, we'll get down to the bare bones and get some great understanding! If some of this stuff didn't make sense, keep pushing on through the next few lessons where I break it down to the bit and hopefully give you a more fuller knowledge on the language. I gave you a glimpse at some story-telling; now let's go back and learn the alphabet, grammar, and colloquialisms.</p>
<a class="header" href="#chunks--statements" id="chunks--statements"><h1>Chunks &amp; Statements</h1></a>
<p>The first two terms we'll look at are <strong>chunks</strong> and <strong>statements</strong>. When Lua is brought to its basic skeletal structure, that's all it is - chunks of statements.</p>
<p><strong>Statement</strong>: A declaration, a thing-to-be-done, a command that Lua will run
<strong>Chunk</strong>: A sequence of statements, from an entire file to a single line of data</p>
<p>Every chunk is a to-do list, and a statement is an objective on that list. You can have to-do lists of all shapes and sizes, and each thing that needs to be done can be small - &quot;brushing your teet&quot; - or huge - &quot;spend way too much money on transmission repairs&quot;. No, I'm not still salty about the money I spent on transmission repairs, why do you ask?</p>
<p>The Lua interpreter divides everything it takes into specific chunks, which we'll look at later on. For now, we understand the term chunk - a to-do list.</p>
<p>Within each chunk is one or more statements. A statement is one coherent thought or action within Lua. Something like this can be one statement:</p>
<pre><code class="language-lua">a = 1
</code></pre>
<p>Or, this can be one statement:</p>
<pre><code class="language-lua">a = 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 - 1 / 70 * 300 + 5180 - 418 + 405
</code></pre>
<p>That is, one bit of data that Lua has to evaluate and run.</p>
<p>Remember the term &quot;chunk&quot; - we'll be covering how they're defined later on, when we look at some more keywords.</p>
<a class="header" href="#variables--types" id="variables--types"><h1>Variables &amp; Types</h1></a>
<p><em>NOTE: I recommend you have the Devtool Console handy to mess around with some of the stuff covered here.</em></p>
<p>Following the concept of chunks and statements, the next most important subject to cover is variables, and types.</p>
<p><strong>Variable</strong>: A custom-made keyword that can be used to represent a value
<strong>Type</strong>: The sort of value that is in a variable. Lua types include: boolean, string, number, table, nil, function. There are more, but we won't need them.</p>
<p>But before going deeper into a definition, let's look at an example:</p>
<pre><code class="language-lua">a = 10
b = 5
c = a + b
</code></pre>
<p>We can see that each of those letters in the chunk above is a <strong>variable</strong>, which are each assigned a <strong>value</strong>. In this case, variable <strong>a</strong> is assigned the value <strong>10</strong>, variable <strong>b</strong> is assigned the value <strong>5</strong>, and the variable <strong>c</strong> is assigned the <strong>value of a plus the value of b</strong>. This instance (c = a + b) works a lot like algebra - you aren't making &quot;c = ab&quot;, but you're adding the value of a (10) to the value of b (5), to get the result of <strong>15</strong>.</p>
<p>The coolest thing about variables is their dynamism. They can be assigned to any type, change to any type, and they can infinitely change values. Let's take the above code, and mess with it a little bit.</p>
<p><em>NOTE: From this point on, you'll see → after out() calls. This is to specify what text is actually output.</em></p>
<pre><code class="language-lua">a = 10
b = 5
c = a + b

out(a) → 10
out(b) → 5
out(c) → 15

a = 25
out(a) → 25

out(c) → 15

c = a + b
out(c) → 30
</code></pre>
<p>I wanted to point out an important thing with this example. If a variable is assigned to the values of some other variables (c = a + b), it will do the calculation and assignment the <strong>moment</strong> that the statement is called. If either variable (a or b) is changed after the assignment statement, the assigned variable's (c) value (15) won't change. It takes the <em>variable's value</em>, not the <em>variable itself</em>.</p>
<p>So, we see here that variables can be numbers, which is one of the primary types in Lua.</p>
<p><strong>Number</strong>: <em>any</em> numerical value, within a specific number range (a much bigger number than needs to be worried about)</p>
<p>As we saw above, we can perform some basic arithmetic on numbers.</p>
<pre><code class="language-lua">a = 5
b = 2 - 0.34
c = a + b
d = c * 2
e = d / 3

out(c) → 7.56
out(d) → 15.12
out(e) → 5.04
</code></pre>
<p><strong>String</strong>: <em>any</em> alphanumerical value, within quotation marks (&quot;&quot; or ''). Similar to numbers, size <em>does not matter</em>, Lua can handle millions of characters within a string.</p>
<p>Like arithmetic for numbers, one can concatenate strings (along with many other stuffs!) to combine several, using the <code>..</code> operator.</p>
<pre><code class="language-lua">    a = “This “; b = “is “; c = “an “; d = “example.”
    out(a .. b .. c .. d) → This is an example.
</code></pre>
<p><em>NOTE: Yes, you can have several statements on the same line in Lua! The semi-colons are not necessary, I added them for extra readability.</em></p>
<p>While on the subject, you can concat (cool-kid for concatenate) string literals and variables.</p>
<pre><code class="language-lua">    a = &quot;example&quot;
    out(&quot;This is an &quot; .. a) → This is an example
</code></pre>
<p><strong>Boolean</strong>: a <code>true</code> or <code>false</code> value.</p>
<pre><code class="language-lua">    a = false
    out(a) → false
    out(a == false) → true
</code></pre>
<p>The above probably looks a little weird, but that's because we're learning a new operator! The <code>==</code> operator checks for <em>equality</em>, whereas the <code>=</code> operator <em>assigns a value</em>. The final statement above reads &quot;output the result of a == false&quot;. Since <code>a</code> DOES equal false, it prints &quot;true&quot;.</p>
<p>It's very important to note that any variable can be <em>treated</em> as a boolean, such as when using the &quot;if something then&quot; statement, or by comparing it to a boolean. If a non-boolean variable is treated as a boolean, it will be converted to <code>false</code> if the value is <code>nil</code> or <code>false</code>; otherwise, it will be converted to <code>true</code>.</p>
<pre><code class="language-lua">    a = 0
    b = nil
    out(a) → 0
    out(a == false) → false 
    out(b == false) → true
</code></pre>
<p>In this case, <code>a</code> does NOT equal <code>false</code>, because it has a value to it that isn't <code>false</code> or <code>nil</code>. By the same card, <code>b</code> DOES equal <code>false</code>.</p>
<p>You're probably asking by now, what IS nil? I've mentioned it a number of times already, you're probably ready to lear about it. Here we go!</p>
<p><strong>Nil</strong>: the absence of data.</p>
<p>If one were to try to print a <em>non-existent</em> variable, the result would be <code>nil</code>. That's because there <strong>is</strong> no data for that variable.</p>
<pre><code class="language-lua">    out(a) → nil
    a = 5
    out(a) → 5
</code></pre>
<p>Nil is a good way to check whether or not something exists, and we'll, towards the bottom of this lesson, talk about how to type-check this data in our scripts to see if variables are NOT nil, and thus exist.</p>
<p>Nil is also a good way to clear away variables that you don't want to use anymore. There's a more realistic way of doing it, and this probably won't be necessary for most of what you will be doing, but I like to give a full knowledge.</p>
<pre><code class="language-lua">    a = 5
    out(a) → 5
    a = nil -- Memory deallocated, bye &quot;a&quot;!
    out(a) → nil
</code></pre>
<p>Lastly, it's important to note that <code>nil</code> is not the same as <code>null</code>, though they look quick similar. We'll cover that soon-ish, when we get into more CA script interfaces (like FACTION_SCRIPT_INTERFACE that we saw a few lessons ago).</p>
<p><strong>Function</strong>: a definition for a chunk that can be called at any point, after being defined.</p>
<p>There are two types of functions - an anonymous function, and a named function. An anonymous function has no name (clearly), so it cannot be called further on in the script. We use anonymous functions relatively frequently, but our focus now will be on named functions, which are functions assigned to a variable.</p>
<pre><code class="language-lua">    a = 10
    example = out
    example(a) → 10
</code></pre>
<p>Yes, that's valid! You can actually assign a variable to a function like, it's pretty cool! We have syntactic sugar for assigning a variable to a function, however, and it's more common to see script like that:</p>
<pre><code class="language-lua">    function example(text)
        out(text)
    end

    example(&quot;Testing!&quot;) → Testing!

    example(&quot;A Cooler Test!&quot;) → A Cooler Test!
</code></pre>
<p>As an added bonus, we're getting a quick sneak peak at one of the upcoming tutorials: parameters and arguments, for functions. In the above function, &quot;text&quot; is a parameter for <code>example()</code>, which is then passed along to <code>out</code> and triggers that function within the chunk.</p>
<p><strong>Table</strong>: a collection of more than one piece of data.</p>
<p>There are several types of tables, which we'll cover later on. I'd like to first look at the <em>array</em> version of tables, the simplest and most common.</p>
<pre><code class="language-lua">    a = 5
    b = 10
    c = 17

    table = {
        a,
        b,
        c
    } -- assign the three *values* of the variables to the table
    
    out(table[1]) → 5 -- Lua tables start at index 1!
    out(table[2]) → 10
    out(table[3]) → 17
    out(table[4]) → nil -- doesn't exist!
</code></pre>
<p>Arrays are numbered automatically, so it really reads &quot;the first index of table is 5, the second index of table is 10&quot;, and so on. You <em>access</em> those indexes by using the <code>\[num\]</code> operator, which we'll look further at in the next tables tutorial later on. The reason this works, however, is because Lua is automatically numbering these values, giving them a <em>key</em>. When you make an array like that, Lua reads it more like the following:</p>
<pre><code class="language-lua">    a = 5
    b = 10
    c = 17

    table = {
        [1] = a,
        [2] = b,
        [3] = c
    }
</code></pre>
<p>The other major type of tables is a <strong>map</strong>, which works by manually assigning the key of a value instead of letting Lua automatically number them, like in arrays.</p>
<pre><code class="language-lua">    a = 5
    b = 10
    c = 15

    table = {
        [&quot;five&quot;] = a,
        [&quot;ten&quot;] = b,
        [&quot;fifteen&quot;] = c
    }

    out(table[&quot;five&quot;]) → 5
    out(table[&quot;ten&quot;]) → 10
    out(table[&quot;fifteen&quot;]) → 15
</code></pre>
<p>Maps will come into some great use pretty soon, but for now I just wanted to introduce you to how they look.</p>
<p>For now, you've done well, and I haven't even challenged you yet!</p>
<a class="header" href="#challenge-1-1" id="challenge-1-1"><h4>Challenge 1</h4></a>
<p>Mess with everything in this tutorial using the Devtool Console. Try to grasp the different native types of Lua, and make sure you understand the difference between the <em>assignment</em> operator and the <em>equality</em> operator. There's not really a good challenge to do here, but I do seriously suggest you just mess around with the stuff here. Try some different things like concatenating strings, adding numbers, messing with basic functions, stuff like that. Have fun!</p>
<a class="header" href="#type-checking" id="type-checking"><h4>Type-Checking</h4></a>
<p>And before we say goodbye, let's look at a few more CA functions. These ones can type-check for us, seeing if a variable is, for instance, a string.</p>
<p>The list is as follows:</p>
<ul>
<li>is_nil(variable)</li>
<li>is_string(variable)</li>
<li>is_number(variable)</li>
<li>is_boolean(variable)</li>
<li>is_function(variable)</li>
<li>is_table(variable)</li>
</ul>
<pre><code class="language-lua">    a = 5
    b = nil
    c = {1, 2, 3, 5, 70}
    function d() end

    out(is_number(a)) → true    
    out(is_nil(b)) → true
    out(is_table(c)) → true
    out(is_function(d)) → true
</code></pre>
<a class="header" href="#expressions--operators" id="expressions--operators"><h1>Expressions &amp; Operators</h1></a>
<p>As we've seen, Lua is made up of <code>chunks</code> and <code>statements</code>. Statements can contain variables, and all variables have a type, though it can change at any point.</p>
<p><strong>Expressions</strong> are the section of a statement that, essentially, tell Lua <em>what to do</em>. They come in a billion different shapes and sizes. For now, we'll cover all the basics you'll need, and some basics you really don't need but I'll hand it to you anyway, and we'll go back and review some older stuff. Here we go!</p>
<a class="header" href="#math-operators" id="math-operators"><h4>Math Operators</h4></a>
<p>Sweet. This is what all of those quizzes in grade school trained you for. We have the big four from algebra - addition, subtraction, multiplication, and division.</p>
<pre><code class="language-lua">    out(2 + 3) → 5
    out(5 - 1) → 4
    out(16 * 3) → 48
    out(9 / 3) → 3
</code></pre>
<p>We can also use a <code>-</code> to <em>negate</em> a value, or, in simple terms, turn a positive number into a negative and vice versa.</p>
<pre><code class="language-lua">    a = 10
    b = -20
    out( -a ) → -10
    out( -b ) → 20
</code></pre>
<p>We also have a couple other fun math things. We can raise numbers to any power, using an exponential expression.</p>
<pre><code class="language-lua">    a = 2
    b = 4
    c = 3
    out( a^a ) → 4
    out( b^c ) → 64
    out( 64^0.5 ) → 8 -- getting the square root of a number!
</code></pre>
<p>We can also use some modulo math. It's a way of dividing two numbers that gives you the amount <em>remaining</em>, and it's a great way to read if a number is a <em>multiple</em> of another.</p>
<pre><code class="language-lua">    out(8 % 2) → 0 -- 8/2 = 4, and divides evenly, so nothing is remaining!
    out(7 % 2) → 1 -- 7/2. &quot;6/2&quot; divides evenly, so we subtract 6 from 7, and get &quot;1&quot; as the remainder!
    out(8 % 3) → 2 -- 8/3. &quot;6/3&quot; divides evenly, so we subtract 6 from 8, and get &quot;2&quot; as the remainder.
</code></pre>
<p>As said, it's a great way to read if a number is a multiple of another. If a modulo expression returns &quot;0&quot;, that means it divided evenly, and is therefore a multiple of the number divided by.</p>
<p>And that's math!</p>
<a class="header" href="#comparison-operators" id="comparison-operators"><h4>Comparison Operators</h4></a>
<p>This sounds a lot more complicated than &quot;math&quot;, eh? It's not that complicated - we're comparing how two variables relate to one another, using expressions we've all seen before. The list of comparison operators are as follows:</p>
<p>&lt; -- &quot;less than&quot;
&gt; -- &quot;greater than&quot;
&lt;= -- &quot;less than or equal to&quot;
&gt;= &quot;greater than or equal to&quot;
== &quot;equal to&quot;
~= &quot;not equal to&quot;</p>
<p>All of these expressions result in a boolean value.</p>
<pre><code class="language-lua">    a = 10
    b = 7 + 3
    out(a == b) → true -- they ARE equal!
    out(a ~= b) → false -- they ARE NOT not equal (weird, I know)!

    c = 8
    d = 7
    
    out(c &gt; d) → true -- 8 is greater than 7
    out(c &lt; d) → false -- 8 is NOT less than 7
</code></pre>
<p>It's important to note that Lua will consider different types to be different values. A string and a number will always be different. Lua will throw an error if you attempt to compare - using less-than or greater-than - any two separate types. Lua will not throw an error for &quot;==&quot; and &quot;~=&quot;, however, and if they are separate types, they will always be inequal.</p>
<pre><code class="language-lua">    a = 15
    b = &quot;15&quot;
    out(a == b) → false -- they are different types!
    out(a &gt;= b) → error (attempt to compare number with string)
</code></pre>
<p>Do note that you can compare strings using greater or less than, but it compares the alphanumerical order of the first character. “0” is less than every number or letter, whereas “a” is greater than every number and less than every letter, and “z” is greater than every number or letter. Again, not really important, but you came here to read me ramble on about random stuff.</p>
<p>And that ends our comparison operators!</p>
<a class="header" href="#logical-operators" id="logical-operators"><h4>Logical Operators</h4></a>
<p>Next up are our logical operators! We have three operators to concern ourselves with here - <strong>and</strong>, <strong>or</strong>, and <strong>not</strong>.</p>
<p><em>Not</em>, as a logical operator, is pretty simple and super handy. It basically converts the value to the right of it into a boolean, and reverses it. Any value other than <code>nil</code> or <code>false</code> will be converted into <code>false</code>, and <code>nil</code> or <code>false</code> will be converted to <code>true</code>. Let's take a look:</p>
<pre><code class="language-lua">    a = true
    b = nil
    out(not b) → true -- prints a double negative - not false, so true
    out(not a) → false -- reverses the value of &quot;true&quot;

    c = 100
    out(c) → 100
    out(not not c) → true -- c is a number, &quot;not c&quot; would become &quot;false&quot;, and &quot;not false&quot; would become &quot;true&quot;
</code></pre>
<p>The operators <strong>and</strong> and <strong>or</strong> are the hearts of a lot of logic in Lua. &quot;If this and this, then do this&quot;.</p>
<pre><code class="language-lua">    a = 15
    b = false
    if a == 15 and not b then -- &quot;if a is equal to the number fifteen, and &quot;not b&quot; returns true, then ... &quot;
        out(&quot;It does the thing!&quot;) -- &quot; ... print the text! &quot;
    end
</code></pre>
<p>You'll practically always see these two used in this way, for <em>conditional statements</em> like that - if these conditions work out, then do this other thing.</p>
<a class="header" href="#homeless-operators" id="homeless-operators"><h4>Homeless Operators</h4></a>
<p>I don't really have a category for these two operators, but they're incredibly important.</p>
<p>First off, we have <strong>concatenation</strong>, which we've seen before. It's a way to add two strings together, and make them into one happy family, using a simple pair of dots.</p>
<pre><code class="language-lua">    a = &quot;Hello&quot;
    b = &quot;World!&quot;
    out(a .. &quot; &quot; .. b) → Hello World!
</code></pre>
<p>A couple of notes real quick - I have the blank space in a string in the middle, to make sure it doesn't print &quot;HelloWorld!&quot;. Also, I like to add spaces on either side of my concatenation operator, but that's personal taste, this would also be valid:</p>
<pre><code class="language-lua">    out(a..&quot; &quot;..b) → Hello World!
</code></pre>
<p>And lastly, we have one more operator, and this time for the table type. The character <code>#</code> can be used to read the number of entries within an array. It's pretty awesome, let me show you:</p>
<pre><code class="language-lua">    table = {&quot;this&quot;, &quot;is&quot;, &quot;an&quot;, &quot;example&quot;, &quot;array&quot;}
    out(#table) → 5 -- there are five strings within the table!
</code></pre>
<p>Please note that you really shouldn't use the <code>#</code> operator if the table is not definitely an array. I'll show you why using it on maps might mess something up:</p>
<pre><code class="language-lua">    table = {
        [1] = &quot;test&quot;,
        [2] = &quot;example&quot;,
        [5] = &quot;boom&quot;,
        [7000] = &quot;woo&quot;,
        [3] = &quot;argh&quot;
    }

    out(#table) → 7000
</code></pre>
<p>In technicalities, it's doing that because it's reading the <em>highest index in that table</em>, or the highest numerical key. Those are assigned automatically, in order, for arrays; in maps, there's no such guarantee.</p>
<a class="header" href="#challenge-1-2" id="challenge-1-2"><h4>Challenge 1</h4></a>
<p>As with last, no challenge! We have only a couple more lessons to do before we get into the REAL nitty-gritty, and once we do there will be a lot of nice challenges. For now, keep messing with this stuff in the DevTool Console, test around.</p>
<a class="header" href="#scopes--stuff" id="scopes--stuff"><h1>Scopes &amp; Stuff</h1></a>
<p>A super important concept in Lua is the concept of <em>scope</em>. Every single variable made has a <em>scope</em>, which is used to define <strong>where</strong> a variable can be accessed.</p>
<p>By default, all variables are <code>global</code>, which means they're in the entire <strong>global environment</strong>. The global environment is a slightly-fancy way of saying &quot;available within the entire program&quot;. When writing Total War scripts, it's a little suboptimal to use global variables, for a few reasons -
1) What if someone else wants to use a variable named <code>a</code>, and you do as well? This would force you to have a fully unique name for every single variable everywhere. Kinda a pain!
2) Saving that variable globally is taking up memory, since that variable will never be destroyed. It will take a lot of work to actually cause performance issues, but it's good to be mindful of.
3) What if we want our variable to be a secret? Huh? They can't get our birthday present! <em>gollum</em></p>
<p>And all this is where the keyword <code>local</code> comes in. The <code>local</code> keyword defines a specific scope for a variable, and prevents them from being a global variable.</p>
<pre><code class="language-lua">function example()
    local var = &quot;Hello World!&quot;
    out(var)
end

example() → Hello World!
out(var) → nil -- the variable &quot;var&quot; doesn't exist here!
</code></pre>
<p>In this example, the variable <code>var</code> is defined within the function <code>example</code>'s definition. That means that <code>var</code> is only available from <em>where it is defined</em> (ie. local var =) to <em>where the scope ends</em>. In this case, the scope <em>ends</em> at the <code>end</code> keyword.</p>
<p>This is as good a time as any to look at the other ways scope can be defined. A variable can be scoped to the <em>root</em> of a script, or any number of nestled scopes within that root.</p>
<p>Other key-words other than <code>function</code> that define a scope (and their end point) are as follows:</p>
<ul>
<li>do --[[ the scope ]] end</li>
<li>function function_name() [[ the scope ]] end</li>
<li>if whatever then [[ the scope ]] end</li>
<li>while whatever then [[ the scope ]] end</li>
</ul>
<p>Let's take a slightly-complicated look at that:</p>
<pre><code class="language-lua">local a = 5 -- visible to everything BELOW this line!

function example_thing()
    local b = a -- visible to everything BELOW this line, until the &quot;end&quot; that matches &quot;function&quot;
    do 
        local c = 15 -- visible to everything BELOW this line, until the &quot;end&quot; that matches &quot;do&quot;
        out(c)
        out(b) 
    end
    out(b)
    -- c is NOT available here!
end

-- b and c are NOT available here!
out(a) → 5
</code></pre>
<p>This is a good point as any to explain two things, and issue two directives:</p>
<ol>
<li>ALWAYS use the keyword <code>local</code>.</li>
<li>ALWAYS use good indentations!</li>
</ol>
<p>Be smart with where exactly the term &quot;local&quot; is used - you'll pick up how later on as you go and pick my brain, but for now, understand that you must ALWAYS put the keyword <code>local</code> before a variable!</p>
<p>As you can see with the example_thing() function above, proper indentation is a GREAT way to visibly see scopes and quickly tell where a variable is and isn't available.</p>
<a class="header" href="#functions-arguments--parameters-also-returns" id="functions-arguments--parameters-also-returns"><h1>Functions, Arguments &amp; Parameters (Also, Returns)</h1></a>
<p>Welcome back! On today's lesson, we're going to cover one of the most fundamental types in Lua much further, and that type is, if you can read, <em>functions</em>. Everybody loves functions.</p>
<p>Functions are a special data type in Lua. Functions have two specific stages: <strong>definition</strong>, and <strong>call</strong>. A function can be defined as many times as one would like, but it will not do anything until the function is <em>called</em>. Quick look, followed by a breakdown:</p>
<pre><code class="language-lua">    -- DEFINE the function, which we can call and trigger later on, as much as we'd like
    function example_function()
        out(&quot;This is your example function&quot;) -- at this point, nothing is output
    end

    -- actually calling the function to trigger the out!
    example_function() → This is your example function
</code></pre>
<p>And that's the basics of it! We should note that in this example, <code>example_function</code> is actually a variable name. The above is syntactic sugar for the following:</p>
<pre><code class="language-lua">    example_function = function()
        out(&quot;This is your example function&quot;)
    end
</code></pre>
<p>But the other way is a lot more common, and probably prettier for all eyes. On the case of syntactic sugar, you can simply put the keyword <code>local</code> prior to the keyword <code>function</code>, and it will make it a local variable. I'll be doing that from now on, to beat that idea in your own head.</p>
<p>Since the name of a function is just a variable, it can be redefined, and even as a different type. If a variable is defined more than once, the latest definition will &quot;win&quot;.</p>
<pre><code class="language-lua">    local function example_function()
        out(&quot;This is your example function&quot;)
    end

    example_function = 10 -- Why would ANYONE do this?!

    example_function() → attempt to call global `example_function`, a number value
</code></pre>
<p>The term &quot;call&quot; here is what I mentioned earlier - the <em>call</em> phase of a function. A call to a function is triggered by those two brackets - <code>()</code>.</p>
<p>At this point, we have a function that prints the same text over and over again. Let's give it some way to change the text based on some dynamism!</p>
<pre><code class="language-lua">    local function example_function(text)
        out(text)
    end

    example_function(&quot;Testing&quot;) → Testing
    example_function(&quot;Example!&quot;) → Example!
</code></pre>
<p>The term &quot;text&quot; is a <code>local variable</code> for that function, available in the entirety of that function's scope. It goes &quot;out of scope&quot; (as the cool kids say) by the <code>end</code> keyword. This is another clever shorthand that the Lua languages gives to us. Use it!</p>
<p>A clarity-for-clarity's-sake note here: in the above example, &quot;text&quot; is a <em>parameter</em>, which is the fancy word for a local variable assigned to the function's scope. The string &quot;Testing&quot;, or the string &quot;Example!&quot;, are <em>arguments</em>, which is a variable or value that is &quot;passed&quot; into the function and takes the place of the parameter at runtime. We can think of a parameter as a &quot;fill-in-the-blank&quot; space on an entry form, and the argument as whatever we fill in there.</p>
<p>One final thing we should know about before we go on is <em>return values</em>. In the above, we're just passing stuff <em>into</em> a function. But what if I want to take stuff <em>out</em> of a function? Well, return values, of course!</p>
<p>The keyword <code>return</code> is neat, and two-fold. Its first, and primary purpose, is to take whatever is to the right of it and shoot it back out, if the function is called. Its second, and still very-important, purpose is to stop the function once the keyword is called. Let's take a look at a common example of return values:</p>
<pre><code class="language-lua">    local function double(num)
        -- if the parameter is not a number type, then output some text and then STOP the function, to prevent it from going on
        if not is_number(num) then
            out(&quot;double() called, but you didn't supply a number! Aborting function!&quot;)
            return
        end

        -- if the parameter is a number type, then double it and return it! (we can safely assume that &quot;num&quot; IS a number, because otherwise the function wouldn't go this far)
        local val = num * 2
        return val
    end

    local a = 2
    out(a) → 2

    -- define a local variable as the RESULT of &quot;double(a)&quot;
    local b = double(a)
    out(b) → 4
</code></pre>
<p>You can return any type, and you can even return multiple values at once. Say you wanted to take the above function, but instead of just doubling the number, you <em>also</em> tripled it, and wanted to get both values.</p>
<pre><code class="language-lua">    local function double_and_triple(num)
        -- if the parameter is not a number type, then output some text and then STOP the function, to prevent it from going on
        if not is_number(num) then
            out(&quot;double_and_triple() called, but you didn't supply a number! Aborting function!&quot;)
            return
        end

        local double = num * 2
        local triple = num * 3

        -- this is it, just separate the return values or variables with a comma!
        return double, triple
    end

    local number = 5

    local d, t = double_and_triple(number)
    out(d) → 10
    out(t) → 15
</code></pre>
<p>I'd like to point out that I'm changing the names of my variables to point out that <em>the name of parameters can be whatever you want</em>. Don't be confused by me defining the function as <code>local function double_and_triple(num)</code> and calling it using <code>double_and_triple(number)</code>. <code>num</code> is a local variable, available only in the SCOPE of the function, whereas <code>number</code> is a <em>different</em> local variable, available to a higher scope but below the function definition.</p>
<p>At this point, we've got all the background knowledge really needed to start doing some more cool stuff! In the next lesson, we'll learn more about script interfaces, we'll go further in-depth about listeners (which we briefly used in lesson #2), and we'll talk about commands and how to check for existing ones! And you'll have A CHALLENGE!</p>
<p>WOO!</p>
<a class="header" href="#commands-interfaces--listeners" id="commands-interfaces--listeners"><h1>Commands, Interfaces &amp; Listeners</h1></a>
<p>For today's lesson, the subject is three-fold: <strong>commands</strong>, <strong>interfaces</strong>, and <strong>listeners</strong>. We've looked at all three of these before - all in lesson #2 - but in this lesson, we'll be going way further in-depth so you might have a better grasp of all of those subjects.</p>
<a class="header" href="#commands" id="commands"><h4>Commands</h4></a>
<p>A command, put <em>simply</em>, is a CA-defined Lua function that does some cool stuff that we can't do. We've seen a few already - <code>cm:transfer_region_to_faction()</code> and <code>cm:create_force()</code>. Commands are used to communicate between the Lua environment and the actual Total War Engine - the base C++ code that defines the majority of the game.</p>
<p>Through these commands, we can script a whole lot of stuff! From character spawns, to new effects applied to characters and factions and armies, to quest battles, to unlocking rites, and so on.</p>
<p>In big part, commands make or break what can be done with scripts. Commands are the driving force of most any script. At this point, though, you might be asking - &quot;how the HECK do I find out what the commands are?&quot; And that, my friend, is why you're reading this lesson. Or maybe you got lost when you were just trying to find funny videos about cats. Either way, next paragraph!</p>
<p>So, once more in the <a href="./chapter_1.html">&quot;Tools &amp; Resources&quot;</a> page on this site, there's a section within called &quot;Scripting Resources&quot;. We'll look at, first, the &quot;Scripting Doc (CM Functions)&quot; file. Open it up!</p>
<p>Now, before we go on, one thing MUST be covered. <strong>EVERY command in this document needs to have a prefix of <code>cm:</code>.</strong></p>
<p>In this document, let's take a look at the two commands that we've used already.</p>
<pre><code class="language-lua">    Command: 	transfer_region_to_faction	
    Description: 	Transfer a region ownership to a faction.	
    Usage: 		transfer_region_to_faction(&quot;region&quot;, &quot;faction&quot;)
</code></pre>
<p>This is relatively straightforward. The <code>Command:</code> line tells you what to affix to <code>cm:</code>, so this would be <code>cm:transfer_region_to_faction</code>. Since it's a <em>function call</em>, which we learned about just last episode and you wouldn't dare forget so soon, we add the brackets to it: <code>cm:transfer_region_to_faction()</code>.</p>
<p>We can see in <code>Usage:</code> that it takes TWO parameters. They seem to be strings, one of which says &quot;region&quot;, the other &quot;faction&quot;. It's easy enough to tell that means &quot;the region key in string&quot;, and &quot;the faction key in string&quot;. So, overall, the command call would look like this: <code>cm:transfer_region_to_faction(&quot;phoenix_gate&quot;, &quot;eataine&quot;)</code>.</p>
<pre><code class="language-lua">    Command: 	create_force	
    Description: 	create a navy or army at a position.  Final parameter specified whether the command goes via the command queue	
    Usage: 		create_force(&quot;faction_key&quot;, &quot;unit_list&quot;, &quot;region_key&quot;, x_position, y_position, exclude_named_characters, &quot;id&quot;, true)
</code></pre>
<p>The same applies here. <code>cm:create_force()</code>, with a bunch of parameters. You might notice, however, that it's <em>completely different</em> compared to what we used before. Instead of <code>&quot;id&quot;</code>, we used <code>success_callback</code>, and there WAS no parameter after that. What the heck? Let's back-up and talk about why.</p>
<p>The commands in this document are commands to the <em>game interface</em>, something that you really should never, ever touch directly, for fear of crashing the game if you mess something up. These functions -<code>cm:create_force()</code> - are <em>wrappers</em>, over that base command, so we don't have to directly touch the game interface directly. Using the CA functions will quickly error-check our code, and prevent any such crashes (when wrappers for those commands exist!). But what do I mean? Let's open up our script dump and go to script/_lib/lib_campaign_manager.lua, and search for <code>create_force(</code>.</p>
<p>We'll see a line that looks similar to what I have already shown you - <code>function campaign_manager:create_force(faction_key, unit_list, region_key, x, y, exclude_named_characters, success_callback)</code>. This is the <em>wrapper</em>. Within this function, lower down at the bottom, we can see the call to the game interface - <code>self.game_interface:create_force(faction_key, unit_list, region_key, x, y, id, exclude_named_characters, true);</code>. This looks a lot closer to the definition CA has in their documentation, and I belive it was the definition they were trying to go with. Not sure though!</p>
<p>In these situations, it pays to be careful. I advise you to use the CM Scripting Doc cautiously. It isn't fool-proof, and every change that CA has made over the years hasn't been recorded in there - there are commands listed that haven't been functional since Total War: Empire. This is when I point you back to the <a href="./chapter_3_1.html">Setup lesson</a>, if you haven't done that, and tell you to go do it. There are three hyper important tricks in there that will help you understand what to do in a situation like this:</p>
<ol>
<li>
<p>Check the lib files! Most functions in this document will be in <code>lib_campaign_manager.lua</code>. Bonus, as you could see with the above example, CA gives a quick explanation for what the function does and what the types are, and where they are found. This is always my first check</p>
</li>
<li>
<p>Use the script dump! All you have to do is use &quot;Find In Files ... &quot; within Notepad++, type in the name of the command (ie. <code>create_force</code>), and wait for it to search all the files. It will come up with some hits, and you can read through CA scripts to see what they do and how it's used.</p>
</li>
<li>
<p>Use Kailua! It might take some time to fully understand the <code>ca_types.lua</code> file that we've made for TW:WH2, but it should be pretty easy to <em>read</em> it if you want to know the parameters of a function. Open <code>ca_types.lua</code>, within VSCode (or whatever), search for the name of the command again (<code>create_force</code>), and it will show you some neat stuff. I'll go over what it looks like now, just so you know:</p>
</li>
</ol>
<pre><code class="language-lua">--# assume CM.create_force: method(
--#     faction_key: string,
--#     unitstring: string,
--#     region_key: string,
--#     xPos: number,
--#     yPos: number,
--#     exclude_named_chars: boolean,
--#     callback: (function(CA_CQI))?
--# )
</code></pre>
<p>Each of these lines is a <em>parameter</em>, and it's split into a name and a type. The name is just a description of what should go there - a faction key, a region key, etc., - and the type defines, of course, the type!</p>
<p>There's a third example I'd like to go into, which is return types via the CA commands. It works just like regular return values (seen from the <a href="./chapter_3_1_7.html">last lesson</a>), but sometimes the return value is vague, and it's really hard to read using CA's scripting doc. Again, utilize the script dump and Kailua. In Kailua, it'll look a little different - let's grab an example of a command with a return value.</p>
<pre><code class="language-lua">--# assume CM.get_saved_value: method(valueKey: string) --&gt; WHATEVER
</code></pre>
<p><em>NOTE: <code>WHATEVER</code> is a beautiful keyword in Kailua that lets you not define the type of a value, instead of saying &quot;return a number&quot; it says &quot;return literally whatever&quot;</em></p>
<p>Some functions in the ca_types files have a <code>--&gt;</code> to their end; on the right side of that arrow is the return value. Easy enough to read!</p>
<p>And that's my explanation of CA commands! Hope you had as much fun as I did.</p>
<a class="header" href="#interfaces" id="interfaces"><h4>Interfaces</h4></a>
<p>Similar to commands, script interfaces are a way to access some game data with some Lua. We looked at them previously - in the second lesson, we used a <code>FACTION_SCRIPT_INTERFACE</code>, which we got by using the command <code>cm:get_faction(&quot;faction_key&quot;)</code>.</p>
<p>Script interfaces are objects that we can apply some functions <em>to</em> (functions applied to an object are known as methods, but we'll talk about that terminology later). In our previous example, we did the following:</p>
<pre><code class="language-lua">    local excess_faction = cm:get_faction(excess_name)
    if excess_faction:is_dead() == true then
</code></pre>
<p>Wherein, of course, <code>excess_name</code> was a local variable a bit further up. In this example, <code>cm:get_faction()</code> has a <em>return value</em> of a <code>FACTION_SCRIPT_INTERFACE</code>, which we assigned to the local variable <code>excess_faction</code>. <code>FACTION_SCRIPT_INTERFACES</code> have a method called <code>is_dead()</code>, which lets us read if the faction is, well... dead. But how did I know to use that? <em>gasp</em></p>
<p>Also similar to commands, script interfaces are documented with a slightly-questionable CA file, though this one is typically waaaay more reliable, if a bit inconsistent with some naming. We can, again, grab it from the <a href="./chapter_1.html">Tools &amp; Resources</a> page, this time under the title &quot;Scripting Doc (Events &amp; Interfaces). Our big focus for now is the latter half of that name - Interfaces - though we'll be getting into events right in the next section below!</p>
<p>Open your newest Scripting Doc, and search for <code>FACTION_SCRIPT_INTERFACE</code>. It should be towards the top of the document, right near the word &quot;Interfaces&quot; in big boldage. Like this: <strong>Interfaces</strong>. Cool, found it? Click it!</p>
<p>You should get a big, long list of blue links, followed by more clear definitions. A typical entry here would look similar to the follows (because the following <em>is</em> an entry here):</p>
<pre><code class="language-lua">Function: holds_entire_province
Description: Does this faction hold the entire specified province? Also may include vassals
Parameters: holds_entire_province(String province, bool include_vassals)
Return: bool
</code></pre>
<p>As before, like the commands above were done with a prefix of <code>cm:</code>, these interface functions are done with a prefix of that script interface. But it won't just be <code>FACTION_SCRIPT_INTERFACE:holds_entire_province</code>, that makes no sense! In our previous, excess-based example, it would look like the following:</p>
<pre><code class="language-lua">    local excess_faction = cm:get_faction(excess_name)
    if excess_faction:holds_entire_province(
</code></pre>
<p>The second line - description - is quite obvious. It's just a description. Read it, don't read it, I don't care.</p>
<p>Parameters! We talked about this recently, you remember it right? It'll be a type and a very brief stand-in name to explain what should go there. In this case, you can tell that it wants the key of the province, in strings, and a boolean that determines whether or not you'd like to include vassals in the check. Sometimes, they'll just put the stand-in name in quotation marks to show that it should be a string.</p>
<p>Return values are much the same. Sometimes there will be returns of other script interfaces, and that's how you can start getting some fun stuff. With a <code>FACTION_SCRIPT_INTERFACE</code>, you can use <code>character_list()</code> to get a <code>CHARACTER_LIST_SCRIPT_INTERFACE</code>, and then use <code>item_at()</code> to get a <code>CHARACTER_SCRIPT_INTERFACE</code>, and then use <code>get_forename()</code> to get a string. That'll look like:</p>
<pre><code class="language-lua">    local faction = cm:get_faction(&quot;whatever&quot;)
    local character_list = faction:character_list()
    local character = character_list:item_at(0)
    local forename = character:get_forename()
</code></pre>
<p>I will note that you don't have to assign everything a local variable here. It can look, albeit much uglier and less safe, like this:</p>
<pre><code class="language-lua">    local forename = cm:get_faction(&quot;whatever&quot;):character_list():item_at(0):get_forename()
</code></pre>
<p>But I do not recommend doing something like this, until you're very comfortable with the language. I do it very, very, very rarely, only when it makes perfect sense to do it, and that's lie-talk for &quot;when I'm tired and it makes perfect sense to my tired brain&quot;.</p>
<p>Script interfaces are stupidly, stupidly powerful, and using all these smartly allows you to make some serious change within the game, and to read a lot more details, from &quot;how many units are in this army&quot; to &quot;what level is this character&quot; to &quot;how many armies were in the last battle?&quot; But, above all, these interfaces are used <em>best</em> and <em>most powerfully</em> when used in conjunction with listeners and events.</p>
<p>What are listeners and events? Ah, well...</p>
<a class="header" href="#listeners-and-events" id="listeners-and-events"><h4>Listeners and Events</h4></a>
<p>A listener is an important script command that, simply, waits for something to happen - or, listens for something to happen - in the game, and then triggers something else. Using a listener, we can listen for an event such as the creation of an army, the occupation of a city, or even a battle, and then we use the information from that situation, check for something specific, and run our code if the event matches our criteria. For example: we may be looking for Mannfred to occupy Altdorf. In this case we'd have to use a listener to &quot;listen&quot; for a city being occupied, but we don't want to listen for just any city being occupied. In our example, we have to listen for Altdorf being occupied, and for Mannfred doing the occupying. The listener will listen for every single time a city is occupied, and once those two conditions are met - <em>Mannfred</em> occupying <em>Altdorf</em>... <strong>Clue</strong>, anyone? - then our listener will trigger some code. In layman's code, our listener will <em>do a thing!</em></p>
<p>Overall, it is a very valuable connection between Lua and game data, and any scripter should understand the in's and out's of a listener.</p>
<p>Let's break down the basics of a listener. Here is it, at its most basic form:</p>
<pre><code class="language-lua">    core:add_listener(
        &quot;listener_name&quot;,
        &quot;event_name&quot;,
        boolean1,
        function(context)
        end,
        boolean2
    )
</code></pre>
<ul>
<li>&quot;listener_name&quot;: Can be whatever you want it to be! (Keep in mind if you share the same listener_name as another listener, and that name is called with core:remove_listener(&quot;listener_name&quot;), one of those listeners will be removed, and it'd be hard to tell which would be. Use unique names!)</li>
<li>&quot;event_name&quot;: This must be one within a set of Events that CA defines. You can view this <a href="files/scripting_doc.html">list here</a>. We'll cover this list more in depth later on.</li>
<li>boolean1: This is the &quot;conditional&quot; boolean. If it is set to true, the function to execute will execute; if it is set to false, the function will not execute.</li>
<li>function: This is the &quot;callback&quot; function, which only runs if the conditional boolean returns as true. Can be whatever valid function you want! Note that it MUST have the format of &quot;function(context) --[[....]] end,&quot;</li>
<li>boolean2: This is the &quot;persistence&quot; boolean. If it is set to true, the listener will continue listening. If it is set to false, the listener will be removed from the game data.</li>
</ul>
<a class="header" href="#ca-events" id="ca-events"><h3>CA Events</h3></a>
<p>Let's talk more in detail about the Events I mentioned.</p>
<p>As previously clarified, Events are predefined objects that are used exclusively in tandem with Listeners. A full list of Events, and all of their methods, and all of the interfaces, can be found <a href="files/scripting_doc.html">here</a>. Let's go over how to use this document!</p>
<p>At the top of the document is a long list of Events, each clickable to divert to another part of the document. Each of these Events have specific usage. It should be noted here that documentation on some events is rather light, ie. when to use certain ones versus others, but a lot can be found out by looking at vanilla scripts or other mods.</p>
<p>I want to start a new function after the player takes over Altdorf. After searching the term &quot;Occu&quot;, the event &quot;GarrisonOccupiedEvent&quot; is highlighted. This looks promising! After clicking, the available functions are &quot;garrison_residence&quot; and &quot;character&quot;, which seem to be the region that was occupied, and the character that led the assault, in order.</p>
<a class="header" href="#conditional-coding" id="conditional-coding"><h3>Conditional Coding</h3></a>
<p>Remember &quot;boolean1&quot; from up above? If that is set to true/false, it's not really effective code. We can replace that true/false with a function that returns a true/false value, and that way we can actually check the event, see if a specific thing happened in that event, and then spit out a boolean to trigger the callback function.</p>
<pre><code class="language-lua">    function(context)
        return context:[thing we want to check]
    end,
</code></pre>
<p>In essence, the above is the foundation for what all effective conditional functions in a listener should be. Context, in the context of listeners, is an object which contains all the data that occurred within the Event. But let's back up. Remember on the document, we found <code>GarrisonOccupiedEvent</code>? Let's go back to it and click it again. We see two options, as mentioned before - &quot;garrison_residence&quot; and &quot;character&quot;. As our intention is to find a specific region being occupied - Altdorf - we need to use that former path.</p>
<p>At this point, our WIP code looks like the following:</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence()
    end,
</code></pre>
<p>For the conditional function, you always want to start with &quot;return context:&quot;, and the next method can only be one of the methods that is accessible by that Event - which is where this document comes SO in handy. For other examples, click around the different Events listed at the top. Each &quot;Function&quot; underneath each Event after clicking it is a valid method for the context of that Event. The &quot;RegionSelected&quot; event only has access to a &quot;region&quot; function, which means the only valid method is to use &quot;context:region()&quot;. &quot;DilemmaChoiceMadeEvent&quot;, however, has access to &quot;faction&quot;, &quot;choice&quot;, &quot;campaign_model&quot;, and &quot;dilemma&quot;, so those four are all valid methods.</p>
<p><strong><em>NOTE: Yes, you have to add &quot;()&quot; to the end of the function's name.</em></strong></p>
<p>Back to our example - you'll see the garrison_residence has <code>GARRISON_RESIDENCE_SCRIPT_INTERFACE</code> beneath it. Looking in the &quot;GARRISON_RESIDENCE_SCRIPT_INTERFACE&quot;, I don't see a &quot;key&quot; or &quot;name&quot;. Matter of fact, the most likely path is &quot;region()&quot;. That brings our code to...</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence():region()
    end,
</code></pre>
<p>After checking the <code>REGION_SCRIPT_INTERFACE</code>, we finally see the &quot;name&quot; method, which allows us to fully check our context. Our line of code is finally built to:</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence():region():name() == &quot;wh_main_reikland_altdorf&quot;
    end,
</code></pre>
<p>But that's not all! All this does is to check if the Altdorf region is being occupied, but it says nothing about Mannfred! We'll go back to the very beginning - find the GarrisonOccupiedEvent on the document, and return to its functions, which were garrison_residence() and character(). We want to build an &quot;and&quot; sentence for our conditional, so that it only triggers the function when Altdorf is occupied <strong>AND</strong> when it's occupied by Mannfred. Let's try to plot our trajectory a little. We should try to find a script_interface that allows us to reference an agent_subtype key, which is the cleanest and most mod-friendly way to search for Mannfred. Looking at <code>CHARACTER_SCRIPT_INTERFACE</code>, I see two functions - character_subtype() and character_subtype_key(). The latter is used to return a string - ie., it doesn't check for a specific subtype key, but it will tell us what the characters subtype key is. We need to <em>check</em> for a specific subtype key, &quot;vmp_mannfred_von_carstein&quot;.</p>
<pre><code class="language-lua">    function(context)
        return context:garrison_residence():region():name() == &quot;wh_main_reikland_altdorf&quot; and context:character():character_subtype(&quot;vmp_mannfred_von_carstein&quot;)
    end,
</code></pre>
<p>Note here that the first line of context, that ends in &quot;:name()&quot;, needs to have an equal-to check because we don't want to return the <em>name</em> of the region, but we want to return a value of true or false if the name of the region is equal to the string we define - &quot;wh_main_reikland_altdorf&quot;. We can read this as &quot;return true if the region's name is Altdorf, and if the character is Mannfred; else, return false.&quot;</p>
<p>A strong conditional function is very important to writing good listeners, as listeners can be very performance-heavy if there are many triggering at once, and the more that are whittled away via a strong conditional, the better performance will be. Be mindful of your conditionals!</p>
<a class="header" href="#callback-functions" id="callback-functions"><h3>Callback Functions</h3></a>
<p>At this point in the walkthrough, we have about 60% of our listener completed! It's not bad, let's take a quick look at what we actually have written:</p>
<pre><code class="language-lua">core:add_listener(
    &quot;MannfredOccupiesAltdorf&quot;,
    &quot;GarrisonOccupiedEvent&quot;,
    function(context)
        return context:garrison_residence():region():name() == &quot;wh_main_reikland_altdorf&quot; and context:character():character_subtype(&quot;vmp_mannfred_von_carstein&quot;)
    end,
    function(context)
        -- code to execute
    end,
    boolean2
)
</code></pre>
<p>I'd like to point out a couple quick notes. To start off - yes, your listener_name can be anything you want, as long as it's a string. You need a comma after <em>every argument</em> in the command, of which there are five that are detailed way at the top - listener_name, name, conditional boolean, callback, and persistence boolean. The code above is written the way it is because that's a common application of it, and allows it to be easily read, but realistically this can all be written on one line.</p>
<p>Alright, so we are on the function to execute block, known as the callback function. Here, we have much more freedom than the conditional function, as we can do whatever is needed with this block. For instance, we can have a callback function that triggers an event (like a dilemma or a message), or grants a unit/experience/ancillary, or unlocks something like a Rite or a Legendary Lord. For our instance, I want to just give Mannfred's army a new unit and a new effect bundle.</p>
<p><strong><em>NOTE: For our sake, we're going to assume the new unit and new effect bundle are already defined.</em></strong></p>
<p>Looking up in our <a href="files/scripting.txt">commands document</a>, I see a grant_unit_to_character to command. Checking vanilla usage, I see it takes two args - a char_lookup_str and a unit_key string. The unit_key string - which refers to the main_units_tables - is, in our situation, <code>tutorial_big_bat</code>. To find a char_lookup_str, we have to first find the character's cqi.</p>
<p><em>For more information on char_lookup_str and cqi, go to <a href="chapter_3_1_9.html">the CA types page</a></em></p>
<p>Thankfully for us, we can go back to where we were before and use the context of the Event to find all the info from before. Looking at the <code>CHARACTER_SCRIPT_INTERFACE</code>, we see a direct link to cqi, with the method &quot;command_queue_index()&quot;. For this, we define our local values as such:</p>
<pre><code class="language-lua">    local char_cqi = context:character():command_queue_index()
    local char_lookup_str = cm:char_lookup_str(char_cqi)
</code></pre>
<p>With this, we find the CQI first of the character, and then apply that to find the character's lookup string, which is the type needed for grant_unit_to_character.</p>
<p>Before we apply that command though, we should find the arguments we need for apply_effect_bundle_to_force(), which is our command that will give an effect bundle to Mannfred's army. We first need our effect bundle; we'll use <code>tutorial_free_hair</code>. The second argument is a military force CQI, and our third argument is a number of turns. We'll make it five turns long.</p>
<p>To find the military force CQI, we use something similar as above. We will go from character to military force, and then find the CQI there. We can use something like the following:</p>
<pre><code class="language-lua">    local mf_cqi = context:character():military_force():command_queue_index()
</code></pre>
<p>Alright, now we have all we need to build our callback function! Let's mush it all together real quickly.</p>
<pre><code class="language-lua">function(context)

    local char_cqi = context:character():command_queue_index()
    local char_lookup_str = cm:char_lookup_str(char_cqi)
    local mf_cqi = context:character():military_force():command_queue_index()
    
    cm:grant_unit_to_character(char_lookup_str, &quot;tutorial_big_bat&quot;)
    cm:apply_effect_bundle_to_force(&quot;tutorial_free_hair&quot;, mf_cqi, 5)

end,
</code></pre>
<p>And that's a quick walkthrough on how to assemble your callback function! Please note, you can have whatever you want here, and there's nothing saying you <em>must</em> restrict yourself to the context of the event. As an example, I can do the same thing without context, like so:</p>
<pre><code class="language-lua">function(context)

    local mannfred_faction = cm:get_faction(&quot;wh_main_vmp_vampire_counts&quot;)
    local mannfred = mannfred_faction:faction_leader()
    
    local char_cqi = mannfred:cqi()	
    local char_lookup_str = cm:char_lookup_str(char_cqi)
    local mf_cqi = mannfred:military_force():command_queue_index()
    
    cm:grant_unit_to_character(char_lookup_str, &quot;tutorial_big_bat&quot;)
    cm:apply_effect_bundle_to_force(&quot;tutorial_free_hair&quot;, mf_cqi, 5)

end,
</code></pre>
<p>This takes a little bit longer than using context, but it is a solution to applying commands to objects that aren't involved in the context. So if, for example, you wanted to give all Vampire factions - aside from Mannfred's own - an <code>effect_bundle</code> that increases their diplomatic relations with Mannfred after he conquers Altdorf, you can. The world is your oyster when it comes to listeners.</p>
<a class="header" href="#persistence" id="persistence"><h3>Persistence</h3></a>
<p>One last thing, and it's gonna be much quicker than the last two. The final boolean - persistence - can be set to true, or false. True means that the listener will fire more than once; false means that, once the entire code is run through, the listener is removed from the game state and won't be called again. This only gives two options - once, or infinite. There is a third option, by using core:remove_listener(&quot;listener_name&quot;). At whichever point this code is called, the listener with the matching &quot;listener_name&quot; is removed from the game state, and won't be called again. A remove_listener statement like this can be used after enabling a counter that listens for the listener firing five times, or to cancel the listener if the turn is beyond 100, or much else.</p>
<p>Keep in mind that, to &quot;fire&quot;, only the conditional needs to return true. If there's more if statements in your callback function, and they fail, but your persistence is set to false, the listener will remove itself.</p>
<pre><code class="language-lua">core:add_listener(
    &quot;my_listener&quot;, 
    &quot;GarrisonOccupiedEvent&quot;, 
    true, 
    function(context) 
        if this_is_done then
            --stuff happens
        end;
    end, 
    false
)
</code></pre>
<p>So this listener will cancel after one use if &quot;GarrisonOccupiedEvent&quot; is triggered, regardless of whether or not &quot;this is done&quot; returns as true or false.</p>
<a class="header" href="#summary-1" id="summary-1"><h3>Summary</h3></a>
<p>Overall, there's a lot of power to understanding these big three, and it takes your Lua knowledge from &quot;adding and multiplying numbers&quot; to &quot;affecting the game in a real, and personable way&quot;.</p>
<p>Next up, we're going to have a quick look at some CA types, including the char_lookup_str and CQI types we looked at in this tutorial temporarily.</p>
<a class="header" href="#ca-types" id="ca-types"><h1>CA Types</h1></a>
<a class="header" href="#battle-maps" id="battle-maps"><h1>Battle Maps</h1></a>
<p>This section will cover all the tutorials related to <strong><em>Creating Battle Maps</em></strong>, all the way from the simplest land map, to the more complex siege maps. And all of that, just for the price of a youngling soul... well, let's begin. As this is a series of kinda complex tutorials, they're separated in parts:</p>
<ul>
<li><a href="chapter_4_1.html"><strong>Land Battle Maps</strong></a>: How to make a basic working land battle map. <strong>Technical part</strong>. Decorations are on you!</li>
<li><a href="chapter_4_2.html"><strong>Siege Battle Maps</strong></a>: How to make EVERYTHING of a siege map work. <strong>Technical part</strong>, but we'll cover part of the decorations too.</li>
<li><a href="chapter_4_extra.html"><strong>Battle Maps Extras</strong></a>: Whatever doesn't fit in the other sections, like PSA, TIL, ACB,.... Yes, I just came up with the last one.</li>
</ul>
<p>So, with that said, let's begin!</p>
<a class="header" href="#land-battle-maps" id="land-battle-maps"><h1>Land Battle Maps</h1></a>
<a class="header" href="#whats-a-land-battle-map" id="whats-a-land-battle-map"><h3>What's a <em>Land Battle Map</em>?</h3></a>
<p>Land maps are <strong><em>any normal battle map</em></strong>. This includes ambush maps, land battles, underground battles.... but for the sake of simplicity, we're going to focus on how to make a basic plain and simple land battle. Everything else is up to you to expand upon.</p>
<p>As a bonus, the map used for this tutorial can be found <a href="files/wh2_tutorial_land_battle.7z">here</a>. Just unpack it inside <code>Total War WARHAMMER II\assembly_kit\raw_data\terrain\tiles\battle\_assembly_kit</code> and it should appear in Terry's <code>Open</code> dialog.</p>
<a class="header" href="#requeriments" id="requeriments"><h3>Requeriments</h3></a>
<p>For a land battle map to <em>just work</em>, you need to fulfill some requeriments:</p>
<ul>
<li>
<p>Have <strong>a playable area</strong> with two deployment zones inside.</p>
</li>
<li>
<p>Each deployment zone has to have an <em>additive</em> region inside.</p>
</li>
</ul>
<p>That's all. What? Did you though this was difficult? It's rather simple.</p>
<a class="header" href="#getting-our-hands-dirty" id="getting-our-hands-dirty"><h3>Getting our hands dirty</h3></a>
<p>To create a land map, just open Terry. Then got to <code>File/New</code> and choose the <em>vista</em> (a.k.a. the borders of your map + climate, lighting,.... <em>environment</em>) for your map, then hit <code>Ok</code>. Wait and you'll see an empty plain. Paint it, tweak the height,.... change it until you get the map you want. And once that is done, <strong>let's start with the Technical part</strong>.</p>
<p>First, the <strong><em>Playable area</em></strong>. It's simple, click in the <code>Playable Area</code> button, then draw a rectangle. That's your map, where your units will fight. The borders are where they're going to retreat to. Simple, isn't? Here it's how it looks (hint: it's the white square):</p>
<p><img src="images/4_1-01.png" alt="Play with me! I know of games...." /></p>
<p>Second, Go-NoGo Regions. The game automatically guesses where a unit can walk and where it cannot, but you can change it with these regions.</p>
<p><img src="images/4_1-02.png" alt="But you can't come here!" /></p>
<p>See those red lines? That's where the game <em>thinks</em> your units cannot walk (You can make them appear changing a setting in Terry). But <strong>those are imprecise</strong>, and wrong in some situations. To fix it, we have to manually set the zones we want to be walkable, and the ones that we don't want to be it. But I'm lazy, so I use the lazy method: put a Go Region around the entire Playable Area, then place the No-Go Regions manually. This is the result:</p>
<p><img src="images/4_1-03.png" alt="Now you can!" /></p>
<p>Now, the last thing, deployment zones. Just hit the <code>Deployment Zone</code> button, then draw one for the attacker, and one for the defender (Alliance ID, 0 is attacker, 1 defender). Like this.</p>
<p><img src="images/4_1-04.png" alt="Deploy me baby, use satelites" /></p>
<p>That's the basics. With that, you just have a working land battle map, but there are some extras you'll need to get the best of your map.</p>
<a class="header" href="#love-death--ai" id="love-death--ai"><h3>Love, Death &amp; AI</h3></a>
<p>First, we need to add AI hints. These are lines we draw in the map that tells the AI <em>this place is good for defending, here you can deploy your units in a line, from here reinforcements will come,...</em> Basically, it makes the AI *understand the map. There are multiple AI hints:</p>
<ul>
<li><strong>Forest</strong>: It tells the AI <strong>where the forest is</strong>, so they can get there to get extra defense from proyectiles. This one is automatically generated around forest terrain.</li>
<li><strong>Defensive hill</strong>: It tells the AI about <strong>good places to defend</strong>. Just put it around the places you want the AI to defend.</li>
<li><strong>Default deployment line</strong>: It tells the AI <strong>where to deploy his units</strong> on a line. When using this, just draw a line with just two vertex. More than that breaks this one.</li>
<li><strong>Attacker/Defender deployment line</strong>: It tells the AI <strong>where the reinforcements will form a line</strong> after arriving to the map through the closest walkable border to this line. Only used in campaign. If you got a campaign map without these and reinforcements come it may crash, or you may have no reinforcements.</li>
</ul>
<p>So for this example we are going to put deployment and defensive hill hints, so the AI knows how to deploy and how to defend the hill. To give more variety to your maps, I recommend you to put multiple deployment hints per deployment zone, so the AI deploy differently from time to time. Here it is a screenshot with the deployment hints done:</p>
<p><img src="images/4_1-05.png" alt="Ayyyy lmao" /></p>
<p>And here is an example of the deployment hill hint:</p>
<p><img src="images/4_1-06.png" alt="Ayyyy lmao x2" /></p>
<p>With that, you can test our map ingame. Just hit export, what until it finishes, start the game, enable your map's mod in the launcher, and... play the game. It should popup under <em>Land Battles</em>.</p>
<a class="header" href="#siege-battle-maps" id="siege-battle-maps"><h1>Siege Battle Maps</h1></a>
<p>TBD</p>
<a class="header" href="#battle-map-extras" id="battle-map-extras"><h1>Battle Map Extras</h1></a>
<p>In this section, you'll find some tutorials that don't fit with the flow of the prior. Also, enjoy a glossary!</p>
<a class="header" href="#extra-tutorials" id="extra-tutorials"><h4>Extra Tutorials</h4></a>
<ul>
<li><a href="./chapter_4_extra_1.html">Custom Vistas by Maruka</a></li>
</ul>
<a class="header" href="#glossary" id="glossary"><h4>Glossary</h4></a>
<p>Here it goes extra stuff that's good to know about Terry. So... here we go:</p>
<ul>
<li>
<p>The stuff you put outside the map <strong>doesn't have his height relative to 0</strong>. Instead, their <em>0</em> is the height of the terrain in the place you put them. For example, put a building at 30 height. If the ground it's at 60 in that exact place, then once the map loads <strong>you'll find a floating building at 90 height</strong>. This can only be seen ingame, not in Terry.</p>
</li>
<li>
<p>Of the 8x8 green square map, the border row/columns are special. The game will <strong>autolevel any terrain</strong> from the middle of those squares to the border of the map to 0 height, but that it's not shown in Terry, only in-game. So, if you place stuff there, account for the height change once the game loads the map, because that part of the map acts like the outside of the map.</p>
</li>
<li>
<p>Vegetation on prefabs you put outside your map dissapears.</p>
</li>
<li>
<p>If your deployment zone goes outside your playable area, the game will <strong>expand the playable area</strong> to cover the full size of the deployment zone.</p>
</li>
<li>
<p>The priority of Go/No-Go Regions is: <code>Walkable Terrain</code> &gt; <code>Automatic No-Go Region</code> &gt; <code>Go Region</code> &gt; <code>No Go Region</code>. The thing <strong>most to the right</strong> will take priority over the rest.</p>
</li>
<li>
<p>If you don't let any walkable connections with the map's border, the game will load your map as <strong>a fully unwalkable map</strong>, and it'll crash on loading/deploying.</p>
</li>
</ul>
<a class="header" href="#custom-vistas" id="custom-vistas"><h1>Custom Vistas</h1></a>
<a class="header" href="#by-maruka-1" id="by-maruka-1"><h2>By Maruka</h2></a>
<a class="header" href="#introduction-1" id="introduction-1"><h4>Introduction</h4></a>
<p>Have you always wanted to make your own custom vista in Terry? No? Then you have come to the wrong place! This guide will teach you how to make your own custom vista. Think of environments like creating a river, a coastline, adding a mountain range, etc.</p>
<p>This guide will teach you how to create your own custom vista. This isn't officially supported by CA, but it works very well. If you have any questions, it is best to ask them on the Map Makers Discord channel, which you can find <a href="http://discord.io/tww_mapmakers">here</a>.</p>
<p>You don't need any additional programmes, you'll only need to make use of Terry and Bob.</p>
<a class="header" href="#preparation" id="preparation"><h4>Preparation</h4></a>
<p>Open your file explorer and go to:</p>
<pre><code>Total War WARHAMMER II\assembly_kit\raw_data\terrain\vistas\
</code></pre>
<p>and look for one of the vista's with a terry file. I'll be using lizardmen_02 as the basis of this guide.</p>
<p>Copy whichever map you chose and rename it to something else. I called mine lizardmen_04 because I'm original like that.</p>
<p>Go into that folder and rename the .terry and .layer file as well.</p>
<p>Open the terry file in a text editor. You'll see a section which still refers to the original vista, change that to your new name (in my case I changes lizardmen_02 to lizardmen_04 here).</p>
<pre><code>&lt;data terrain_setup=&quot;terrain/vistas/lizardmen_04/&quot;  world_width=&quot;0&quot; global_lighting=&quot;&quot; ambient_light_environments=&quot;&quot; water_plane_material=&quot;materials/campaign_water_plane_default.xml.material&quot;/&gt;
</code></pre>
<p>Save the file.</p>
<p>Open the vista.xml and change the display_name, and any other changes you might want to make. This is only used for the display in Terry later.</p>
<p>You can also change the vista.png if you want, that's also only used in Terry.</p>
<a class="header" href="#editing-the-vista-in-terry" id="editing-the-vista-in-terry"><h4>Editing the Vista in Terry</h4></a>
<p>Open Terry. Once opened, close the wizard popup.</p>
<p>Drag the .terry file into Terry. It'll now load the Vista. You can now make any changes you like, such as adding props, or changing the terrain.</p>
<p><img src="images/chapter_4_extra_1/01.png" alt="test" /></p>
<p>Ocne you have finished with your changes, go to File -&gt; Save As, and save your edited vista in its own folder (with the same name).</p>
<p><img src="images/chapter_4_extra_1/02.png" alt="test" /></p>
<p>It is vital that you always do 'save as', don't use the normal save option. If you use the normal save Terry will crash. If you decide to make any further changes to your vista, just use 'save as' again and override your own vista. That works perfectly fine.</p>
<p>Once you're done editing you can close Terry.</p>
<a class="header" href="#exporting-the-vista" id="exporting-the-vista"><h4>Exporting the vista</h4></a>
<p><strong><em>Note:</em></strong> <em>If you closed Terry and Steam shows it is stil running, you will need to open up your Task Manager to close it yourself. <code>CRTL+ALT+DEL</code> to pull up the manager, and scroll down to the Other Programs. There, you should find a program called TweaK. Right click -&gt; End Task and now you should be able to continue with the guide.</em></p>
<p>Open Bob.</p>
<p>Select your vista map in the leftmost panel, as demonstrated in this lovely image:</p>
<p><img src="images/chapter_4_extra_1/03.png" alt="test" /></p>
<p>Click start.</p>
<p>Wait.</p>
<p>Click exit.</p>
<p>Congratulations, you're done! Next time you start up Terry you should see your new shiny vista.</p>
<a class="header" href="#etc" id="etc"><h1>Etc.</h1></a>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
